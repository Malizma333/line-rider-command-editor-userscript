var SETTINGS_KEY,TRIGGER_ID,TOOLBAR_COLOR;(t=>{t.VIEWPORT="VIEWPORT",t.FONT_SIZE="FONT_SIZE"})(SETTINGS_KEY=SETTINGS_KEY||{});let LOCAL_STORAGE_PREFIX="CMD_EDITOR_MOD_",SETTINGS={[SETTINGS_KEY.VIEWPORT]:{HD:{ID:"HD",NAME:"720p",SIZE:[1280,720]},FHD:{ID:"FHD",NAME:"1080p",SIZE:[1920,1080]},QHD:{ID:"QHD",NAME:"1440p",SIZE:[2560,1440]},UHD:{ID:"UHD",NAME:"4K",SIZE:[3840,2160]}},[SETTINGS_KEY.FONT_SIZE]:{SMALL:0,MEDIUM:1,LARGE:2}},DEFAULTS={[SETTINGS_KEY.FONT_SIZE]:SETTINGS.FONT_SIZE.MEDIUM,[SETTINGS_KEY.VIEWPORT]:SETTINGS.VIEWPORT.HD.ID};function getSetting(t){var e;return null!=(e=window.localStorage.getItem(LOCAL_STORAGE_PREFIX+t))?e:String(DEFAULTS[t])}function saveSetting(t,e){window.localStorage.setItem(LOCAL_STORAGE_PREFIX+t,e)}function setPlaybackDimensions(t){return{type:"SET_PLAYBACK_DIMENSIONS",payload:t}}function closeSidebar(){return{type:"SET_VIEWS",payload:{Sidebar:null},meta:{name:"SET_SIDEBAR_PAGE",auto:!1}}}function getSimulatorTrack(t){return t.simulator.engine}function getWindowFocused(t){return t.views.Main}function getPlayerRunning(t){return t.player.running}function getCurrentScript(t){return t.trackData.script}function getRiders(t){return getSimulatorTrack(t).engine.state.riders}function getNumRiders(t){return getRiders(t).length}function getPlayerIndex(t){return t.player.index}function getSidebarOpen(t){return t.views.Sidebar}function getTrackTitle(t){return t.trackData.label}function getEditorZoom(t){return t.camera.editorZoom}function getEditorPosition(t){return t.camera.editorPosition}function getPlaybackZoom(t){return window.getAutoZoom?window.getAutoZoom(getPlayerIndex(t)):t.camera.playbackZoom}function getPlaybackDimensions(t){return t.camera.playbackDimensions||t.camera.editorDimensions}(t=>{t.ZOOM="ZOOM",t.PAN="CAMERA_PAN",t.FOCUS="CAMERA_FOCUS",t.TIME="TIME_REMAP",t.SKIN="CUSTOM_SKIN",t.GRAVITY="GRAVITY"})(TRIGGER_ID=TRIGGER_ID||{});let ZoomMetadata={DISPLAY_NAME:"Zoom",FUNC:"getAutoZoom=createZoomer({0},{1});",TEMPLATE:[[0,0,0],1]},CameraPanMetadata={DISPLAY_NAME:"Pan",FUNC:"getCamBounds=createBoundsPanner({0},{1});",TEMPLATE:[[0,0,0],{w:.4,h:.4,x:0,y:0}]},CameraFocusMetadata={DISPLAY_NAME:"Focus",FUNC:"getCamFocus=createFocuser({0},{1});",TEMPLATE:[[0,0,0],[1]]},TimeRemapMetadata={DISPLAY_NAME:"Speed",FUNC:"timeRemapper=createTimeRemapper({0},{1});",TEMPLATE:[[0,0,0],1]},SkinCssMetadata={DISPLAY_NAME:"Skin",FUNC:"setCustomRiders({0});",TEMPLATE:{outline:{stroke:"black"},flag:{fill:"#00000066"},skin:{fill:"white"},hair:{fill:"black"},fill:{fill:"black"},eye:{fill:"black"},sled:{fill:"white"},string:{stroke:"black"},armSleeve:{fill:"black"},armHand:{fill:"white"},legPants:{fill:"black"},legFoot:{fill:"white"},torso:{fill:"white"},hatTop:{fill:"white"},hatBottom:{stroke:"black"},hatBall:{fill:"black"},scarf1:{fill:"#FD4F38"},scarf2:{fill:"white"},scarf3:{fill:"#06A725"},scarf4:{fill:"white"},scarf5:{fill:"#3995FD"},id_scarf0:{fill:"white"},id_scarf1:{fill:"#FD4F38"},id_scarf2:{fill:"white"},id_scarf3:{fill:"#06A725"},id_scarf4:{fill:"white"},id_scarf5:{fill:"#3995FD"}}},GravityMetadata={DISPLAY_NAME:"Gravity",TEMPLATE:[[0,0,0],[{x:0,y:.175}]]},TRIGGER_PROPS={[TRIGGER_ID.ZOOM]:ZoomMetadata,[TRIGGER_ID.PAN]:CameraPanMetadata,[TRIGGER_ID.FOCUS]:CameraFocusMetadata,[TRIGGER_ID.TIME]:TimeRemapMetadata,[TRIGGER_ID.SKIN]:SkinCssMetadata,[TRIGGER_ID.GRAVITY]:GravityMetadata};class TriggerDataManager{constructor(){this.triggerData=TriggerDataManager.initialTriggerData,this.undoStack=[],this.redoStack=[]}static get initialTriggerData(){return{[TRIGGER_ID.ZOOM]:{id:TRIGGER_ID.ZOOM,triggers:[structuredClone(TRIGGER_PROPS[TRIGGER_ID.ZOOM].TEMPLATE)],smoothing:CONSTRAINTS.SMOOTH.DEFAULT},[TRIGGER_ID.PAN]:{id:TRIGGER_ID.PAN,triggers:[structuredClone(TRIGGER_PROPS[TRIGGER_ID.PAN].TEMPLATE)],smoothing:CONSTRAINTS.SMOOTH.DEFAULT},[TRIGGER_ID.FOCUS]:{id:TRIGGER_ID.FOCUS,triggers:[structuredClone(TRIGGER_PROPS[TRIGGER_ID.FOCUS].TEMPLATE)],smoothing:CONSTRAINTS.SMOOTH.DEFAULT},[TRIGGER_ID.TIME]:{id:TRIGGER_ID.TIME,triggers:[structuredClone(TRIGGER_PROPS[TRIGGER_ID.TIME].TEMPLATE)],interpolate:CONSTRAINTS.INTERPOLATE.DEFAULT},[TRIGGER_ID.SKIN]:{id:TRIGGER_ID.SKIN,triggers:[structuredClone(TRIGGER_PROPS[TRIGGER_ID.SKIN].TEMPLATE)]},[TRIGGER_ID.GRAVITY]:{id:TRIGGER_ID.GRAVITY,triggers:[structuredClone(TRIGGER_PROPS[TRIGGER_ID.GRAVITY].TEMPLATE)]}}}get data(){return this.triggerData}get undoLen(){return this.undoStack.length}get redoLen(){return this.redoStack.length}updateRiderCount(r){var i=this.triggerData[TRIGGER_ID.FOCUS].triggers;for(let e=0;e<i.length;e++){let t=i[e][1].length;t<r&&i[e][1].push(...Array(r-t).fill(0)),t>r&&i[e][1].splice(r,t-r)}this.triggerData[TRIGGER_ID.FOCUS].triggers=i;var a=this.triggerData[TRIGGER_ID.GRAVITY].triggers;for(let e=0;e<a.length;e++){let t=a[e][1].length;t<r&&a[e][1].push(...Array(r-t).fill(null).map(t=>({x:0,y:.175}))),t>r&&a[e][1].splice(r,t-r)}this.triggerData[TRIGGER_ID.GRAVITY].triggers=a;var t=this.triggerData[TRIGGER_ID.SKIN].triggers;let e=t.length;e<r&&t.push(...Array(r-e).fill(null).map(t=>structuredClone(TRIGGER_PROPS[TRIGGER_ID.SKIN].TEMPLATE))),e>r&&t.splice(r,e-r),this.triggerData[TRIGGER_ID.SKIN].triggers=t}updateFromPath(t,e,r){this.redoStack=[];e=this.setAtPointer(["triggerData"].concat(t),e);this.undoStack.push([t,e,r]),30<this.undoStack.length&&this.undoStack.shift()}undo(){var t,e,r;return 0===this.undoStack.length?null:([t,r,e]=this.undoStack.pop(),r=this.setAtPointer(["triggerData"].concat(t),r),this.redoStack.push([t,r,e]),e)}redo(){var t,e,r;return 0===this.redoStack.length?null:([t,r,e]=this.redoStack.pop(),r=this.setAtPointer(["triggerData"].concat(t),r),this.undoStack.push([t,r,e]),e)}setAtPointer(e,t){let r=this;for(let t=0;t<e.length-1;t+=1)r=r[e[t]];var i=r[e[e.length-1]];return r[e[e.length-1]]=t,i}}let CONSTRAINTS={INTERPOLATE:{DEFAULT:!0},SMOOTH:{DEFAULT:20,MIN:0,MAX:40,INT:!0},FRAME:{DEFAULT:0,MIN:0,MAX:39,INT:!0},SECOND:{DEFAULT:0,MIN:0,MAX:59,INT:!0},MINUTE:{DEFAULT:0,MIN:0,MAX:99,INT:!0},ZOOM:{DEFAULT:1,MIN:-50,MAX:50,INT:!1},PAN_X:{DEFAULT:0,MIN:-100,MAX:100,INT:!1},PAN_Y:{DEFAULT:0,MIN:-100,MAX:100,INT:!1},PAN_WIDTH:{DEFAULT:.4,MIN:0,MAX:2,INT:!1},PAN_HEIGHT:{DEFAULT:.4,MIN:0,MAX:2,INT:!1},FOCUS_WEIGHT:{DEFAULT:0,MIN:0,MAX:1,INT:!1},TIME_SPEED:{DEFAULT:1,MIN:.01,MAX:10,INT:!1},SKIN_ZOOM:{DEFAULT:1,MIN:1,MAX:4,INT:!1},ALPHA_SLIDER:{DEFAULT:1,MIN:0,MAX:1,INT:!1},GRAVITY_X:{DEFAULT:.175,MIN:-100,MAX:100,INT:!1},GRAVITY_Y:{DEFAULT:0,MIN:-100,MAX:100,INT:!1}};function validateData(t,e,r){var i;return null==r||"boolean"==typeof r.DEFAULT?t.new:"number"==typeof r.DEFAULT&&null!=(i=r.INT)&&i?validateInteger(t,r,e):"number"!=typeof r.DEFAULT||null!=(i=r.INT)&&i?t.prev:validateFloat(t,r,e)}function validateInteger(t,e,r){var i,a=t.prev,t=t.new;return""===t.trim()?0:(i=Math.floor(Number(t)),Number.isNaN(i)||t.includes(".")?a:r?i<e.MIN?e.MIN:e.MAX<i?e.MAX:i:i)}function validateFloat(t,e,r){var i,a=t.prev,t=t.new;return""===t.trim()?0:(i=Number(t),Number.isNaN(i)?a:r?i<e.MIN?e.MIN:e.MAX<i?e.MAX:i:t.includes(".")?t:i)}function validateTimes(e){var r=Array(e.length).map(()=>!1),t=e[0][0];0===t[0]&&0===t[1]&&0===t[2]||(r[0]=!0);for(let t=0;t<e.length-1;t+=1){var i=e[t][0],a=e[t+1][0],i=40*(60*i[0]+i[1])+i[2];40*(60*a[0]+a[1])+a[2]<=i&&(r[t+1]=!0)}return r}function main(){let{React:t,ReactDOM:e,store:r}=window,i=document.getElementById("content"),a=document.createElement("div"),n=(Object.assign(a.style,STYLES.root),e.render(t.createElement(GetRootComponent()),a),i.appendChild(a),r.subscribe(()=>{var t=getPlayerRunning(r.getState()),e=getWindowFocused(r.getState()),t=!t&&e;a.style.opacity=t?"1":"0",a.style.pointerEvents=t?"auto":"none"}),setInterval(()=>{var t=i.querySelector('div[style="margin: 16px;"]');t&&(t=t.querySelector("h1"))&&"An error occured!"===t.innerHTML&&(console.warn("[index.main()] Crash detected..."),window.save_commands(),clearInterval(n))},100))}function GetRootComponent(){let{store:d,React:t}=window,g=t.createElement;class e extends t.Component{constructor(){super(),this.componentManager=new r(this),this.scriptParser=new ScriptParser,this.fileParser=new FileParser,this.triggerManager=new TriggerDataManager,this.state={active:!1,activeTab:TRIGGER_ID.ZOOM,triggerUpdateFlag:!1,focusDDIndices:[0],gravityDDIndices:[0],skinEditorSelectedRider:0,skinEditorSelectedColor:"#000000ff",skinEditorZoom:[1,0,0],settingsActive:!1,settingsDirty:!1,fontSize:parseInt(getSetting(SETTINGS_KEY.FONT_SIZE),10),resolution:getSetting(SETTINGS_KEY.VIEWPORT),fontSizeSetting:parseInt(getSetting(SETTINGS_KEY.FONT_SIZE),10),resolutionSetting:getSetting(SETTINGS_KEY.VIEWPORT),invalidTimes:[],toolbarColors:Array(16).fill(TOOLBAR_COLOR.NONE)},d.subscribe(()=>this.updateStore())}componentDidMount(){window.save_commands=()=>(this.onDownload(),"Downloaded commands!")}updateStore(){let e=getNumRiders(d.getState());this.lastRiderCount!==e&&(this.lastRiderCount=e,{skinEditorSelectedRider:i,focusDDIndices:t,gravityDDIndices:r}=this.state,i>=e&&this.setState({skinEditorSelectedRider:e-1}),this.triggerManager.updateRiderCount(e),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),this.setState({focusDDIndices:t.map(t=>Math.min(e-1,t))}),this.setState({gravityDDIndices:r.map(t=>Math.min(e-1,t))}));var t,r,i=getSidebarOpen(d.getState());i&&this.setState({active:!1})}onUpdateToolbarColor(r,i){this.setState({toolbarColors:this.state.toolbarColors.map((t,e)=>e===r?i:t)})}onCreateTrigger(t){var e,r,{activeTab:i,focusDDIndices:a,gravityDDIndices:n}=this.state;i!==TRIGGER_ID.SKIN&&(e=getPlayerIndex(d.getState()),e=[Math.floor(e/2400),Math.floor(e%2400/40),Math.floor(e%40)],r=this.triggerManager.data[i].triggers,e=[e,structuredClone(r[t][1])],e=r.slice(0,t+1).concat([e]).concat(r.slice(t+1)),this.triggerManager.updateFromPath([i,"triggers"],e,i),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),r=this.triggerManager.data[i].triggers,i===TRIGGER_ID.FOCUS&&this.setState({focusDDIndices:a.slice(0,t+1).concat([0]).concat(a.slice(t+1))}),i===TRIGGER_ID.GRAVITY&&this.setState({gravityDDIndices:n.slice(0,t+1).concat([0]).concat(n.slice(t+1))}),this.setState({invalidTimes:validateTimes(r)}))}onUpdateTrigger(t,e,r,i=!1){var a=this.state.activeTab,t=validateData(t,i,r),i=(this.triggerManager.updateFromPath([a,...e],t,a),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),this.triggerManager.data[a].triggers);a!==TRIGGER_ID.SKIN&&this.setState({invalidTimes:validateTimes(i)})}onDeleteTrigger(t){var e,{activeTab:r,focusDDIndices:i,gravityDDIndices:a}=this.state;r!==TRIGGER_ID.SKIN&&(e=(e=this.triggerManager.data[r].triggers).slice(0,t).concat(e.slice(t+1)),this.triggerManager.updateFromPath([r,"triggers"],e,r),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),e=this.triggerManager.data[r].triggers,r===TRIGGER_ID.FOCUS&&this.setState({focusDDIndices:i.slice(0,t).concat(i.slice(t+1))}),r===TRIGGER_ID.FOCUS&&this.setState({gravityDDIndices:a.slice(0,t).concat(a.slice(t+1))}),this.setState({invalidTimes:validateTimes(e)}))}onDownload(){var t=JSON.stringify(this.triggerManager.data),e=document.createElement("a"),t="data:text/json;charset=utf-8,"+encodeURIComponent(t);e.setAttribute("href",t),e.setAttribute("download",getTrackTitle(d.getState())+".script.json"),e.click(),e.remove()}onClickFile(){var t=document.getElementById("trigger-file-upload");t.value="",t.click()}onLoadFile(t){let e=new window.FileReader;e.onload=()=>{try{this.onLoad(this.fileParser.parseFile(JSON.parse(e.result),this.triggerManager.data))}catch(t){console.error("[Root.onLoadFile()] Failed to load file: "+t.message)}},e.readAsText(t)}onLoadScript(){this.onLoad(this.scriptParser.parseScript(getCurrentScript(d.getState()),this.triggerManager.data))}onLoad(t){var e=this.state.activeTab;try{var r,i=t[TRIGGER_ID.FOCUS].triggers,a=Array(i.length).fill(0),n=t[TRIGGER_ID.GRAVITY].triggers,s=Array(n.length).fill(0);this.triggerManager.updateFromPath([],t,TRIGGER_ID.ZOOM),e!==TRIGGER_ID.SKIN&&(r=t[e].triggers,this.setState({invalidTimes:validateTimes(r)})),this.setState({focusDDIndices:a}),this.setState({gravityDDIndices:s}),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}catch(t){console.error("[Root.onLoad()] "+t.message)}}onTest(){var{activeTab:t,invalidTimes:e}=this.state;try{if(!e.every(t=>!t))throw new Error("Triggers contain invalid times!");var r=this.triggerManager.data[t];switch(t){case TRIGGER_ID.ZOOM:window.getAutoZoom=window.createZoomer(r.triggers,r.smoothing);break;case TRIGGER_ID.PAN:window.getCamBounds=window.createBoundsPanner(r.triggers,r.smoothing);break;case TRIGGER_ID.FOCUS:window.getCamFocus=window.createFocuser(r.triggers,r.smoothing);break;case TRIGGER_ID.TIME:window.timeRemapper=window.createTimeRemapper(r.triggers,r.interpolate);break;case TRIGGER_ID.SKIN:window.setCustomRiders(formatSkins(r.triggers));break;case TRIGGER_ID.GRAVITY:void 0!==window.setCustomGravity&&window.setCustomGravity(r.triggers)}}catch(t){console.error("[Root.onTest()] "+t.message)}}async onCopy(){var t,{activeTab:e,invalidTimes:r}=this.state;try{if(r.every(t=>!t))return t=generateScript(e,this.triggerManager.data),await navigator.clipboard.writeText(t);throw new Error("Triggers contain invalid times!")}catch(t){console.error("[Root.onCopy()] "+t.message)}}onUndo(){var t=this.state.activeTab,e=this.triggerManager.undo();this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),t!==e&&this.setState({activeTab:e}),t!==TRIGGER_ID.SKIN&&(e=this.triggerManager.data[t].triggers,this.setState({invalidTimes:validateTimes(e)}))}onRedo(){var t=this.state.activeTab,e=this.triggerManager.redo();this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),t!==e&&this.setState({activeTab:e}),t!==TRIGGER_ID.SKIN&&(e=this.triggerManager.data[t].triggers,this.setState({invalidTimes:validateTimes(e)}))}onResetSkin(t){this.triggerManager.updateFromPath([TRIGGER_ID.SKIN,"triggers",t],structuredClone(TRIGGER_PROPS[TRIGGER_ID.SKIN].TEMPLATE),TRIGGER_ID.SKIN),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}onChangeColor(t,e){var r=this.state.skinEditorSelectedColor,e=null!=e?Math.round(255*Math.min(Math.max(parseFloat(e),0),1)).toString(16).padStart(2,"0"):r.substring(7),t=null!=t?t+e:r.substring(0,7)+e;this.setState({skinEditorSelectedColor:t})}onActivate(){var t=this.state.active,e=getSidebarOpen(d.getState());!t&&e&&d.dispatch(closeSidebar()),this.setState({active:!t})}onChangeTab(t){this.setState({activeTab:t}),t!==TRIGGER_ID.SKIN&&(t=this.triggerManager.data[t].triggers,this.setState({invalidTimes:validateTimes(t)}))}onToggleSettings(){var{settingsActive:t,settingsDirty:e,fontSize:r,resolution:i}=this.state;t&&e&&(this.setState({fontSizeSetting:r}),this.setState({resolutionSetting:i}),this.setState({settingsDirty:!1})),this.setState({settingsActive:!t})}onReport(){window.open("https://github.com/Malizma333/line-rider-command-editor-userscript/issues/new")}onHelp(){window.open("https://github.com/Malizma333/line-rider-command-editor-userscript#readme")}onChangeFontSize(t){var e=this.state.fontSize;t!==e&&this.setState({settingsDirty:!0}),this.setState({fontSizeSetting:t})}onChangeViewport(t){var e=this.state.resolution;e!==t&&this.setState({settingsDirty:!0}),this.setState({resolutionSetting:t})}onApplySettings(){var{resolutionSetting:t,resolution:e,fontSizeSetting:r}=this.state;let i=Math.log2(SETTINGS[SETTINGS_KEY.VIEWPORT][t].SIZE[0]/SETTINGS[SETTINGS_KEY.VIEWPORT][e].SIZE[0]);e=SETTINGS[SETTINGS_KEY.VIEWPORT][t].SIZE;d.dispatch(setPlaybackDimensions({width:e[0],height:e[1]}));e=this.triggerManager.data[TRIGGER_ID.ZOOM].triggers.map(t=>[t[0],Math.round(1e7*(t[1]+i+Number.EPSILON))/1e7]);this.triggerManager.updateFromPath([TRIGGER_ID.ZOOM,"triggers"],e,TRIGGER_ID.ZOOM),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),saveSetting(SETTINGS_KEY.FONT_SIZE,String(r)),saveSetting(SETTINGS_KEY.VIEWPORT,t),this.setState({settingsDirty:!1}),this.setState({fontSize:r}),this.setState({resolution:t})}onChangeFocusDD(t,e){var r=this.state.focusDDIndices,r=[...r];r[t]=parseInt(e,10),this.setState({focusDDIndices:r})}onChangeGravityDD(t,e){var r=this.state.gravityDDIndices,r=[...r];r[t]=parseInt(e,10),this.setState({gravityDDIndices:r})}onChangeSkinDD(t){this.setState({skinEditorSelectedRider:parseInt(t,10)})}onZoomSkinEditor(t,e){var r=this.state.skinEditorZoom,i=document.getElementById("skinElementContainer").getBoundingClientRect(),[r,a,n]=r;let s=r,o=a,l=n;s=e?(a=t,r<CONSTRAINTS.SKIN_ZOOM.MAX&&(o=(a.clientX-i.x)/r,l=(a.clientY-i.y)/r),Math.max(Math.min(r-.001*a.deltaY,CONSTRAINTS.SKIN_ZOOM.MAX),CONSTRAINTS.SKIN_ZOOM.MIN)):Math.max(Math.min(parseInt(t.target.value),CONSTRAINTS.SKIN_ZOOM.MAX),CONSTRAINTS.SKIN_ZOOM.MIN),this.setState({skinEditorZoom:[s,o,l]})}onCameraDataCapture(t,e,r){switch(r){case TRIGGER_ID.ZOOM:this.onUpdateTrigger({prev:t[1],new:Math.log2(getEditorZoom(d.getState())).toString()},["triggers",e,1],CONSTRAINTS.ZOOM,!0);break;case TRIGGER_ID.PAN:var{x:i,y:a}=getEditorPosition(d.getState()),n=getSimulatorTrack(d.getState()),{width:s,height:o}=getPlaybackDimensions(d.getState()),l=getPlaybackZoom(d.getState()),g=Math.floor(getPlayerIndex(d.getState())),n=d.getState().camera.playbackFollower.getCamera(n,{zoom:l,width:s,height:o},g);this.onUpdateTrigger({prev:t[1].x,new:((i-n.x)*l/s).toString()},["triggers",e,1,"x"],CONSTRAINTS.PAN_X,!0),this.onUpdateTrigger({prev:t[1].y,new:((a-n.y)*l/o).toString()},["triggers",e,1,"y"],CONSTRAINTS.PAN_Y,!0)}}render(){return this.componentManager.updateState(this.state),this.componentManager.main()}}class r{constructor(t){this.root=t,this.state=t.state}updateState(t){this.state=t}main(){var t=this.state;return g("div",{style:GLOBAL_STYLES.text},this.toolbar(),t.active&&g("div",{style:STYLES.content},t.settingsActive&&this.settingsContainer(),!t.settingsActive&&this.tabContainer(),!t.settingsActive&&this.window()))}toolbar(){let{root:e,state:t}=this;return g("div",{style:STYLES.toolbar.container},!t.active&&this.toolbarButton(0,"Maximize",!1,()=>e.onActivate(),FICON_MAXIMIZE),t.active&&g("div",{style:Object.assign(Object.assign({},STYLES.toolbar.container),{justifyContent:"start"})},this.toolbarButton(0,"Minimize",!1,()=>e.onActivate(),FICON_MINIMIZE),this.toolbarButton(1,"Download",!1,()=>e.onDownload(),FICON_DOWNLOAD),this.toolbarButton(2,"Upload",!1,()=>e.onClickFile(),FICON_UPLOAD),this.toolbarButton(3,"Load From Script",!1,()=>e.onLoadScript(),FICON_CORNER_UP_RIGHT),this.toolbarButton(4,"Run",t.invalidTimes.some(t=>t),()=>e.onTest(),FICON_PLAY),this.toolbarButton(5,"Copy Script",!1,async()=>e.onCopy(),FICON_COPY)),t.active&&g("div",{style:Object.assign(Object.assign({},STYLES.toolbar.container),{justifyContent:"end"})},this.toolbarButton(6,"Undo",0===e.triggerManager.undoLen,()=>e.onUndo(),FICON_ARROW_LEFT),this.toolbarButton(7,"Redo",0===e.triggerManager.redoLen,()=>e.onRedo(),FICON_ARROW_RIGHT),this.toolbarButton(8,"Settings",!1,()=>e.onToggleSettings(),FICON_SETTINGS),this.toolbarButton(9,"Report Issue",!1,()=>e.onReport(),FICON_FLAG),this.toolbarButton(10,"Help",!1,()=>e.onHelp(),FICON_HELP_CIRCLE)),g("input",{id:"trigger-file-upload",style:{display:"none"},type:"file",accept:".json",onChange:t=>e.onLoadFile(t.target.files[0])}))}toolbarButton(t,e,r,i,a){let{root:n,state:s}=this;return r&&s.toolbarColors[t]!==TOOLBAR_COLOR.NONE&&n.onUpdateToolbarColor(t,TOOLBAR_COLOR.NONE),g("button",{title:e,style:Object.assign(Object.assign({},STYLES.button.embedded),{backgroundColor:STYLES.button.embedded.bgColor[s.toolbarColors[t]]}),onMouseOver:()=>!r&&n.onUpdateToolbarColor(t,TOOLBAR_COLOR.HOVER),onMouseOut:()=>!r&&n.onUpdateToolbarColor(t,TOOLBAR_COLOR.NONE),onMouseDown:()=>!r&&n.onUpdateToolbarColor(t,TOOLBAR_COLOR.ACTIVE),onMouseUp:()=>!r&&n.onUpdateToolbarColor(t,TOOLBAR_COLOR.HOVER),onClick:i,disabled:r},g("span",Object.assign(Object.assign({},a),{style:{color:r?GLOBAL_STYLES.gray:GLOBAL_STYLES.black}})))}settingsContainer(){return g("div",{style:STYLES.settings.window},this.settingsHeader(),this.settings())}settingsHeader(){let{root:t,state:e}=this;return g("div",{style:STYLES.settings.header},g("button",{style:Object.assign(Object.assign({},STYLES.button.embedded),{position:"absolute",fontSize:"32px",right:"0px"}),onClick:()=>t.onToggleSettings()},g("span",FICON_X)),g("text",{style:{fontSize:GLOBAL_STYLES.textSizes.L[e.fontSize]}},"Settings"),g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{position:"absolute",fontSize:GLOBAL_STYLES.textSizes.M[e.fontSize],left:"0px",background:e.settingsDirty?GLOBAL_STYLES.light_gray3:GLOBAL_STYLES.dark_gray1}),disabled:!e.settingsDirty,onClick:()=>t.onApplySettings()},"Apply"))}settings(){let{root:t,state:e}=this;return g(window.React.Fragment,{style:{fontSize:GLOBAL_STYLES.textSizes.M[e.fontSize]}},g("div",{style:STYLES.settings.row},g("text",{style:Object.assign(Object.assign({},STYLES.settings.label),{fontSize:GLOBAL_STYLES.textSizes.S[e.fontSize]})},"Font Sizes"),g("div",{style:Object.assign(Object.assign({},STYLES.settings.parameter),{fontSize:GLOBAL_STYLES.textSizes.S[e.fontSize]})},g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.fontSizeSetting===SETTINGS[SETTINGS_KEY.FONT_SIZE].SMALL?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeFontSize(SETTINGS[SETTINGS_KEY.FONT_SIZE].SMALL)},g("text",null,"Small")),g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.fontSizeSetting===SETTINGS[SETTINGS_KEY.FONT_SIZE].MEDIUM?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeFontSize(SETTINGS[SETTINGS_KEY.FONT_SIZE].MEDIUM)},g("text",null,"Medium")),g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.fontSizeSetting===SETTINGS[SETTINGS_KEY.FONT_SIZE].LARGE?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeFontSize(SETTINGS[SETTINGS_KEY.FONT_SIZE].LARGE)},g("text",null,"Large")))),g("div",{style:STYLES.settings.row},g("text",{style:Object.assign(Object.assign({},STYLES.settings.label),{fontSize:GLOBAL_STYLES.textSizes.S[e.fontSize]})},"Viewport"),g("div",{style:Object.assign(Object.assign({},STYLES.settings.parameter),{fontSize:GLOBAL_STYLES.textSizes.S[e.fontSize]})},g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.resolutionSetting===SETTINGS[SETTINGS_KEY.VIEWPORT].HD.ID?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeViewport(SETTINGS[SETTINGS_KEY.VIEWPORT].HD.ID)},g("text",null,SETTINGS[SETTINGS_KEY.VIEWPORT].HD.NAME)),g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.resolutionSetting===SETTINGS[SETTINGS_KEY.VIEWPORT].FHD.ID?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeViewport(SETTINGS[SETTINGS_KEY.VIEWPORT].FHD.ID)},g("text",null,SETTINGS[SETTINGS_KEY.VIEWPORT].FHD.NAME)),g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.resolutionSetting===SETTINGS[SETTINGS_KEY.VIEWPORT].QHD.ID?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeViewport(SETTINGS[SETTINGS_KEY.VIEWPORT].QHD.ID)},g("text",null,SETTINGS[SETTINGS_KEY.VIEWPORT].QHD.NAME)),g("button",{style:Object.assign(Object.assign({},STYLES.button.settings),{backgroundColor:e.resolutionSetting===SETTINGS[SETTINGS_KEY.VIEWPORT].UHD.ID?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>t.onChangeViewport(SETTINGS[SETTINGS_KEY.VIEWPORT].UHD.ID)},g("text",null,SETTINGS[SETTINGS_KEY.VIEWPORT].UHD.NAME)))))}tabContainer(){return g("div",{style:STYLES.tabs.container},Object.keys(TRIGGER_PROPS).map(t=>g("div",null,this.tab(t))))}tab(t){let{root:e,state:r}=this;return g("button",{style:Object.assign(Object.assign({},STYLES.tabs.button),{backgroundColor:r.activeTab===t?GLOBAL_STYLES.light_gray1:GLOBAL_STYLES.dark_gray1}),onClick:()=>e.onChangeTab(t)},g("text",{style:{fontSize:GLOBAL_STYLES.textSizes.S[r.fontSize]}},TRIGGER_PROPS[t].DISPLAY_NAME))}window(){var{state:t,root:e}=this,e=e.triggerManager.data[t.activeTab];return e.id===TRIGGER_ID.SKIN?g("div",{style:STYLES.window},this.skinEditorToolbar(t.skinEditorSelectedRider),this.skinEditor(e.triggers)):e.id===TRIGGER_ID.GRAVITY?g("div",{style:STYLES.window},Object.keys(e.triggers).map(t=>this.trigger(parseInt(t,10)))):g("div",{style:STYLES.window},this.smoothTab(),Object.keys(e.triggers).map(t=>this.trigger(parseInt(t,10))))}smoothTab(){let{root:e,state:t}=this,r=e.triggerManager.data[t.activeTab];return g("div",{style:STYLES.smooth.container},g("label",{for:"smoothTextInput",style:{fontSize:GLOBAL_STYLES.textSizes.S[t.fontSize]}},"Smoothing"),r.id!==TRIGGER_ID.TIME&&g("input",{id:"smoothTextInput",style:Object.assign(Object.assign({},STYLES.smooth.input),{fontSize:GLOBAL_STYLES.textSizes.S[t.fontSize],marginLeft:"5px"}),value:r.smoothing,onChange:t=>e.onUpdateTrigger({prev:r.smoothing,new:t.target.value},["smoothing"],CONSTRAINTS.SMOOTH),onBlur:t=>e.onUpdateTrigger({prev:r.smoothing,new:t.target.value},["smoothing"],CONSTRAINTS.SMOOTH,!0)}),r.id===TRIGGER_ID.TIME&&g("div",{style:STYLES.checkbox.container},g("input",{id:"smoothTextInput",style:STYLES.checkbox.primary,type:"checkbox",onChange:()=>e.onUpdateTrigger({prev:e.triggerManager.data[t.activeTab].interpolate,new:!e.triggerManager.data[t.activeTab].interpolate},["interpolate"],CONSTRAINTS.INTERPOLATE)}),r.interpolate&&g("square",{style:STYLES.checkbox.fill})))}trigger(t){let{root:e,state:r}=this;var i=e.triggerManager.data[r.activeTab],a=i.triggers[t];return g("div",{style:Object.assign(Object.assign({},STYLES.trigger.container),{fontSize:GLOBAL_STYLES.textSizes.M[r.fontSize],backgroundColor:0===t?GLOBAL_STYLES.gray:GLOBAL_STYLES.white})},g("button",{style:Object.assign(Object.assign({},STYLES.button.embedded),{fontSize:"22px",position:"absolute",right:"0px"}),disabled:0===t,onClick:()=>e.onDeleteTrigger(t)},g("span",Object.assign(Object.assign({},FICON_X),{style:{color:0===t?GLOBAL_STYLES.dark_gray2:GLOBAL_STYLES.black}}))),i.id!==TRIGGER_ID.SKIN&&this.timeStamp(a[0],t),i.id===TRIGGER_ID.ZOOM&&this.captureButton(a,t,TRIGGER_ID.ZOOM),i.id===TRIGGER_ID.PAN&&this.captureButton(a,t,TRIGGER_ID.PAN),i.id===TRIGGER_ID.ZOOM&&this.zoomTrigger(a,t),i.id===TRIGGER_ID.PAN&&this.cameraPanTrigger(a,t),i.id===TRIGGER_ID.FOCUS&&this.cameraFocusTrigger(a,t),i.id===TRIGGER_ID.TIME&&this.timeRemapTrigger(a,t),i.id===TRIGGER_ID.SKIN&&!1,i.id===TRIGGER_ID.GRAVITY&&this.gravityTrigger(a,t),g("button",{style:STYLES.trigger.createButton,onClick:()=>e.onCreateTrigger(t)},g("span",FICON_PLUS)))}timeStamp(t,i){let{root:a,state:n}=this,s=[CONSTRAINTS.MINUTE,CONSTRAINTS.SECOND,CONSTRAINTS.FRAME];return g("div",{style:STYLES.trigger.property},t.map((e,r)=>g("div",null,g("text",{style:STYLES.trigger.text},["Time",":",":"][r]),g("input",{style:Object.assign(Object.assign({},STYLES.trigger.input),{color:n.invalidTimes[i]?"red":"black"}),value:e,onChange:t=>a.onUpdateTrigger({prev:e,new:t.target.value},["triggers",i,0,r],s[r]),onBlur:t=>a.onUpdateTrigger({prev:e,new:t.target.value},["triggers",i,0,r],s[r],!0)}))))}captureButton(t,e,r){let i=this.root;return g("button",{style:Object.assign(Object.assign({},STYLES.button.embedded),{fontSize:"22px",position:"absolute",right:"25px"}),onClick:()=>i.onCameraDataCapture(t,e,r)},g("span",Object.assign({},FICON_CAMERA)))}zoomTrigger(e,r){let i=this.root;var t=["Zoom To"];return g("div",{style:STYLES.trigger.property},g("label",{for:`zoomTriggerText_${t[0]}_`+r,style:STYLES.trigger.text},t[0]),g("input",{id:`zoomTriggerText_${t[0]}_`+r,style:STYLES.trigger.input,value:e[1],onChange:t=>i.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],CONSTRAINTS.ZOOM),onBlur:t=>i.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],CONSTRAINTS.ZOOM,!0)}))}cameraPanTrigger(a,n){let s=this.root,o=[CONSTRAINTS.PAN_WIDTH,CONSTRAINTS.PAN_HEIGHT,CONSTRAINTS.PAN_X,CONSTRAINTS.PAN_Y],l=["Width","Height","Offset X","Offset Y"];return g(window.React.Fragment,null,[["w","h"],["x","y"]].map((t,i)=>g("div",{style:{display:"flex",flexDirection:"row"}},t.map((e,r)=>g("div",{style:STYLES.trigger.property},g("label",{for:`camTriggerText_${l[r+2*i]}_`+n,style:STYLES.trigger.text},l[r+2*i]),g("input",{id:`camTriggerText_${l[r+2*i]}_`+n,style:STYLES.trigger.input,value:a[1][e],onChange:t=>s.onUpdateTrigger({prev:a[1][e],new:t.target.value},["triggers",n,1,e],o[r+2*i]),onBlur:t=>s.onUpdateTrigger({prev:a[1][e],new:t.target.value},["triggers",n,1,e],o[r+2*i],!0)}))))))}cameraFocusTrigger(e,r){let{root:i,state:t}=this,a=t.focusDDIndices[r];var n=["Weight"];return g("div",{style:STYLES.trigger.property},g("select",{style:STYLES.dropdown.head,value:a,onChange:t=>i.onChangeFocusDD(r,t.target.value)},Object.keys(e[1]).map(t=>{var e=1+parseInt(t,10);return g("option",{style:STYLES.dropdown.option,value:parseInt(t,10)},g("text",null,"Rider "+e))})),g("label",{for:`focusTriggerText_${n[0]}_${a}_`+r,style:STYLES.trigger.text},n[0]),g("input",{id:`focusTriggerText_${n[0]}_${a}_`+r,style:STYLES.trigger.input,value:e[1][a],onChange:t=>i.onUpdateTrigger({prev:e[1][a],new:t.target.value},["triggers",r,1,a],CONSTRAINTS.FOCUS_WEIGHT),onBlur:t=>i.onUpdateTrigger({prev:e[1][a],new:t.target.value},["triggers",r,1,a],CONSTRAINTS.FOCUS_WEIGHT,!0)}))}timeRemapTrigger(e,r){let i=this.root;var t=["Speed"];return g("div",{style:STYLES.trigger.property},g("label",{for:`timeTriggerText_${t[0]}_`+r,style:STYLES.trigger.text},t[0]),g("input",{id:`timeTriggerText_${t[0]}_`+r,style:STYLES.trigger.input,value:e[1],onChange:t=>i.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],CONSTRAINTS.TIME_SPEED),onBlur:t=>i.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],CONSTRAINTS.TIME_SPEED,!0)}))}gravityTrigger(i,a){let{root:n,state:t}=this,s=[CONSTRAINTS.GRAVITY_X,CONSTRAINTS.GRAVITY_Y],o=["X","Y"];let l=t.gravityDDIndices[a];return g("div",{style:{display:"flex",flexDirection:"row"}},g("select",{style:STYLES.dropdown.head,value:l,onChange:t=>n.onChangeGravityDD(a,t.target.value)},Object.keys(i[1]).map(t=>{var e=1+parseInt(t,10);return g("option",{style:STYLES.dropdown.option,value:parseInt(t,10)},g("text",null,"Rider "+e))})),["x","y"].map((e,r)=>g("div",{style:STYLES.trigger.property},g("label",{for:`gravityTriggerText_${o[r]}_${l}_`+a,style:STYLES.trigger.text},o[r]),g("input",{id:`gravityTriggerText_${o[r]}_${l}_`+a,style:STYLES.trigger.input,value:i[1][l][e],onChange:t=>n.onUpdateTrigger({prev:i[1][l][e],new:t.target.value},["triggers",a,1,l,e],s[r]),onBlur:t=>n.onUpdateTrigger({prev:i[1][l][e],new:t.target.value},["triggers",a,1,l,e],s[r],!0)}))))}skinEditor(t){let{root:e,state:r}=this,i=r.skinEditorSelectedRider;return g("div",{style:STYLES.skinEditor.container},g("div",{style:STYLES.skinEditor.background}),g("div",{id:"skinElementContainer",style:Object.assign(Object.assign({},STYLES.skinEditor.canvas),{transform:`scale(${r.skinEditorZoom[0]})`,transformOrigin:`${r.skinEditorZoom[1]}px ${r.skinEditorZoom[2]}px`}),onWheel:t=>e.onZoomSkinEditor(t,!0)},this.flagSvg(t[i],i),g("svg",{width:"10vw"}),this.riderSvg(t[i],i)),g("div",{style:STYLES.skinEditor.zoomContainer},g("input",{style:{height:"10px"},type:"range",min:CONSTRAINTS.SKIN_ZOOM.MIN,max:CONSTRAINTS.SKIN_ZOOM.MAX,step:.1,value:r.skinEditorZoom[0],onChange:t=>e.onZoomSkinEditor(t,!1)}),g("text",{style:{fontSize:GLOBAL_STYLES.textSizes.S[r.fontSize]}},"x"+Math.round(10*r.skinEditorZoom[0])/10)),g("div",{style:STYLES.skinEditor.outlineColor.container},g("text",{style:{fontSize:GLOBAL_STYLES.textSizes.S[r.fontSize]}},"Outline"),g("div",{style:Object.assign(Object.assign({},STYLES.skinEditor.outlineColor.input),{backgroundColor:t[i].outline.stroke}),onClick:()=>e.onUpdateTrigger({new:r.skinEditorSelectedColor},["triggers",i,"outline","stroke"])})))}skinEditorToolbar(t){let{root:e,state:r}=this;var i=e.triggerManager.data[TRIGGER_ID.SKIN].triggers,a=r.skinEditorSelectedColor.substring(0,7),n=parseInt(r.skinEditorSelectedColor.substring(7),16)/255;return g("div",{style:STYLES.skinEditor.toolbar},g("button",{style:Object.assign(Object.assign({},STYLES.button.embedded),{fontSize:"32px",position:"absolute",right:"10px"}),onClick:()=>e.onResetSkin(t)},g("span",FICON_TRASH2)),g("div",{style:Object.assign(Object.assign(Object.assign({},STYLES.skinEditor.toolbarItem),STYLES.alpha.container),{fontSize:GLOBAL_STYLES.textSizes.S[r.fontSize]})},g("label",{for:"alphaSlider"},"Transparency"),g("div",{style:STYLES.alpha.sliderContainer},g("input",{id:"alphaSlider",style:STYLES.alpha.slider,type:"range",min:CONSTRAINTS.ALPHA_SLIDER.MIN,max:CONSTRAINTS.ALPHA_SLIDER.MAX,step:.01,value:n,onChange:t=>e.onChangeColor(void 0,t.target.value)}))),g("input",{style:Object.assign(Object.assign({},STYLES.skinEditor.toolbarItem),{height:"40px",width:"40px"}),type:"color",value:a,onChange:t=>e.onChangeColor(t.target.value,void 0)}),g("select",{style:Object.assign(Object.assign(Object.assign({},STYLES.skinEditor.toolbarItem),STYLES.dropdown.head),{fontSize:GLOBAL_STYLES.textSizes.M[r.fontSize]}),value:t,onChange:t=>e.onChangeSkinDD(t.target.value)},Object.keys(i).map(t=>{var e=1+parseInt(t,10);return g("option",{style:STYLES.dropdown.option,value:parseInt(t,10)},g("text",null,"Rider "+e))})))}flagSvg(t,e){let{root:r,state:i}=this,a=i.skinEditorSelectedColor;return g("svg",{height:"18",width:"15",style:{transform:"scale(5)"}},g("path",Object.assign(Object.assign({},STYLES.riderProps.flag),{fill:t.flag.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"flag","fill"])})),g("path",Object.assign(Object.assign({},STYLES.riderProps.flagOutline),{fill:t.flag.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"flag","fill"])})))}riderSvg(t,e){let{root:r,state:i}=this,a=i.skinEditorSelectedColor;return g("svg",{height:"25",width:"31",style:{transform:"scale(5)"}},g("rect",Object.assign(Object.assign({},STYLES.riderProps.skin),{fill:t.skin.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"skin","fill"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.nose),{stroke:t.outline.stroke,fill:t.skin.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"skin","fill"])})),g("rect",Object.assign(Object.assign({},STYLES.riderProps.hair),{fill:t.hair.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"hair","fill"])})),g("rect",Object.assign(Object.assign({},STYLES.riderProps.faceOutline),{fill:t.hair.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"hair","fill"])})),g("rect",Object.assign(Object.assign({},STYLES.riderProps.hairFill),{fill:t.fill.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"fill","fill"])})),g("polygon",Object.assign(Object.assign({},STYLES.riderProps.eye),{fill:t.eye.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"eye","fill"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.sled),{stroke:t.outline.stroke,fill:t.sled.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"sled","fill"])})),g("line",Object.assign(Object.assign({},STYLES.riderProps.string),{stroke:t.string.stroke,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"string","stroke"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.armHand),{stroke:t.outline.stroke,fill:t.armHand.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"armHand","fill"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.legPants),{stroke:t.outline.stroke,fill:t.legPants.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"legPants","fill"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.legFoot),{stroke:t.outline.stroke,fill:t.legFoot.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"legFoot","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfEven),STYLES.riderProps.id_scarf0a),{fill:t.id_scarf0.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf0","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfEven),STYLES.riderProps.id_scarf0b),{fill:t.id_scarf0.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf0","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfOdd),STYLES.riderProps.id_scarf1),{fill:t.id_scarf1.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf1","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfOdd),STYLES.riderProps.id_scarf2),{fill:t.id_scarf2.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf2","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfOdd),STYLES.riderProps.id_scarf3),{fill:t.id_scarf3.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf3","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfOdd),STYLES.riderProps.id_scarf4),{fill:t.id_scarf4.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf4","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.id_scarfOdd),STYLES.riderProps.id_scarf5),{fill:t.id_scarf5.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"id_scarf5","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.torso),{stroke:t.outline.stroke,fill:t.torso.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"torso","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.scarfOdd),STYLES.riderProps.scarf1),{fill:t.scarf1.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"scarf1","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.scarfOdd),STYLES.riderProps.scarf2),{fill:t.scarf2.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"scarf2","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.scarfOdd),STYLES.riderProps.scarf3),{fill:t.scarf3.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"scarf3","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.scarfOdd),STYLES.riderProps.scarf4),{fill:t.scarf4.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"scarf4","fill"])})),g("rect",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.scarfOdd),STYLES.riderProps.scarf5),{fill:t.scarf5.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"scarf5","fill"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.hatTop),{stroke:t.outline.stroke,fill:t.hatTop.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"hatTop","fill"])})),g("path",Object.assign(Object.assign({},STYLES.riderProps.hatBottom),{stroke:t.hatBottom.stroke,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"hatBottom","stroke"])})),g("circle",Object.assign(Object.assign({},STYLES.riderProps.hatBall),{fill:t.hatBall.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"hatBall","fill"])})),g("path",Object.assign(Object.assign(Object.assign({},STYLES.riderProps.outline),STYLES.riderProps.armSleeve),{stroke:t.outline.stroke,fill:t.armSleeve.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",e,"armSleeve","fill"])})))}}return e}let head='<svg style="display: block" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">',tail="</svg>",FICON_DOWNLOAD={dangerouslySetInnerHTML:{__html:head+'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line>'+tail}},FICON_CORNER_UP_RIGHT={dangerouslySetInnerHTML:{__html:head+'<polyline points="15 14 20 9 15 4"></polyline><path d="M4 20v-7a4 4 0 0 1 4-4h12"></path>'+tail}},FICON_PLAY={dangerouslySetInnerHTML:{__html:head+'<polygon points="5 3 19 12 5 21 5 3"></polygon>'+tail}},FICON_COPY={dangerouslySetInnerHTML:{__html:head+'<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>'+tail}},FICON_UPLOAD={dangerouslySetInnerHTML:{__html:head+'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line>'+tail}},FICON_SETTINGS={dangerouslySetInnerHTML:{__html:head+'<circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>'+tail}},FICON_FLAG={dangerouslySetInnerHTML:{__html:head+'<path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line>'+tail}},FICON_HELP_CIRCLE={dangerouslySetInnerHTML:{__html:head+'<circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line>'+tail}},FICON_MINIMIZE={dangerouslySetInnerHTML:{__html:head+'<path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>'+tail}},FICON_MAXIMIZE={dangerouslySetInnerHTML:{__html:head+'<path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>'+tail}},FICON_PLUS={dangerouslySetInnerHTML:{__html:head+'<line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>'+tail}},FICON_PLUS_CIRCLE={dangerouslySetInnerHTML:{__html:head+'<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line>'+tail}},FICON_X={dangerouslySetInnerHTML:{__html:head+'<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'+tail}},FICON_TRASH2={dangerouslySetInnerHTML:{__html:head+'<polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>'+tail}},FICON_ARROW_LEFT={dangerouslySetInnerHTML:{__html:head+'<line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline>'+tail}},FICON_ARROW_RIGHT={dangerouslySetInnerHTML:{__html:head+'<line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline>'+tail}},FICON_CAMERA={dangerouslySetInnerHTML:{__html:head+'<path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle>'+tail}},GLOBAL_STYLES=((t=>{t[t.NONE=0]="NONE",t[t.HOVER=1]="HOVER",t[t.ACTIVE=2]="ACTIVE"})(TOOLBAR_COLOR=TOOLBAR_COLOR||{}),{black:"#000000",dark_gray1:"#b7b7b7",dark_gray2:"#999999",dark_gray3:"#666666",dark_gray4:"#434343",gray:"#cccccc",light_gray1:"#d9d9d9",light_gray2:"#efefef",light_gray3:"#f3f3f3",white:"#ffffff",text:{fontFamily:"Helvetica",fontWeight:"bold"},textSizes:{S:["12px","14px","18px"],M:["18px","22px","24px"],L:["28px","32px","36px"]},centerX:{left:"0px",right:"0px",marginLeft:"auto",marginRight:"auto"}}),STYLES={root:{backgroundColor:GLOBAL_STYLES.light_gray3,transition:"opacity 225ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",border:"2px solid black",left:"50px",opacity:0,overflow:"hidden",padding:"1vh",pointerEvents:"none",position:"fixed",top:"12.5px"},content:{alignItems:"center",display:"flex",height:"clamp(250px, 60vh, 450px)",flexDirection:"column",justifyContent:"center",paddingTop:"1vh",width:"clamp(425px, 40vw, 650px)"},button:{embedded:{alignItems:"center",background:"none",bgColor:["transparent",GLOBAL_STYLES.dark_gray1,GLOBAL_STYLES.light_gray1],borderRadius:"0.5em",border:"none",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em"},filled:{alignItems:"center",backgroundColor:GLOBAL_STYLES.white,border:"2px solid black",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em"},settings:{border:"2px solid black",borderRadius:"5px",margin:"5px"}},toolbar:{container:{alignItems:"start",display:"flex",flex:1,fontSize:"25px",width:"100%"}},settings:{window:{backgroundColor:GLOBAL_STYLES.white,border:"2px solid black",display:"flex",flexDirection:"column",flex:9,overflow:"auto",position:"relative",width:"100%"},header:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:"3em",margin:"10px",position:"relative"},row:{alignItems:"center",display:"flex",flexDirection:"row",height:"1.5em",minHeight:"3em",padding:"1em"},label:{position:"absolute",left:"5px"},parameter:{position:"absolute",right:"5px"}},tabs:{container:{alignItems:"end",display:"flex",justifyContent:"start",flexDirection:"row",overflowX:"auto",width:"100%"},button:{border:"2px solid black",borderBottom:"0px solid black",borderTopLeftRadius:"8px",borderTopRightRadius:"8px"}},smooth:{container:{alignItems:"center",backgroundColor:GLOBAL_STYLES.white,borderBottom:"1px solid black",display:"flex",height:"3em",justifyContent:"start",padding:".5em"},input:{backgroundColor:GLOBAL_STYLES.white,overflow:"hidden",textAlign:"center",width:"3em"}},checkbox:{container:{alignItems:"center",display:"flex",height:"20px",justifyContent:"center",marginLeft:"5px",position:"relative",width:"20px"},primary:{appearance:"none",background:"#FFF",border:"2px solid black",height:"100%",position:"absolute",width:"100%"},fill:{backgroundColor:"#000",height:"60%",pointerEvents:"none",position:"absolute",width:"60%"}},window:{backgroundColor:GLOBAL_STYLES.white,border:"2px solid black",display:"flex",flexDirection:"column",flex:9,overflowY:"scroll",width:"100%"},trigger:{container:{alignItems:"start",border:"1px solid black",display:"flex",flexDirection:"column",padding:"12px",position:"relative"},property:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"start",marginBottom:"0.25em",width:"100%",whiteSpace:"nowrap"},input:{height:"2ch",padding:"5px",textAlign:"right",width:"3em"},text:{margin:"0em .5em"},createButton:Object.assign(Object.assign({},GLOBAL_STYLES.centerX),{alignItems:"center",backgroundColor:GLOBAL_STYLES.white,bottom:"-0.75em",border:"2px solid black",display:"flex",fontSize:"18px",height:"1.5em",justifyContent:"center",position:"absolute",userSelect:"none",width:"1.5em",zIndex:1})},dropdown:{head:{height:"3ch",marginRight:"10px",textAlign:"right"},option:{height:"2ch",textAlign:"center"}},skinEditor:{container:{alignItems:"center",display:"flex",flex:5,justifyContent:"center",overflow:"hidden",position:"relative",userSelect:"none",width:"100%"},background:{background:"linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%), linear-gradient(-45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%)",backgroundSize:"10px 10px",height:"100vh",position:"absolute",transform:"rotate(45deg)",width:"100vw"},toolbar:{alignItems:"center",backgroundColor:GLOBAL_STYLES.light_gray1,borderBottom:"3px solid black",flex:1,display:"flex",justifyContent:"left",position:"relative",userSelect:"none"},toolbarItem:{margin:"0px 5px"},canvas:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",position:"absolute",width:"100%"},outlineColor:{container:{alignItems:"center",display:"flex",position:"absolute",bottom:"10px",left:"10px"},input:{border:"1px solid black",borderRadius:"10px",height:"20px",marginLeft:"5px",width:"20px"}},zoomContainer:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"center",left:"20px",position:"absolute",top:"20px",height:"0px"}},alpha:{container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},sliderContainer:{alignItems:"center",display:"flex",position:"relative"},slider:{appearance:"none",background:"linear-gradient(to left, black, white)",border:"1px solid black",borderRadius:"5px",height:"8px",margin:"5px",marginTop:"10px",opacity:.7,width:"100px"}},riderProps:{outline:{strokeWidth:.3},flag:{transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3Z"},flagOutline:{transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z"},skin:{transform:"translate(13,8) rotate(-90)",width:"3.1",height:"4.5"},hair:{transform:"translate(12.4, 5.15) rotate(-90)",width:"0.3",height:"5.1"},faceOutline:{transform:"translate(12.2, 8.1) rotate(-90)",width:"3.1",height:"0.3"},hairFill:{transform:"translate(12.2,4.2) scale(0.8,0.8)",width:"3.1",height:"4.8"},eye:{transform:"translate(16.3,6.7)",points:"0.4,-0.4 0,-0.5 -0.4,-0.4 -0.5,0 -0.4,0.4 0,0.5 0.4,0.4 0.5,0"},nose:{transform:"translate(17.3,8.1) rotate(-90)",d:"M 0 -0.25 v 0.4 c 0.1 1.3 1.2 1.2 3.1 0 v -0.4"},sled:{transform:"translate(9.7, 15.9) scale(1.04,1)",d:"M13.6-2.2c-1.35,0-2.55,0.75-3.15,1.85H0C-0.2-0.35-0.35-0.2-0.35,0S-0.2,0.35,0,0.35h1.75V4.4H-0.2c-0.2,0-0.35,0.15-0.35,0.35S-0.4,5.1-0.2,5.1h13.8c2,0,3.65-1.65,3.65-3.65S15.6-2.2,13.6-2.2zM9.05,4.4h-6.6V0.35h6.6V4.4z M13.6,4.4H9.75V0.35h0.35C10.05,0.5,10,0.7,10,0.9c0,0.2,0.15,0.35,0.35,0.35c0.15,0,0.3-0.1,0.35-0.25c0.05-0.2,0.1-0.45,0.2-0.65h0.9c0.2,0,0.35-0.15,0.35-0.35S12-0.35,11.8-0.35h-0.5c0.5-0.7,1.35-1.15,2.3-1.15c1.65,0,2.95,1.3,2.95,2.95C16.55,3.1,15.25,4.4,13.6,4.4z"},string:{transform:"translate(21.5, 10.5) rotate(40)",x1:"0",y1:"0",x2:"8",y2:"0",strokeWidth:"0.3"},armSleeve:{transform:"translate(15, 10) rotate(5)",d:"M5,0.7H0c-0.4,0-0.7-0.3-0.7-0.7S-0.4-0.7,0-0.7h5"},armHand:{transform:"translate(15, 10) rotate(5)",d:"M5-0.7h0.5c0,0,0.3-0.7,0.5-0.6c0.2,0.1,0,0.6,0,0.6s0.4,0,0.6,0c0.2,0,0.5,0.3,0.5,0.7c0,0.4-0.2,0.7-0.5,0.7c-0.5,0-1.6,0-1.6,0"},legPants:{transform:"translate(15, 16) rotate(45)",d:"M4.8-0.7H0c-0.4,0-0.7,0.3-0.7,0.7S-0.4,0.7,0,0.7h4.8"},legFoot:{transform:"translate(15, 16) rotate(45)",d:"M4.8,0.7h2.4l0-2.7L6.7-2L6-0.7H4.8"},torso:{transform:"translate(16.9, 8.1) rotate(90)",width:"7.8",height:"4.4"},scarfEven:{transform:"translate(14.8, 15.2) rotate(-90)"},scarfOdd:{transform:"translate(14.8, 15.2) rotate(-90)"},scarf1:{strokeWidth:"0",x:"5.2",y:"1.5",width:"2",height:"1"},scarf2:{strokeWidth:"0",x:"5.2",y:"0.5",width:"2",height:"1"},scarf3:{strokeWidth:"0",x:"5.2",y:"-0.5",width:"2",height:"1"},scarf4:{strokeWidth:"0",x:"5.2",y:"-1.5",width:"2",height:"1"},scarf5:{strokeWidth:"0",x:"5.2",y:"-2.5",width:"2",height:"1"},hatTop:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",d:"M11-2.6h-0.4v5.2H11c1.2,0,2.2-1.2,2.2-2.6S12.2-2.6,11-2.6z"},hatBottom:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",strokeWidth:1,strokeLinecap:"round",d:"M10.6-2.6 v5.2"},hatBall:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",cx:"13.9",cy:"0",r:"0.7"},id_scarfEven:{transform:"translate(10.5, 8.5)"},id_scarfOdd:{transform:"translate(10.5, 8.5)"},id_scarf0a:{strokeWidth:"0",x:"2",width:"2",height:"2"},id_scarf0b:{strokeWidth:"0",x:"0",width:"2",height:"2"},id_scarf1:{strokeWidth:"0",x:"-2",width:"2",height:"2"},id_scarf2:{strokeWidth:"0",x:"-4",width:"2",height:"2"},id_scarf3:{strokeWidth:"0",x:"-6",width:"2",height:"2"},id_scarf4:{strokeWidth:"0",x:"-8",width:"2",height:"2"},id_scarf5:{strokeWidth:"0",x:"-10",width:"2",height:"2"}}};class FileParser{constructor(){this.triggerData=TriggerDataManager.initialTriggerData}parseFile(t,r){return this.triggerData=TriggerDataManager.initialTriggerData,Object.keys(TRIGGER_PROPS).forEach(e=>{try{this.triggerData[e].triggers=[],this.parseCommand(e,t)}catch(t){console.warn("[ScriptParser.parseScript()] "+t.message),this.triggerData[e]=structuredClone(r[e])}}),this.triggerData}parseCommand(t,e){if(void 0===e[t])throw new Error(`Command ${t} not found!`);switch(t){case TRIGGER_ID.ZOOM:case TRIGGER_ID.PAN:case TRIGGER_ID.FOCUS:this.parseTriggers(t,e[t].triggers),this.parseSmoothing(t,e[t].smoothing);case TRIGGER_ID.TIME:this.parseTriggers(t,e[t].triggers),this.parseSmoothing(t,e[t].interpolate);break;case TRIGGER_ID.SKIN:this.parseSkinTriggers(e[t].triggers);break;case TRIGGER_ID.GRAVITY:this.parseTriggers(t,e[t].triggers)}}parseTriggers(e,r){var i=[];for(let t=0;t<r.length;t+=1){var a,n=structuredClone(r[t]),s=r[t][0];"number"==typeof s?n[0]=this.retrieveTimestamp(s):1===s.length?(a=s[0],n[0]=this.retrieveTimestamp(a)):2===s.length?(a=40*s[0]+s[1],n[0]=this.retrieveTimestamp(a)):(s=2400*s[0]+40*s[1]+s[2],n[0]=this.retrieveTimestamp(s)),e===TRIGGER_ID.GRAVITY&&void 0===n[1].length&&(n[1]=[n[1]]),i.push(n)}this.triggerData[e].triggers=i}parseSmoothing(t,e){if(t===TRIGGER_ID.TIME){var r=CONSTRAINTS.INTERPOLATE;if(null==e)this.triggerData[t].interpolate=r.DEFAULT;else{if(!0!==e&&!1!==e)throw new Error("Invalid boolean!");this.triggerData[t].interpolate=e}}else{r=CONSTRAINTS.SMOOTH;if(null==e)this.triggerData[t].smoothing=r.DEFAULT;else{if("number"!=typeof e)throw new Error("Invalid integer!");e>r.MAX?this.triggerData[t].smoothing=r.MAX:e<r.MIN?this.triggerData[t].smoothing=r.MIN:this.triggerData[t].smoothing=e}}}parseSkinTriggers(t){var e,r=[];for(e of t){var i,a=structuredClone(TRIGGER_PROPS[TRIGGER_ID.SKIN].TEMPLATE);for(i of Object.keys(a))void 0!==e[i]&&(void 0!==e[i].fill&&(a[i].fill=e[i].fill),void 0!==e[i].stroke)&&(a[i].stroke=e[i].stroke);r.push(a)}this.triggerData[TRIGGER_ID.SKIN].triggers=r}retrieveTimestamp(t){var e=t%40,r=Math.floor(t/40)%60;return[Math.floor(t/2400),r,e]}}class ScriptParser{constructor(){this.triggerData=TriggerDataManager.initialTriggerData}parseScript(t,r){this.triggerData=TriggerDataManager.initialTriggerData;let i=t.replace(/\s/g,"");return Object.keys(TRIGGER_PROPS).forEach(e=>{try{this.triggerData[e].triggers=[],this.parseCommand(e,i)}catch(t){console.warn("[ScriptParser.parseScript()] "+t.message),this.triggerData[e]=structuredClone(r[e])}}),this.triggerData}parseCommand(commandId,scriptSection){if(commandId===TRIGGER_ID.GRAVITY)throw new Error("Gravity parsing not supported!");if(void 0===TRIGGER_PROPS[commandId].FUNC)throw new Error("Function undefined!");let currentHeader=TRIGGER_PROPS[commandId].FUNC.split("(")[0],currentHeaderIndex=scriptSection.indexOf(currentHeader);if(-1===currentHeaderIndex)throw new Error("Command header not found!");let startIndex=currentHeaderIndex+currentHeader.length+1,endIndex=startIndex;for(let i=1;0<i||endIndex>=scriptSection.length;endIndex+=1)"("===scriptSection.charAt(endIndex+1)&&(i+=1),")"===scriptSection.charAt(endIndex+1)&&--i;let parameterText=`[${this.removeLeadingZeroes(scriptSection.substring(startIndex,endIndex),commandId)}]`,parameterArray=eval(parameterText),[keyframes,smoothing]=parameterArray;switch(commandId){case TRIGGER_ID.ZOOM:case TRIGGER_ID.PAN:case TRIGGER_ID.FOCUS:case TRIGGER_ID.TIME:this.parseTriggers(commandId,keyframes),this.parseSmoothing(commandId,smoothing);break;case TRIGGER_ID.SKIN:this.parseSkinCss(keyframes)}}parseTriggers(t,e){var r=[];for(let t=0;t<e.length;t+=1){r.push(structuredClone(e[t]));var i,a=e[t][0];"number"==typeof a?r[t][0]=this.retrieveTimestamp(a):1===a.length?(i=a[0],r[t][0]=this.retrieveTimestamp(i)):2===a.length?(i=40*a[0]+a[1],r[t][0]=this.retrieveTimestamp(i)):(a=2400*a[0]+40*a[1]+a[2],r[t][0]=this.retrieveTimestamp(a))}this.triggerData[t].triggers=r}parseSmoothing(t,e){if(t===TRIGGER_ID.TIME){var r=CONSTRAINTS.INTERPOLATE;if(null==e)this.triggerData[t].interpolate=r.DEFAULT;else{if(!0!==e&&!1!==e)throw new Error("Invalid boolean!");this.triggerData[t].interpolate=e}}else{r=CONSTRAINTS.SMOOTH;if(null==e)this.triggerData[t].smoothing=r.DEFAULT;else{if("number"!=typeof e)throw new Error("Invalid integer!");e>r.MAX?this.triggerData[t].smoothing=r.MAX:e<r.MIN?this.triggerData[t].smoothing=r.MIN:this.triggerData[t].smoothing=e}}}parseSkinCss(t){t.forEach((e,r)=>{this.triggerData[TRIGGER_ID.SKIN].triggers.push(structuredClone(TRIGGER_PROPS[TRIGGER_ID.SKIN].TEMPLATE));let i=0,a=0;for(let t=0;t<e.length;t+=1)"{"===e.charAt(t)&&(i+=1),"}"===e.charAt(t)&&0===--i&&(this.parseSkinProp(e.substring(a,t+1).replace(/\s/g,""),r),a=t+1)}),0<this.triggerData[TRIGGER_ID.SKIN].triggers.length&&this.triggerData[TRIGGER_ID.SKIN].triggers.push(null!=(t=this.triggerData[TRIGGER_ID.SKIN].triggers.shift())?t:TRIGGER_PROPS[TRIGGER_ID.SKIN].TEMPLATE)}parseSkinProp(r,i){let a=/(['"])?([#]?[a-z0-9A-Z_-]+)(['"])?/g,n=this.triggerData[TRIGGER_ID.SKIN].triggers;Object.entries({outline:".outline",flag:".flag",skin:".skin",hair:".hair",fill:".fill",eye:"#eye",sled:".sled",string:"#string",armSleeve:".arm.sleeve",armHand:".arm.hand",legPants:".leg.pants",legFoot:".leg.foot",torso:".torso",hatTop:".hat.top",hatBottom:".hat.bottom",hatBall:".hat.ball",scarf1:".scarf1",scarf2:".scarf2",scarf3:".scarf3",scarf4:".scarf4",scarf5:".scarf5",id_scarf0:"#scarf0",id_scarf1:"#scarf1",id_scarf2:"#scarf2",id_scarf3:"#scarf3",id_scarf4:"#scarf4",id_scarf5:"#scarf5"}).forEach(([t,e])=>{r.startsWith(e)&&(void 0!==(e=JSON.parse(r.substring(e.length).replace(a,'"$2"').replace(";",","))).fill&&(n[i][t].fill=e.fill),void 0!==e.stroke)&&(n[i][t].stroke=e.stroke)}),this.triggerData[TRIGGER_ID.SKIN].triggers=n}retrieveTimestamp(t){var e=t%40,r=Math.floor(t/40)%60;return[Math.floor(t/2400),r,e]}removeLeadingZeroes(t,e){return e===TRIGGER_ID.SKIN?t:t.replace(/([^\d.+-])0+(\d+)/g,"$1$2")}}function generateScript(t,e){var r=e[t],i=TRIGGER_PROPS[t].FUNC;if(void 0===i)return"";switch(t){case TRIGGER_ID.FOCUS:case TRIGGER_ID.PAN:case TRIGGER_ID.ZOOM:return i.replace("{0}",JSON.stringify(r.triggers)).replace("{1}",String(r.smoothing)).replace(" ","");case TRIGGER_ID.TIME:return i.replace("{0}",JSON.stringify(r.triggers)).replace("{1}",String(r.interpolate)).replace(" ","");case TRIGGER_ID.SKIN:return i.replace("{0}",JSON.stringify(formatSkins(r.triggers))).replace(" ","");default:return""}}function formatSkins(t){let e,r="#ffffffff";t=t.map(t=>{var e;return[` .outline {stroke: ${null!=(e=t.outline.stroke)?e:r}}`,` .skin {fill: ${null!=(e=t.skin.fill)?e:r}}`,` .hair {fill: ${null!=(e=t.hair.fill)?e:r}}`,` .fill {fill: ${null!=(e=t.fill.fill)?e:r}}`,` #eye {fill: ${null!=(e=t.eye.fill)?e:r}}`,` .sled {fill: ${null!=(e=t.sled.fill)?e:r}}`,` #string {stroke: ${null!=(e=t.string.stroke)?e:r}}`,` .arm .sleeve {fill: ${null!=(e=t.armSleeve.fill)?e:r}}`,` .arm .hand {fill: ${null!=(e=t.armHand.fill)?e:r}}`,` .leg .pants {fill: ${null!=(e=t.legPants.fill)?e:r}}`,` .leg .foot {fill: ${null!=(e=t.legFoot.fill)?e:r}}`,` .torso {fill: ${null!=(e=t.torso.fill)?e:r}}`,` .scarf1 {fill: ${null!=(e=t.scarf1.fill)?e:r}}`,` .scarf2 {fill: ${null!=(e=t.scarf2.fill)?e:r}}`,` .scarf3 {fill: ${null!=(e=t.scarf3.fill)?e:r}}`,` .scarf4 {fill: ${null!=(e=t.scarf4.fill)?e:r}}`,` .scarf5 {fill: ${null!=(e=t.scarf5.fill)?e:r}}`,` #scarf0 {fill: ${null!=(e=t.id_scarf0.fill)?e:r}}`,` #scarf1 {fill: ${null!=(e=t.id_scarf1.fill)?e:r}}`,` #scarf2 {fill: ${null!=(e=t.id_scarf2.fill)?e:r}}`,` #scarf3 {fill: ${null!=(e=t.id_scarf3.fill)?e:r}}`,` #scarf4 {fill: ${null!=(e=t.id_scarf4.fill)?e:r}}`,` #scarf5 {fill: ${null!=(e=t.id_scarf5.fill)?e:r}}`,` .hat .top {fill: ${null!=(e=t.hatTop.fill)?e:r}}`,` .hat .bottom {stroke: ${null!=(e=t.hatBottom.stroke)?e:r}}`,` .hat .ball {fill: ${null!=(e=t.hatBall.fill)?e:r}}`,` .flag {fill: ${null!=(e=t.flag.fill)?e:r}}`].join("").replace(/\n/g,"")});return t.unshift(null!=(e=t.pop())?e:""),t}if(window.setCustomGravity=(()=>{let t=window.store.getState().simulator.engine.getFrame(0).snapshot.entities[0].entities[0].points.length,r=!1,e=window.store.getState().simulator.engine.engine.state.riders.length,n=0,s=0,o=[];function i(){window.store.dispatch({type:"STOP_PLAYER"}),e=window.store.getState().simulator.engine.engine.state.riders.length,n=0,s=0,window.requestAnimationFrame(()=>{window.store.getState().camera.playbackFollower._frames.length=0,window.store.getState().simulator.engine.engine._computed._frames.length=1})}function a(){if(0===o.length)return{x:0,y:.175};var r=window.store.getState().simulator.engine.engine._computed._frames.length-1;let i=o[o.length-1][1][s];if(r<o[o.length-1][0]){let t=0,e=o.length-1;for(;t<e;){var a=Math.ceil((e+t)/2);r<o[a][0]?e=a-1:t=a}i=o[t][1][s]}return void 0===i&&(i={x:0,y:.175}),(n+=1)===t&&(n=0,s+=1),s===e&&(s=0),i}return window.store.subscribe(()=>{e!==window.store.getState().simulator.engine.engine.state.riders.length&&i()}),function(e){for(let t=o.length=0;t<e.length;t++)o.push([2400*e[t][0][0]+40*e[t][0][1]+e[t][0][2],e[t][1]]);i(),r||(r=!0,Object.defineProperty(window.$ENGINE_PARAMS,"gravity",{get:a}))}})(),window.store)main();else{let prevInit=window.onAppReady;window.onAppReady=()=>{prevInit&&prevInit(),main()}}
