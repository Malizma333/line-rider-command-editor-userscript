(()=>{"use strict";var __webpack_modules__={449:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>readJsScript});var _lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(925),_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(406),_lib_validation__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(733);function readJsScript(scriptText,currentTriggerData){const triggerData=_lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.G.initialTriggerData;function parseCommand(commandId,scriptSection){if(commandId===_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.GRAVITY)throw new Error("Gravity parsing not supported!");if(void 0===_lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.B[commandId].FUNC)throw new Error("Function undefined!");const currentHeader=_lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.B[commandId].FUNC.split("(")[0],currentHeaderIndex=scriptSection.indexOf(currentHeader);if(-1===currentHeaderIndex)throw new Error("Command header not found!");const startIndex=currentHeaderIndex+currentHeader.length+1;let endIndex=startIndex;for(let t=1;t>0||endIndex>=scriptSection.length;endIndex+=1)"("===scriptSection.charAt(endIndex+1)&&(t+=1),")"===scriptSection.charAt(endIndex+1)&&(t-=1);const parameterText=`[${removeLeadingZeroes(scriptSection.substring(startIndex,endIndex),commandId)}]`,parameterArray=eval(parameterText),[keyframes,smoothing]=parameterArray;switch(commandId){case _lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.ZOOM:case _lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.PAN:case _lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.FOCUS:case _lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.TIME:parseTriggers(commandId,keyframes),parseSmoothing(commandId,smoothing);break;case _lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN:parseSkinCss(keyframes)}}function parseTriggers(t,e){const i=[];for(let t=0;t<e.length;t+=1){i.push(structuredClone(e[t]));const r=e[t][0];if("number"==typeof r){const e=r;i[t][0]=retrieveTimestamp(e)}else if(1===r.length){const e=r[0];i[t][0]=retrieveTimestamp(e)}else if(2===r.length){const e=40*r[0]+r[1];i[t][0]=retrieveTimestamp(e)}else{const e=2400*r[0]+40*r[1]+r[2];i[t][0]=retrieveTimestamp(e)}}triggerData[t].triggers=i}function parseSmoothing(t,e){if(t===_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.TIME){const i=_lib_validation__WEBPACK_IMPORTED_MODULE_2__.vc.INTERPOLATE;if(null==e)return void(triggerData[t].interpolate=i.DEFAULT);if(!0!==e&&!1!==e)throw new Error("Invalid boolean!");triggerData[t].interpolate=e}else{const i=_lib_validation__WEBPACK_IMPORTED_MODULE_2__.vc.SMOOTH;if(null==e)return void(triggerData[t].smoothing=i.DEFAULT);if("number"!=typeof e)throw new Error("Invalid integer!");e>i.MAX?triggerData[t].smoothing=i.MAX:e<i.MIN?triggerData[t].smoothing=i.MIN:triggerData[t].smoothing=e}}function parseSkinCss(t){var e;t.forEach(((t,e)=>{triggerData[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].triggers.push(structuredClone(_lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.B[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].TEMPLATE));let i=0,r=0;for(let n=0;n<t.length;n+=1)"{"===t.charAt(n)&&(i+=1),"}"===t.charAt(n)&&(i-=1,0===i&&(parseSkinProp(t.substring(r,n+1).replace(/\s/g,""),e),r=n+1))})),triggerData[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].triggers.length>0&&triggerData[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].triggers.push(null!==(e=triggerData[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].triggers.shift())&&void 0!==e?e:_lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.B[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].TEMPLATE)}function parseSkinProp(t,e){const i=/(['"])?([#]?[a-z0-9A-Z_-]+)(['"])?/g,r=triggerData[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].triggers;Object.entries({outline:".outline",flag:".flag",skin:".skin",hair:".hair",fill:".fill",eye:"#eye",sled:".sled",string:"#string",armSleeve:".arm.sleeve",armHand:".arm.hand",legPants:".leg.pants",legFoot:".leg.foot",torso:".torso",hatTop:".hat.top",hatBottom:".hat.bottom",hatBall:".hat.ball",scarf1:".scarf1",scarf2:".scarf2",scarf3:".scarf3",scarf4:".scarf4",scarf5:".scarf5",id_scarf0:"#scarf0",id_scarf1:"#scarf1",id_scarf2:"#scarf2",id_scarf3:"#scarf3",id_scarf4:"#scarf4",id_scarf5:"#scarf5"}).forEach((([n,a])=>{if(!t.startsWith(a))return;const s=JSON.parse(t.substring(a.length).replace(i,'"$2"').replace(";",","));void 0!==s.fill&&(r[e][n].fill=s.fill),void 0!==s.stroke&&(r[e][n].stroke=s.stroke)})),triggerData[_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].triggers=r}function retrieveTimestamp(t){const e=t%40,i=Math.floor(t/40)%60;return[Math.floor(t/2400),i,e]}function removeLeadingZeroes(t,e){return e===_lib_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN?t:t.replace(/([^\d.+-])0+(\d+)/g,"$1$2")}const trimmedScript=scriptText.replace(/\s/g,"");return Object.keys(_lib_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.B).forEach((t=>{try{triggerData[t].triggers=[],parseCommand(t,trimmedScript)}catch(e){e instanceof Error&&(console.warn(`[ScriptParser.parseScript()] ${e.message}`),triggerData[t]=structuredClone(currentTriggerData[t]))}})),triggerData}},925:(t,e,i)=>{i.d(e,{B:()=>a,G:()=>s});var r=i(733),n=i(406);const a={[n.n.ZOOM]:{DISPLAY_NAME:"Zoom",FUNC:"getAutoZoom=createZoomer({0},{1});",TEMPLATE:[[0,0,0],1]},[n.n.PAN]:{DISPLAY_NAME:"Pan",FUNC:"getCamBounds=createBoundsPanner({0},{1});",TEMPLATE:[[0,0,0],{w:.4,h:.4,x:0,y:0}]},[n.n.FOCUS]:{DISPLAY_NAME:"Focus",FUNC:"getCamFocus=createFocuser({0},{1});",TEMPLATE:[[0,0,0],[1]]},[n.n.TIME]:{DISPLAY_NAME:"Speed",FUNC:"timeRemapper=createTimeRemapper({0},{1});",TEMPLATE:[[0,0,0],1]},[n.n.SKIN]:{DISPLAY_NAME:"Skin",FUNC:"setCustomRiders({0});",TEMPLATE:{outline:{stroke:"black"},flag:{fill:"#00000066"},skin:{fill:"white"},hair:{fill:"black"},fill:{fill:"black"},eye:{fill:"black"},sled:{fill:"white"},string:{stroke:"black"},armSleeve:{fill:"black"},armHand:{fill:"white"},legPants:{fill:"black"},legFoot:{fill:"white"},torso:{fill:"white"},hatTop:{fill:"white"},hatBottom:{stroke:"black"},hatBall:{fill:"black"},scarf1:{fill:"#FD4F38"},scarf2:{fill:"white"},scarf3:{fill:"#06A725"},scarf4:{fill:"white"},scarf5:{fill:"#3995FD"},id_scarf0:{fill:"white"},id_scarf1:{fill:"#FD4F38"},id_scarf2:{fill:"white"},id_scarf3:{fill:"#06A725"},id_scarf4:{fill:"white"},id_scarf5:{fill:"#3995FD"}}},[n.n.GRAVITY]:{DISPLAY_NAME:"Gravity",TEMPLATE:[[0,0,0],[{x:0,y:.175}]]}};class s{constructor(){this.triggerData=s.initialTriggerData,this.undoStack=[],this.redoStack=[]}static get initialTriggerData(){return{[n.n.ZOOM]:{id:n.n.ZOOM,triggers:[structuredClone(a[n.n.ZOOM].TEMPLATE)],smoothing:r.vc.SMOOTH.DEFAULT},[n.n.PAN]:{id:n.n.PAN,triggers:[structuredClone(a[n.n.PAN].TEMPLATE)],smoothing:r.vc.SMOOTH.DEFAULT},[n.n.FOCUS]:{id:n.n.FOCUS,triggers:[structuredClone(a[n.n.FOCUS].TEMPLATE)],smoothing:r.vc.SMOOTH.DEFAULT},[n.n.TIME]:{id:n.n.TIME,triggers:[structuredClone(a[n.n.TIME].TEMPLATE)],interpolate:r.vc.INTERPOLATE.DEFAULT},[n.n.SKIN]:{id:n.n.SKIN,triggers:[structuredClone(a[n.n.SKIN].TEMPLATE)]},[n.n.GRAVITY]:{id:n.n.GRAVITY,triggers:[structuredClone(a[n.n.GRAVITY].TEMPLATE)]}}}get data(){return this.triggerData}get undoLen(){return this.undoStack.length}get redoLen(){return this.redoStack.length}updateRiderCount(t){const e=this.triggerData[n.n.FOCUS].triggers;for(const i of e){const e=i[1].length;e<t&&i[1].push(...Array(t-e).fill(0)),e>t&&i[1].splice(t,e-t)}this.triggerData[n.n.FOCUS].triggers=e;const i=this.triggerData[n.n.GRAVITY].triggers;for(const e of i){const i=e[1].length;i<t&&e[1].push(...Array(t-i).fill(null).map((()=>({x:0,y:.175})))),i>t&&e[1].splice(t,i-t)}this.triggerData[n.n.GRAVITY].triggers=i;const r=this.triggerData[n.n.SKIN].triggers,s=r.length;s<t&&r.push(...Array(t-s).fill(null).map((()=>structuredClone(a[n.n.SKIN].TEMPLATE)))),s>t&&r.splice(t,s-t),this.triggerData[n.n.SKIN].triggers=r}updateFromPath(t,e,i){this.redoStack=[];const r=this.setAtPointer(t,e);this.undoStack.push([t,r,i]),this.undoStack.length>30&&this.undoStack.shift()}undo(){const t=this.undoStack.pop();if(void 0===t)return null;const[e,i,r]=t,n=this.setAtPointer(e,i);return this.redoStack.push([e,n,r]),r}redo(){const t=this.redoStack.pop();if(void 0===t)return null;const[e,i,r]=t,n=this.setAtPointer(e,i);return this.undoStack.push([e,n,r]),r}setAtPointer(t,e){let i=this.triggerData;for(let e=0;e<t.length-1;e+=1)i=i[t[e]];const r=i[t[t.length-1]];return i[t[t.length-1]]=e,r}}},406:(t,e,i)=>{var r;i.d(e,{n:()=>r}),function(t){t.ZOOM="ZOOM",t.PAN="CAMERA_PAN",t.FOCUS="CAMERA_FOCUS",t.TIME="TIME_REMAP",t.SKIN="CUSTOM_SKIN",t.GRAVITY="GRAVITY"}(r||(r={}))},733:(t,e,i)=>{i.d(e,{P:()=>a,lv:()=>n,vc:()=>r});const r={INTERPOLATE:{DEFAULT:!0},SMOOTH:{DEFAULT:20,MIN:0,MAX:40,INT:!0},FRAME:{DEFAULT:0,MIN:0,MAX:39,INT:!0},SECOND:{DEFAULT:0,MIN:0,MAX:59,INT:!0},MINUTE:{DEFAULT:0,MIN:0,MAX:99,INT:!0},ZOOM:{DEFAULT:1,MIN:-50,MAX:50,INT:!1},PAN_X:{DEFAULT:0,MIN:-100,MAX:100,INT:!1},PAN_Y:{DEFAULT:0,MIN:-100,MAX:100,INT:!1},PAN_WIDTH:{DEFAULT:.4,MIN:0,MAX:2,INT:!1},PAN_HEIGHT:{DEFAULT:.4,MIN:0,MAX:2,INT:!1},FOCUS_WEIGHT:{DEFAULT:0,MIN:0,MAX:1,INT:!1},TIME_SPEED:{DEFAULT:1,MIN:.01,MAX:10,INT:!1},SKIN_ZOOM:{DEFAULT:1,MIN:1,MAX:4,INT:!1},ALPHA_SLIDER:{DEFAULT:1,MIN:0,MAX:1,INT:!1},GRAVITY_X:{DEFAULT:.175,MIN:-100,MAX:100,INT:!1},GRAVITY_Y:{DEFAULT:0,MIN:-100,MAX:100,INT:!1}};function n(t,e,i){var r,n;return null==i||"boolean"==typeof i.DEFAULT?t.new:"number"==typeof i.DEFAULT&&null!==(r=i.INT)&&void 0!==r&&r?function(t,e,i){const r=t.prev,n=t.new;if(""===n.trim())return 0;const a=Math.floor(Number(n));return Number.isNaN(a)||n.includes(".")?r:i?a<e.MIN?e.MIN:a>e.MAX?e.MAX:a:a}(t,i,e):"number"!=typeof i.DEFAULT||null!==(n=i.INT)&&void 0!==n&&n?t.prev:function(t,e,i){const r=t.prev,n=t.new;if(""===n.trim())return 0;const a=Number(n);return Number.isNaN(a)?r:i?a<e.MIN?e.MIN:a>e.MAX?e.MAX:a:n.includes(".")?n:a}(t,i,e)}function a(t){const e=Array(t.length).map((()=>!1)),i=t[0][0];0===i[0]&&0===i[1]&&0===i[2]||(e[0]=!0);for(let i=0;i<t.length-1;i+=1){const r=t[i][0],n=t[i+1][0];40*(60*r[0]+r[1])+r[2]>=40*(60*n[0]+n[1])+n[2]&&(e[i+1]=!0)}return e}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={};(()=>{const t={black:"#000000",dark_gray1:"#b7b7b7",dark_gray2:"#999999",dark_gray3:"#666666",dark_gray4:"#434343",gray:"#cccccc",light_gray1:"#d9d9d9",light_gray2:"#efefef",light_gray3:"#f3f3f3",white:"#ffffff",text:{fontFamily:"Helvetica",fontWeight:"bold"},textSizes:{S:["12px","14px","18px"],M:["18px","22px","24px"],L:["28px","32px","36px"]},centerX:{left:"0px",right:"0px",marginLeft:"auto",marginRight:"auto"}},e={root:{backgroundColor:t.light_gray3,transition:"opacity 225ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",border:"2px solid black",left:"50px",opacity:0,overflow:"hidden",padding:"1vh",pointerEvents:"none",position:"fixed",top:"12.5px"},content:{alignItems:"center",display:"flex",height:"clamp(250px, 60vh, 450px)",flexDirection:"column",justifyContent:"center",paddingTop:"1vh",width:"clamp(425px, 40vw, 650px)"},button:{embedded:{alignItems:"center",background:"none",bgColor:["transparent",t.dark_gray1,t.light_gray1],borderRadius:"0.5em",border:"none",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em"},filled:{alignItems:"center",backgroundColor:t.white,border:"2px solid black",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em"},settings:{border:"2px solid black",borderRadius:"5px",margin:"5px"}},toolbar:{container:{alignItems:"start",display:"flex",flex:1,fontSize:"25px",width:"100%"}},settings:{window:{backgroundColor:t.white,border:"2px solid black",display:"flex",flexDirection:"column",flex:9,overflow:"auto",position:"relative",width:"100%"},header:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:"3em",margin:"10px",position:"relative"},row:{alignItems:"center",display:"flex",flexDirection:"row",height:"1.5em",minHeight:"3em",padding:"1em"},label:{position:"absolute",left:"5px"},parameter:{position:"absolute",right:"5px"}},tabs:{container:{alignItems:"end",display:"flex",justifyContent:"start",flexDirection:"row",overflowX:"auto",width:"100%"},button:{border:"2px solid black",borderBottom:"0px solid black",borderTopLeftRadius:"8px",borderTopRightRadius:"8px"}},smooth:{container:{alignItems:"center",backgroundColor:t.white,borderBottom:"1px solid black",display:"flex",height:"3em",justifyContent:"start",padding:".5em"},input:{backgroundColor:t.white,overflow:"hidden",textAlign:"center",width:"3em"}},checkbox:{container:{alignItems:"center",display:"flex",height:"20px",justifyContent:"center",marginLeft:"5px",position:"relative",width:"20px"},primary:{appearance:"none",background:"#FFF",border:"2px solid black",height:"100%",position:"absolute",width:"100%"},fill:{backgroundColor:"#000",height:"60%",pointerEvents:"none",position:"absolute",width:"60%"}},window:{backgroundColor:t.white,border:"2px solid black",display:"flex",flexDirection:"column",flex:9,overflowY:"scroll",width:"100%"},trigger:{container:{alignItems:"start",border:"1px solid black",display:"flex",flexDirection:"column",padding:"12px",position:"relative"},property:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"start",marginBottom:"0.25em",width:"100%",whiteSpace:"nowrap"},input:{height:"2ch",padding:"5px",textAlign:"right",width:"3em"},text:{margin:"0em .5em"},createButton:Object.assign(Object.assign({},t.centerX),{alignItems:"center",backgroundColor:t.white,bottom:"-0.75em",border:"2px solid black",display:"flex",fontSize:"18px",height:"1.5em",justifyContent:"center",position:"absolute",userSelect:"none",width:"1.5em",zIndex:1})},dropdown:{head:{height:"3ch",marginRight:"10px",textAlign:"right"},option:{height:"2ch",textAlign:"center"}},skinEditor:{container:{alignItems:"center",display:"flex",flex:5,justifyContent:"center",overflow:"hidden",position:"relative",userSelect:"none",width:"100%"},background:{background:"linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%), linear-gradient(-45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%)",backgroundSize:"10px 10px",height:"100vh",position:"absolute",transform:"rotate(45deg)",width:"100vw"},toolbar:{alignItems:"center",backgroundColor:t.light_gray1,borderBottom:"3px solid black",flex:1,display:"flex",justifyContent:"left",position:"relative",userSelect:"none"},toolbarItem:{margin:"0px 5px"},canvas:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",position:"absolute",width:"100%"},outlineColor:{container:{alignItems:"center",display:"flex",position:"absolute",bottom:"10px",left:"10px"},input:{border:"1px solid black",borderRadius:"10px",height:"20px",marginLeft:"5px",width:"20px"}},zoomContainer:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"center",left:"20px",position:"absolute",top:"20px",height:"0px"}},alpha:{container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},sliderContainer:{alignItems:"center",display:"flex",position:"relative"},slider:{appearance:"none",background:"linear-gradient(to left, black, white)",border:"1px solid black",borderRadius:"5px",height:"8px",margin:"5px",marginTop:"10px",opacity:.7,width:"100px"}},riderProps:{outline:{strokeWidth:.3},flag:{transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3Z"},flagOutline:{transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z"},skin:{transform:"translate(13,8) rotate(-90)",width:"3.1",height:"4.5"},hair:{transform:"translate(12.4, 5.15) rotate(-90)",width:"0.3",height:"5.1"},faceOutline:{transform:"translate(12.2, 8.1) rotate(-90)",width:"3.1",height:"0.3"},hairFill:{transform:"translate(12.2,4.2) scale(0.8,0.8)",width:"3.1",height:"4.8"},eye:{transform:"translate(16.3,6.7)",points:"0.4,-0.4 0,-0.5 -0.4,-0.4 -0.5,0 -0.4,0.4 0,0.5 0.4,0.4 0.5,0"},nose:{transform:"translate(17.3,8.1) rotate(-90)",d:"M 0 -0.25 v 0.4 c 0.1 1.3 1.2 1.2 3.1 0 v -0.4"},sled:{transform:"translate(9.7, 15.9) scale(1.04,1)",d:"M13.6-2.2c-1.35,0-2.55,0.75-3.15,1.85H0C-0.2-0.35-0.35-0.2-0.35,0S-0.2,0.35,0,0.35h1.75V4.4H-0.2c-0.2,0-0.35,0.15-0.35,0.35S-0.4,5.1-0.2,5.1h13.8c2,0,3.65-1.65,3.65-3.65S15.6-2.2,13.6-2.2zM9.05,4.4h-6.6V0.35h6.6V4.4z M13.6,4.4H9.75V0.35h0.35C10.05,0.5,10,0.7,10,0.9c0,0.2,0.15,0.35,0.35,0.35c0.15,0,0.3-0.1,0.35-0.25c0.05-0.2,0.1-0.45,0.2-0.65h0.9c0.2,0,0.35-0.15,0.35-0.35S12-0.35,11.8-0.35h-0.5c0.5-0.7,1.35-1.15,2.3-1.15c1.65,0,2.95,1.3,2.95,2.95C16.55,3.1,15.25,4.4,13.6,4.4z"},string:{transform:"translate(21.5, 10.5) rotate(40)",x1:"0",y1:"0",x2:"8",y2:"0",strokeWidth:"0.3"},armSleeve:{transform:"translate(15, 10) rotate(5)",d:"M5,0.7H0c-0.4,0-0.7-0.3-0.7-0.7S-0.4-0.7,0-0.7h5"},armHand:{transform:"translate(15, 10) rotate(5)",d:"M5-0.7h0.5c0,0,0.3-0.7,0.5-0.6c0.2,0.1,0,0.6,0,0.6s0.4,0,0.6,0c0.2,0,0.5,0.3,0.5,0.7c0,0.4-0.2,0.7-0.5,0.7c-0.5,0-1.6,0-1.6,0"},legPants:{transform:"translate(15, 16) rotate(45)",d:"M4.8-0.7H0c-0.4,0-0.7,0.3-0.7,0.7S-0.4,0.7,0,0.7h4.8"},legFoot:{transform:"translate(15, 16) rotate(45)",d:"M4.8,0.7h2.4l0-2.7L6.7-2L6-0.7H4.8"},torso:{transform:"translate(16.9, 8.1) rotate(90)",width:"7.8",height:"4.4"},scarfEven:{transform:"translate(14.8, 15.2) rotate(-90)"},scarfOdd:{transform:"translate(14.8, 15.2) rotate(-90)"},scarf1:{strokeWidth:"0",x:"5.2",y:"1.5",width:"2",height:"1"},scarf2:{strokeWidth:"0",x:"5.2",y:"0.5",width:"2",height:"1"},scarf3:{strokeWidth:"0",x:"5.2",y:"-0.5",width:"2",height:"1"},scarf4:{strokeWidth:"0",x:"5.2",y:"-1.5",width:"2",height:"1"},scarf5:{strokeWidth:"0",x:"5.2",y:"-2.5",width:"2",height:"1"},hatTop:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",d:"M11-2.6h-0.4v5.2H11c1.2,0,2.2-1.2,2.2-2.6S12.2-2.6,11-2.6z"},hatBottom:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",strokeWidth:1,strokeLinecap:"round",d:"M10.6-2.6 v5.2"},hatBall:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",cx:"13.9",cy:"0",r:"0.7"},id_scarfEven:{transform:"translate(10.5, 8.5)"},id_scarfOdd:{transform:"translate(10.5, 8.5)"},id_scarf0a:{strokeWidth:"0",x:"2",width:"2",height:"2"},id_scarf0b:{strokeWidth:"0",x:"0",width:"2",height:"2"},id_scarf1:{strokeWidth:"0",x:"-2",width:"2",height:"2"},id_scarf2:{strokeWidth:"0",x:"-4",width:"2",height:"2"},id_scarf3:{strokeWidth:"0",x:"-6",width:"2",height:"2"},id_scarf4:{strokeWidth:"0",x:"-8",width:"2",height:"2"},id_scarf5:{strokeWidth:"0",x:"-10",width:"2",height:"2"}}};var i;!function(t){t[t.NONE=0]="NONE",t[t.HOVER=1]="HOVER",t[t.ACTIVE=2]="ACTIVE"}(i||(i={}));var r,n=__webpack_require__(925),a=__webpack_require__(406),s=__webpack_require__(449),o=__webpack_require__(733);function l(t,e){const i=n.G.initialTriggerData;function r(t,e){const r=[];for(const i of e){const e=structuredClone(i),n=i[0];if("number"==typeof n){const t=n;e[0]=l(t)}else if(1===n.length){const t=n[0];e[0]=l(t)}else if(2===n.length){const t=40*n[0]+n[1];e[0]=l(t)}else{const t=2400*n[0]+40*n[1]+n[2];e[0]=l(t)}t===a.n.GRAVITY&&void 0===e[1].length&&(e[1]=[e[1]]),r.push(e)}i[t].triggers=r}function s(t,e){if(t===a.n.TIME){const r=o.vc.INTERPOLATE;if(null==e)return void(i[t].interpolate=r.DEFAULT);if(!0!==e&&!1!==e)throw new Error("Invalid boolean!");i[t].interpolate=e}else{const r=o.vc.SMOOTH;if(null==e)return void(i[t].smoothing=r.DEFAULT);if("number"!=typeof e)throw new Error("Invalid integer!");e>r.MAX?i[t].smoothing=r.MAX:e<r.MIN?i[t].smoothing=r.MIN:i[t].smoothing=e}}function l(t){const e=t%40,i=Math.floor(t/40)%60;return[Math.floor(t/2400),i,e]}return Object.keys(n.B).forEach((o=>{try{i[o].triggers=[],function(t,e){if(void 0===e[t])throw new Error(`Command ${t} not found!`);switch(t){case a.n.ZOOM:case a.n.PAN:case a.n.FOCUS:r(t,e[t].triggers),s(t,e[t].smoothing);break;case a.n.TIME:r(t,e[t].triggers),s(t,e[t].interpolate);break;case a.n.SKIN:!function(t){const e=[];for(const i of t){const t=structuredClone(n.B[a.n.SKIN].TEMPLATE);for(const e of Object.keys(t))void 0!==i[e]&&(void 0!==i[e].fill&&(t[e].fill=i[e].fill),void 0!==i[e].stroke&&(t[e].stroke=i[e].stroke));e.push(t)}i[a.n.SKIN].triggers=e}(e[t].triggers);break;case a.n.GRAVITY:r(t,e[t].triggers)}}(o,t)}catch(t){t instanceof Error&&(console.warn(`[ScriptParser.parseScript()] ${t.message}`),i[o]=structuredClone(e[o]))}})),i}function g(t){var e;const i="#ffffffff",r=t.map((t=>{var e,r,n,a,s,o,l,g,c,d,p,h,f,u,_,b,m,T,S,O,y,v,E,I,M,w,k;return[` .outline {stroke: ${null!==(e=t.outline.stroke)&&void 0!==e?e:i}}`,` .skin {fill: ${null!==(r=t.skin.fill)&&void 0!==r?r:i}}`,` .hair {fill: ${null!==(n=t.hair.fill)&&void 0!==n?n:i}}`,` .fill {fill: ${null!==(a=t.fill.fill)&&void 0!==a?a:i}}`,` #eye {fill: ${null!==(s=t.eye.fill)&&void 0!==s?s:i}}`,` .sled {fill: ${null!==(o=t.sled.fill)&&void 0!==o?o:i}}`,` #string {stroke: ${null!==(l=t.string.stroke)&&void 0!==l?l:i}}`,` .arm .sleeve {fill: ${null!==(g=t.armSleeve.fill)&&void 0!==g?g:i}}`,` .arm .hand {fill: ${null!==(c=t.armHand.fill)&&void 0!==c?c:i}}`,` .leg .pants {fill: ${null!==(d=t.legPants.fill)&&void 0!==d?d:i}}`,` .leg .foot {fill: ${null!==(p=t.legFoot.fill)&&void 0!==p?p:i}}`,` .torso {fill: ${null!==(h=t.torso.fill)&&void 0!==h?h:i}}`,` .scarf1 {fill: ${null!==(f=t.scarf1.fill)&&void 0!==f?f:i}}`,` .scarf2 {fill: ${null!==(u=t.scarf2.fill)&&void 0!==u?u:i}}`,` .scarf3 {fill: ${null!==(_=t.scarf3.fill)&&void 0!==_?_:i}}`,` .scarf4 {fill: ${null!==(b=t.scarf4.fill)&&void 0!==b?b:i}}`,` .scarf5 {fill: ${null!==(m=t.scarf5.fill)&&void 0!==m?m:i}}`,` #scarf0 {fill: ${null!==(T=t.id_scarf0.fill)&&void 0!==T?T:i}}`,` #scarf1 {fill: ${null!==(S=t.id_scarf1.fill)&&void 0!==S?S:i}}`,` #scarf2 {fill: ${null!==(O=t.id_scarf2.fill)&&void 0!==O?O:i}}`,` #scarf3 {fill: ${null!==(y=t.id_scarf3.fill)&&void 0!==y?y:i}}`,` #scarf4 {fill: ${null!==(v=t.id_scarf4.fill)&&void 0!==v?v:i}}`,` #scarf5 {fill: ${null!==(E=t.id_scarf5.fill)&&void 0!==E?E:i}}`,` .hat .top {fill: ${null!==(I=t.hatTop.fill)&&void 0!==I?I:i}}`,` .hat .bottom {stroke: ${null!==(M=t.hatBottom.stroke)&&void 0!==M?M:i}}`,` .hat .ball {fill: ${null!==(w=t.hatBall.fill)&&void 0!==w?w:i}}`,` .flag {fill: ${null!==(k=t.flag.fill)&&void 0!==k?k:i}}`].join("").replace(/\n/g,"")}));return r.unshift(null!==(e=r.pop())&&void 0!==e?e:""),r}!function(t){t.VIEWPORT="VIEWPORT",t.FONT_SIZE="FONT_SIZE"}(r||(r={}));const c="CMD_EDITOR_MOD_",d={[r.VIEWPORT]:{HD:{ID:"HD",NAME:"720p",SIZE:[1280,720]},FHD:{ID:"FHD",NAME:"1080p",SIZE:[1920,1080]},QHD:{ID:"QHD",NAME:"1440p",SIZE:[2560,1440]},UHD:{ID:"UHD",NAME:"4K",SIZE:[3840,2160]}},[r.FONT_SIZE]:{SMALL:0,MEDIUM:1,LARGE:2}},p={[r.FONT_SIZE]:d.FONT_SIZE.MEDIUM,[r.VIEWPORT]:d.VIEWPORT.HD.ID};function h(t){var e;return null!==(e=window.localStorage.getItem(c+t))&&void 0!==e?e:String(p[t])}function f(t,e){window.localStorage.setItem(c+t,e)}function u(t){return t.simulator.engine}function _(t){return t.player.index}function b(t){return t.views.Sidebar}function m(t){return{dangerouslySetInnerHTML:{__html:`<svg style="display: block" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${t}</svg>`}}}const T=m('<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line>'),S=m('<polyline points="15 14 20 9 15 4"></polyline><path d="M4 20v-7a4 4 0 0 1 4-4h12"></path>'),O=m('<polygon points="5 3 19 12 5 21 5 3"></polygon>'),y=m('<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>'),v=m('<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line>'),E=m('<circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>'),I=m('<path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line>'),M=m('<circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line>'),w=m('<path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>'),k=m('<path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>'),D=m('<line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>'),C=(m('<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line>'),m('<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>')),x=m('<polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>'),A=m('<line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline>'),P=m('<line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline>'),N=m('<path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle>');const j=window.React.createElement;class U{constructor(t){this.root=t,this.state=t.state}updateState(t){this.state=t}main(){const{state:i}=this;return j("div",{style:t.text},this.toolbar(),i.active&&j("div",{style:e.content},i.settingsActive&&this.settingsContainer(),!i.settingsActive&&this.tabContainer(),!i.settingsActive&&this.window()))}toolbar(){const{root:t,state:i}=this;return j("div",{style:e.toolbar.container},!i.active&&this.toolbarButton(0,"Maximize",!1,(()=>t.onActivate()),k),i.active&&j("div",{style:Object.assign(Object.assign({},e.toolbar.container),{justifyContent:"start"})},this.toolbarButton(0,"Minimize",!1,(()=>t.onActivate()),w),this.toolbarButton(1,"Download",!1,(()=>t.onDownload()),T),this.toolbarButton(2,"Upload",!1,(()=>t.onClickFile()),v),this.toolbarButton(3,"Load From Script",!1,(()=>t.onLoadScript()),S),this.toolbarButton(4,"Run",i.invalidTimes.some((t=>t)),(()=>t.onTest()),O),this.toolbarButton(5,"Copy Script",!1,(()=>{return e=this,i=void 0,n=function*(){return yield t.onCopy()},new((r=void 0)||(r=Promise))((function(t,a){function s(t){try{l(n.next(t))}catch(t){a(t)}}function o(t){try{l(n.throw(t))}catch(t){a(t)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(s,o)}l((n=n.apply(e,i||[])).next())}));var e,i,r,n}),y)),i.active&&j("div",{style:Object.assign(Object.assign({},e.toolbar.container),{justifyContent:"end"})},this.toolbarButton(6,"Undo",0===t.triggerManager.undoLen,(()=>t.onUndo()),A),this.toolbarButton(7,"Redo",0===t.triggerManager.redoLen,(()=>t.onRedo()),P),this.toolbarButton(8,"Settings",!1,(()=>t.onToggleSettings()),E),this.toolbarButton(9,"Report Issue",!1,(()=>t.onReport()),I),this.toolbarButton(10,"Help",!1,(()=>t.onHelp()),M)),j("input",{id:"trigger-file-upload",style:{display:"none"},type:"file",accept:".json",onChange:e=>t.onLoadFile(e.target.files[0])}))}toolbarButton(r,n,a,s,o){const{root:l,state:g}=this;return a&&g.toolbarColors[r]!==i.NONE&&l.onUpdateToolbarColor(r,i.NONE),j("button",{title:n,style:Object.assign(Object.assign({},e.button.embedded),{backgroundColor:e.button.embedded.bgColor[g.toolbarColors[r]]}),onMouseOver:()=>!a&&l.onUpdateToolbarColor(r,i.HOVER),onMouseOut:()=>!a&&l.onUpdateToolbarColor(r,i.NONE),onMouseDown:()=>!a&&l.onUpdateToolbarColor(r,i.ACTIVE),onMouseUp:()=>!a&&l.onUpdateToolbarColor(r,i.HOVER),onClick:s,disabled:a},j("span",Object.assign(Object.assign({},o),{style:{color:a?t.gray:t.black}})))}settingsContainer(){return j("div",{style:e.settings.window},this.settingsHeader(),this.settings())}settingsHeader(){const{root:i,state:r}=this;return j("div",{style:e.settings.header},j("button",{style:Object.assign(Object.assign({},e.button.embedded),{position:"absolute",fontSize:"32px",right:"0px"}),onClick:()=>i.onToggleSettings()},j("span",C)),j("text",{style:{fontSize:t.textSizes.L[r.fontSize]}},"Settings"),j("button",{style:Object.assign(Object.assign({},e.button.settings),{position:"absolute",fontSize:t.textSizes.M[r.fontSize],left:"0px",background:r.settingsDirty?t.light_gray3:t.dark_gray1}),disabled:!r.settingsDirty,onClick:()=>i.onApplySettings()},"Apply"))}settings(){const{root:i,state:n}=this;return j(window.React.Fragment,{style:{fontSize:t.textSizes.M[n.fontSize]}},j("div",{style:e.settings.row},j("text",{style:Object.assign(Object.assign({},e.settings.label),{fontSize:t.textSizes.S[n.fontSize]})},"Font Sizes"),j("div",{style:Object.assign(Object.assign({},e.settings.parameter),{fontSize:t.textSizes.S[n.fontSize]})},j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.fontSizeSetting===d[r.FONT_SIZE].SMALL?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeFontSize(d[r.FONT_SIZE].SMALL)},j("text",null,"Small")),j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.fontSizeSetting===d[r.FONT_SIZE].MEDIUM?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeFontSize(d[r.FONT_SIZE].MEDIUM)},j("text",null,"Medium")),j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.fontSizeSetting===d[r.FONT_SIZE].LARGE?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeFontSize(d[r.FONT_SIZE].LARGE)},j("text",null,"Large")))),j("div",{style:e.settings.row},j("text",{style:Object.assign(Object.assign({},e.settings.label),{fontSize:t.textSizes.S[n.fontSize]})},"Viewport"),j("div",{style:Object.assign(Object.assign({},e.settings.parameter),{fontSize:t.textSizes.S[n.fontSize]})},j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.resolutionSetting===d[r.VIEWPORT].HD.ID?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeViewport(d[r.VIEWPORT].HD.ID)},j("text",null,d[r.VIEWPORT].HD.NAME)),j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.resolutionSetting===d[r.VIEWPORT].FHD.ID?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeViewport(d[r.VIEWPORT].FHD.ID)},j("text",null,d[r.VIEWPORT].FHD.NAME)),j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.resolutionSetting===d[r.VIEWPORT].QHD.ID?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeViewport(d[r.VIEWPORT].QHD.ID)},j("text",null,d[r.VIEWPORT].QHD.NAME)),j("button",{style:Object.assign(Object.assign({},e.button.settings),{backgroundColor:n.resolutionSetting===d[r.VIEWPORT].UHD.ID?t.light_gray1:t.dark_gray1}),onClick:()=>i.onChangeViewport(d[r.VIEWPORT].UHD.ID)},j("text",null,d[r.VIEWPORT].UHD.NAME)))))}tabContainer(){return j("div",{style:e.tabs.container},Object.keys(n.B).map((t=>j("div",null,this.tab(t)))))}tab(i){const{root:r,state:a}=this;return j("button",{style:Object.assign(Object.assign({},e.tabs.button),{backgroundColor:a.activeTab===i?t.light_gray1:t.dark_gray1}),onClick:()=>r.onChangeTab(i)},j("text",{style:{fontSize:t.textSizes.S[a.fontSize]}},n.B[i].DISPLAY_NAME))}window(){const{state:t,root:i}=this,r=i.triggerManager.data[t.activeTab];return r.id===a.n.SKIN?j("div",{style:e.window},this.skinEditorToolbar(t.skinEditorSelectedRider),this.skinEditor(r.triggers)):r.id===a.n.GRAVITY?j("div",{style:e.window},Object.keys(r.triggers).map((t=>this.trigger(parseInt(t,10))))):j("div",{style:e.window},this.smoothTab(),Object.keys(r.triggers).map((t=>this.trigger(parseInt(t,10)))))}smoothTab(){const{root:i,state:r}=this,n=i.triggerManager.data[r.activeTab];return j("div",{style:e.smooth.container},j("label",{for:"smoothTextInput",style:{fontSize:t.textSizes.S[r.fontSize]}},"Smoothing"),n.id!==a.n.TIME&&j("input",{id:"smoothTextInput",style:Object.assign(Object.assign({},e.smooth.input),{fontSize:t.textSizes.S[r.fontSize],marginLeft:"5px"}),value:n.smoothing,onChange:t=>i.onUpdateTrigger({prev:n.smoothing,new:t.target.value},["smoothing"],o.vc.SMOOTH),onBlur:t=>i.onUpdateTrigger({prev:n.smoothing,new:t.target.value},["smoothing"],o.vc.SMOOTH,!0)}),n.id===a.n.TIME&&j("div",{style:e.checkbox.container},j("input",{id:"smoothTextInput",style:e.checkbox.primary,type:"checkbox",onChange:()=>i.onUpdateTrigger({prev:i.triggerManager.data[r.activeTab].interpolate,new:!i.triggerManager.data[r.activeTab].interpolate},["interpolate"],o.vc.INTERPOLATE)}),n.interpolate&&j("square",{style:e.checkbox.fill})))}trigger(i){const{root:r,state:n}=this,s=r.triggerManager.data[n.activeTab],o=s.triggers[i];return j("div",{style:Object.assign(Object.assign({},e.trigger.container),{fontSize:t.textSizes.M[n.fontSize],backgroundColor:0===i?t.gray:t.white})},j("button",{style:Object.assign(Object.assign({},e.button.embedded),{fontSize:"22px",position:"absolute",right:"0px"}),disabled:0===i,onClick:()=>r.onDeleteTrigger(i)},j("span",Object.assign(Object.assign({},C),{style:{color:0===i?t.dark_gray2:t.black}}))),s.id!==a.n.SKIN&&this.timeStamp(o[0],i),s.id===a.n.ZOOM&&this.captureButton(o,i,a.n.ZOOM),s.id===a.n.PAN&&this.captureButton(o,i,a.n.PAN),s.id===a.n.ZOOM&&this.zoomTrigger(o,i),s.id===a.n.PAN&&this.cameraPanTrigger(o,i),s.id===a.n.FOCUS&&this.cameraFocusTrigger(o,i),s.id===a.n.TIME&&this.timeRemapTrigger(o,i),s.id===a.n.SKIN&&!1,s.id===a.n.GRAVITY&&this.gravityTrigger(o,i),j("button",{style:e.trigger.createButton,onClick:()=>r.onCreateTrigger(i)},j("span",D)))}timeStamp(t,i){const{root:r,state:n}=this,a=[o.vc.MINUTE,o.vc.SECOND,o.vc.FRAME];return j("div",{style:e.trigger.property},t.map(((t,s)=>j("div",null,j("text",{style:e.trigger.text},["Time",":",":"][s]),j("input",{style:Object.assign(Object.assign({},e.trigger.input),{color:n.invalidTimes[i]?"red":"black"}),value:t,onChange:e=>r.onUpdateTrigger({prev:t,new:e.target.value},["triggers",i,0,s],a[s]),onBlur:e=>r.onUpdateTrigger({prev:t,new:e.target.value},["triggers",i,0,s],a[s],!0)})))))}captureButton(t,i,r){const{root:n}=this;return j("button",{style:Object.assign(Object.assign({},e.button.embedded),{fontSize:"22px",position:"absolute",right:"25px"}),onClick:()=>n.onCameraDataCapture(t,i,r)},j("span",Object.assign({},N)))}zoomTrigger(t,i){const{root:r}=this,n=["Zoom To"];return j("div",{style:e.trigger.property},j("label",{for:`zoomTriggerText_${n[0]}_${i}`,style:e.trigger.text},n[0]),j("input",{id:`zoomTriggerText_${n[0]}_${i}`,style:e.trigger.input,value:t[1],onChange:e=>r.onUpdateTrigger({prev:t[1],new:e.target.value},["triggers",i,1],o.vc.ZOOM),onBlur:e=>r.onUpdateTrigger({prev:t[1],new:e.target.value},["triggers",i,1],o.vc.ZOOM,!0)}))}cameraPanTrigger(t,i){const{root:r}=this,n=[o.vc.PAN_WIDTH,o.vc.PAN_HEIGHT,o.vc.PAN_X,o.vc.PAN_Y],a=["Width","Height","Offset X","Offset Y"];return j(window.React.Fragment,null,[["w","h"],["x","y"]].map(((s,o)=>j("div",{style:{display:"flex",flexDirection:"row"}},s.map(((s,l)=>j("div",{style:e.trigger.property},j("label",{for:`camTriggerText_${a[l+2*o]}_${i}`,style:e.trigger.text},a[l+2*o]),j("input",{id:`camTriggerText_${a[l+2*o]}_${i}`,style:e.trigger.input,value:t[1][s],onChange:e=>r.onUpdateTrigger({prev:t[1][s],new:e.target.value},["triggers",i,1,s],n[l+2*o]),onBlur:e=>r.onUpdateTrigger({prev:t[1][s],new:e.target.value},["triggers",i,1,s],n[l+2*o],!0)}))))))))}cameraFocusTrigger(t,i){const{root:r,state:n}=this,a=n.focusDDIndices[i],s=["Weight"];return j("div",{style:e.trigger.property},j("select",{style:e.dropdown.head,value:a,onChange:t=>r.onChangeFocusDD(i,t.target.value)},Object.keys(t[1]).map((t=>{const i=1+parseInt(t,10);return j("option",{style:e.dropdown.option,value:parseInt(t,10)},j("text",null,`Rider ${i}`))}))),j("label",{for:`focusTriggerText_${s[0]}_${a}_${i}`,style:e.trigger.text},s[0]),j("input",{id:`focusTriggerText_${s[0]}_${a}_${i}`,style:e.trigger.input,value:t[1][a],onChange:e=>r.onUpdateTrigger({prev:t[1][a],new:e.target.value},["triggers",i,1,a],o.vc.FOCUS_WEIGHT),onBlur:e=>r.onUpdateTrigger({prev:t[1][a],new:e.target.value},["triggers",i,1,a],o.vc.FOCUS_WEIGHT,!0)}))}timeRemapTrigger(t,i){const{root:r}=this,n=["Speed"];return j("div",{style:e.trigger.property},j("label",{for:`timeTriggerText_${n[0]}_${i}`,style:e.trigger.text},n[0]),j("input",{id:`timeTriggerText_${n[0]}_${i}`,style:e.trigger.input,value:t[1],onChange:e=>r.onUpdateTrigger({prev:t[1],new:e.target.value},["triggers",i,1],o.vc.TIME_SPEED),onBlur:e=>r.onUpdateTrigger({prev:t[1],new:e.target.value},["triggers",i,1],o.vc.TIME_SPEED,!0)}))}gravityTrigger(t,i){const{root:r,state:n}=this,a=[o.vc.GRAVITY_X,o.vc.GRAVITY_Y],s=["X","Y"],l=n.gravityDDIndices[i];return j("div",{style:{display:"flex",flexDirection:"row"}},j("select",{style:e.dropdown.head,value:l,onChange:t=>r.onChangeGravityDD(i,t.target.value)},Object.keys(t[1]).map((t=>{const i=1+parseInt(t,10);return j("option",{style:e.dropdown.option,value:parseInt(t,10)},j("text",null,`Rider ${i}`))}))),["x","y"].map(((n,o)=>j("div",{style:e.trigger.property},j("label",{for:`gravityTriggerText_${s[o]}_${l}_${i}`,style:e.trigger.text},s[o]),j("input",{id:`gravityTriggerText_${s[o]}_${l}_${i}`,style:e.trigger.input,value:t[1][l][n],onChange:e=>r.onUpdateTrigger({prev:t[1][l][n],new:e.target.value},["triggers",i,1,l,n],a[o]),onBlur:e=>r.onUpdateTrigger({prev:t[1][l][n],new:e.target.value},["triggers",i,1,l,n],a[o],!0)})))))}skinEditor(i){const{root:r,state:n}=this,a=n.skinEditorSelectedRider;return j("div",{style:e.skinEditor.container},j("div",{style:e.skinEditor.background}),j("div",{id:"skinElementContainer",style:Object.assign(Object.assign({},e.skinEditor.canvas),{transform:`scale(${n.skinEditorZoom[0]})`,transformOrigin:`${n.skinEditorZoom[1]}px ${n.skinEditorZoom[2]}px`}),onWheel:t=>r.onZoomSkinEditor(t,!0)},this.flagSvg(i[a],a),j("svg",{width:"10vw"}),this.riderSvg(i[a],a)),j("div",{style:e.skinEditor.zoomContainer},j("input",{style:{height:"10px"},type:"range",min:o.vc.SKIN_ZOOM.MIN,max:o.vc.SKIN_ZOOM.MAX,step:.1,value:n.skinEditorZoom[0],onChange:t=>r.onZoomSkinEditor(t,!1)}),j("text",{style:{fontSize:t.textSizes.S[n.fontSize]}},"x"+Math.round(10*n.skinEditorZoom[0])/10)),j("div",{style:e.skinEditor.outlineColor.container},j("text",{style:{fontSize:t.textSizes.S[n.fontSize]}},"Outline"),j("div",{style:Object.assign(Object.assign({},e.skinEditor.outlineColor.input),{backgroundColor:i[a].outline.stroke}),onClick:()=>r.onUpdateTrigger({new:n.skinEditorSelectedColor},["triggers",a,"outline","stroke"])})))}skinEditorToolbar(i){const{root:r,state:n}=this,s=r.triggerManager.data[a.n.SKIN].triggers,l=n.skinEditorSelectedColor.substring(0,7),g=parseInt(n.skinEditorSelectedColor.substring(7),16)/255;return j("div",{style:e.skinEditor.toolbar},j("button",{style:Object.assign(Object.assign({},e.button.embedded),{fontSize:"32px",position:"absolute",right:"10px"}),onClick:()=>r.onResetSkin(i)},j("span",x)),j("div",{style:Object.assign(Object.assign(Object.assign({},e.skinEditor.toolbarItem),e.alpha.container),{fontSize:t.textSizes.S[n.fontSize]})},j("label",{for:"alphaSlider"},"Transparency"),j("div",{style:e.alpha.sliderContainer},j("input",{id:"alphaSlider",style:e.alpha.slider,type:"range",min:o.vc.ALPHA_SLIDER.MIN,max:o.vc.ALPHA_SLIDER.MAX,step:.01,value:g,onChange:t=>r.onChangeColor(void 0,t.target.value)}))),j("input",{style:Object.assign(Object.assign({},e.skinEditor.toolbarItem),{height:"40px",width:"40px"}),type:"color",value:l,onChange:t=>r.onChangeColor(t.target.value,void 0)}),j("select",{style:Object.assign(Object.assign(Object.assign({},e.skinEditor.toolbarItem),e.dropdown.head),{fontSize:t.textSizes.M[n.fontSize]}),value:i,onChange:t=>r.onChangeSkinDD(t.target.value)},Object.keys(s).map((t=>{const i=1+parseInt(t,10);return j("option",{style:e.dropdown.option,value:parseInt(t,10)},j("text",null,`Rider ${i}`))}))))}flagSvg(t,i){const{root:r,state:n}=this,a=n.skinEditorSelectedColor;return j("svg",{height:"18",width:"15",style:{transform:"scale(5)"}},j("path",Object.assign(Object.assign({},e.riderProps.flag),{fill:t.flag.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"flag","fill"])})),j("path",Object.assign(Object.assign({},e.riderProps.flagOutline),{fill:t.flag.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"flag","fill"])})))}riderSvg(t,i){const{root:r,state:n}=this,a=n.skinEditorSelectedColor;return j("svg",{height:"25",width:"31",style:{transform:"scale(5)"}},j("rect",Object.assign(Object.assign({},e.riderProps.skin),{fill:t.skin.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"skin","fill"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.nose),{stroke:t.outline.stroke,fill:t.skin.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"skin","fill"])})),j("rect",Object.assign(Object.assign({},e.riderProps.hair),{fill:t.hair.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"hair","fill"])})),j("rect",Object.assign(Object.assign({},e.riderProps.faceOutline),{fill:t.hair.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"hair","fill"])})),j("rect",Object.assign(Object.assign({},e.riderProps.hairFill),{fill:t.fill.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"fill","fill"])})),j("polygon",Object.assign(Object.assign({},e.riderProps.eye),{fill:t.eye.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"eye","fill"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.sled),{stroke:t.outline.stroke,fill:t.sled.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"sled","fill"])})),j("line",Object.assign(Object.assign({},e.riderProps.string),{stroke:t.string.stroke,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"string","stroke"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.armHand),{stroke:t.outline.stroke,fill:t.armHand.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"armHand","fill"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.legPants),{stroke:t.outline.stroke,fill:t.legPants.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"legPants","fill"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.legFoot),{stroke:t.outline.stroke,fill:t.legFoot.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"legFoot","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfEven),e.riderProps.id_scarf0a),{fill:t.id_scarf0.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf0","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfEven),e.riderProps.id_scarf0b),{fill:t.id_scarf0.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf0","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfOdd),e.riderProps.id_scarf1),{fill:t.id_scarf1.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf1","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfOdd),e.riderProps.id_scarf2),{fill:t.id_scarf2.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf2","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfOdd),e.riderProps.id_scarf3),{fill:t.id_scarf3.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf3","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfOdd),e.riderProps.id_scarf4),{fill:t.id_scarf4.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf4","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.id_scarfOdd),e.riderProps.id_scarf5),{fill:t.id_scarf5.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"id_scarf5","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.torso),{stroke:t.outline.stroke,fill:t.torso.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"torso","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.scarfOdd),e.riderProps.scarf1),{fill:t.scarf1.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"scarf1","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.scarfOdd),e.riderProps.scarf2),{fill:t.scarf2.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"scarf2","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.scarfOdd),e.riderProps.scarf3),{fill:t.scarf3.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"scarf3","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.scarfOdd),e.riderProps.scarf4),{fill:t.scarf4.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"scarf4","fill"])})),j("rect",Object.assign(Object.assign(Object.assign({},e.riderProps.scarfOdd),e.riderProps.scarf5),{fill:t.scarf5.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"scarf5","fill"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.hatTop),{stroke:t.outline.stroke,fill:t.hatTop.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"hatTop","fill"])})),j("path",Object.assign(Object.assign({},e.riderProps.hatBottom),{stroke:t.hatBottom.stroke,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"hatBottom","stroke"])})),j("circle",Object.assign(Object.assign({},e.riderProps.hatBall),{fill:t.hatBall.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"hatBall","fill"])})),j("path",Object.assign(Object.assign(Object.assign({},e.riderProps.outline),e.riderProps.armSleeve),{stroke:t.outline.stroke,fill:t.armSleeve.fill,onClick:()=>r.onUpdateTrigger({new:a},["triggers",i,"armSleeve","fill"])})))}}const{store:F,React:R}=window;class L extends R.Component{constructor(){super(),this.componentManager=new U(this),this.triggerManager=new n.G,this.state={active:!1,activeTab:a.n.ZOOM,triggerUpdateFlag:!1,focusDDIndices:[0],gravityDDIndices:[0],skinEditorSelectedRider:0,skinEditorSelectedColor:"#000000ff",skinEditorZoom:[1,0,0],settingsActive:!1,settingsDirty:!1,fontSize:parseInt(h(r.FONT_SIZE),10),resolution:h(r.VIEWPORT),fontSizeSetting:parseInt(h(r.FONT_SIZE),10),resolutionSetting:h(r.VIEWPORT),invalidTimes:[],toolbarColors:Array(16).fill(i.NONE)},F.subscribe((()=>this.updateStore()))}componentDidMount(){window.save_commands=()=>(this.onDownload(),"Downloaded commands!")}updateStore(){const t=u(F.getState()).engine.state.riders.length;if(this.lastRiderCount!==t){this.lastRiderCount=t;const{skinEditorSelectedRider:e,focusDDIndices:i,gravityDDIndices:r}=this.state;e>=t&&this.setState({skinEditorSelectedRider:t-1}),this.triggerManager.updateRiderCount(t),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),this.setState({focusDDIndices:i.map((e=>Math.min(t-1,e)))}),this.setState({gravityDDIndices:r.map((e=>Math.min(t-1,e)))})}b(F.getState())&&this.setState({active:!1})}onUpdateToolbarColor(t,e){this.setState({toolbarColors:this.state.toolbarColors.map(((i,r)=>r===t?e:i))})}onCreateTrigger(t){const{activeTab:e,focusDDIndices:i,gravityDDIndices:r}=this.state;if(e===a.n.SKIN)return;const n=_(F.getState()),s=[Math.floor(n/2400),Math.floor(n%2400/40),Math.floor(n%40)],l=this.triggerManager.data[e].triggers,g=[s,structuredClone(l[t][1])],c=l.slice(0,t+1).concat([g]).concat(l.slice(t+1));this.triggerManager.updateFromPath([e,"triggers"],c,e),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag});const d=this.triggerManager.data[e].triggers;e===a.n.FOCUS&&this.setState({focusDDIndices:i.slice(0,t+1).concat([0]).concat(i.slice(t+1))}),e===a.n.GRAVITY&&this.setState({gravityDDIndices:r.slice(0,t+1).concat([0]).concat(r.slice(t+1))}),this.setState({invalidTimes:(0,o.P)(d)})}onUpdateTrigger(t,e,i,r=!1){const{activeTab:n}=this.state,s=(0,o.lv)(t,r,i);this.triggerManager.updateFromPath([n,...e],s,n),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag});const l=this.triggerManager.data[n].triggers;n!==a.n.SKIN&&this.setState({invalidTimes:(0,o.P)(l)})}onDeleteTrigger(t){const{activeTab:e,focusDDIndices:i,gravityDDIndices:r}=this.state;if(e===a.n.SKIN)return;const n=this.triggerManager.data[e].triggers,s=n.slice(0,t).concat(n.slice(t+1));this.triggerManager.updateFromPath([e,"triggers"],s,e),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag});const l=this.triggerManager.data[e].triggers;e===a.n.FOCUS&&this.setState({focusDDIndices:i.slice(0,t).concat(i.slice(t+1))}),e===a.n.FOCUS&&this.setState({gravityDDIndices:r.slice(0,t).concat(r.slice(t+1))}),this.setState({invalidTimes:(0,o.P)(l)})}onDownload(){const t=JSON.stringify(this.triggerManager.data),e=document.createElement("a"),i="data:text/json;charset=utf-8,"+encodeURIComponent(t);e.setAttribute("href",i),e.setAttribute("download",F.getState().trackData.label+".script.json"),e.click(),e.remove()}onClickFile(){const t=document.getElementById("trigger-file-upload");t.value="",t.click()}onLoadFile(t){const e=new window.FileReader;e.onload=()=>{try{this.onLoad(l(JSON.parse(e.result),this.triggerManager.data))}catch(t){t instanceof Error&&console.error(`[Root.onLoadFile()] Failed to load file: ${t.message}`)}},e.readAsText(t)}onLoadScript(){this.onLoad((0,s.A)(F.getState().trackData.script,this.triggerManager.data))}onLoad(t){const{activeTab:e}=this.state;try{const i=t[a.n.FOCUS].triggers,r=Array(i.length).fill(0),n=t[a.n.GRAVITY].triggers,s=Array(n.length).fill(0);if(this.triggerManager.updateFromPath([],t,a.n.ZOOM),e!==a.n.SKIN){const i=t[e].triggers;this.setState({invalidTimes:(0,o.P)(i)})}this.setState({focusDDIndices:r}),this.setState({gravityDDIndices:s}),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}catch(t){t instanceof Error&&console.error(`[Root.onLoad()] ${t.message}`)}}onTest(){const{activeTab:t,invalidTimes:e}=this.state;try{if(!e.every((t=>!t)))throw new Error("Triggers contain invalid times!");const i=this.triggerManager.data[t];switch(t){case a.n.ZOOM:window.getAutoZoom=window.createZoomer(i.triggers,i.smoothing);break;case a.n.PAN:window.getCamBounds=window.createBoundsPanner(i.triggers,i.smoothing);break;case a.n.FOCUS:window.getCamFocus=window.createFocuser(i.triggers,i.smoothing);break;case a.n.TIME:window.timeRemapper=window.createTimeRemapper(i.triggers,i.interpolate);break;case a.n.SKIN:window.setCustomRiders(g(i.triggers));break;case a.n.GRAVITY:void 0!==window.setCustomGravity&&window.setCustomGravity(i.triggers)}}catch(t){t instanceof Error&&console.error(`[Root.onTest()] ${t.message}`)}}onCopy(){return t=this,e=void 0,r=function*(){const{activeTab:t,invalidTimes:e}=this.state;try{if(!e.every((t=>!t)))throw new Error("Triggers contain invalid times!");const i=function(t,e){const i=e[t],r=n.B[t].FUNC;if(void 0===r)return"";switch(t){case a.n.FOCUS:case a.n.PAN:case a.n.ZOOM:return r.replace("{0}",JSON.stringify(i.triggers)).replace("{1}",String(i.smoothing)).replace(" ","");case a.n.TIME:return r.replace("{0}",JSON.stringify(i.triggers)).replace("{1}",String(i.interpolate)).replace(" ","");case a.n.SKIN:return r.replace("{0}",JSON.stringify(g(i.triggers))).replace(" ","");default:return""}}(t,this.triggerManager.data);return yield navigator.clipboard.writeText(i)}catch(t){t instanceof Error&&console.error(`[Root.onCopy()] ${t.message}`)}},new((i=void 0)||(i=Promise))((function(n,a){function s(t){try{l(r.next(t))}catch(t){a(t)}}function o(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,o)}l((r=r.apply(t,e||[])).next())}));var t,e,i,r}onUndo(){const{activeTab:t}=this.state,e=this.triggerManager.undo();if(this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),t!==e&&this.setState({activeTab:e}),t!==a.n.SKIN){const e=this.triggerManager.data[t].triggers;this.setState({invalidTimes:(0,o.P)(e)})}}onRedo(){const{activeTab:t}=this.state,e=this.triggerManager.redo();if(this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),t!==e&&this.setState({activeTab:e}),t!==a.n.SKIN){const e=this.triggerManager.data[t].triggers;this.setState({invalidTimes:(0,o.P)(e)})}}onResetSkin(t){this.triggerManager.updateFromPath([a.n.SKIN,"triggers",t],structuredClone(n.B[a.n.SKIN].TEMPLATE),a.n.SKIN),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}onChangeColor(t,e){const{skinEditorSelectedColor:i}=this.state,r=null!=e?Math.round(255*Math.min(Math.max(parseFloat(e),0),1)).toString(16).padStart(2,"0"):i.substring(7),n=null!=t?t+r:i.substring(0,7)+r;this.setState({skinEditorSelectedColor:n})}onActivate(){const{active:t}=this.state,e=b(F.getState());!t&&e&&F.dispatch({type:"SET_VIEWS",payload:{Sidebar:null},meta:{name:"SET_SIDEBAR_PAGE",auto:!1}}),this.setState({active:!t})}onChangeTab(t){if(this.setState({activeTab:t}),t!==a.n.SKIN){const e=this.triggerManager.data[t].triggers;this.setState({invalidTimes:(0,o.P)(e)})}}onToggleSettings(){const{settingsActive:t,settingsDirty:e,fontSize:i,resolution:r}=this.state;t&&e&&(this.setState({fontSizeSetting:i}),this.setState({resolutionSetting:r}),this.setState({settingsDirty:!1})),this.setState({settingsActive:!t})}onReport(){window.open("https://github.com/Malizma333/line-rider-command-editor-userscript/issues/new")}onHelp(){window.open("https://github.com/Malizma333/line-rider-command-editor-userscript#readme")}onChangeFontSize(t){const{fontSize:e}=this.state;t!==e&&this.setState({settingsDirty:!0}),this.setState({fontSizeSetting:t})}onChangeViewport(t){const{resolution:e}=this.state;e!==t&&this.setState({settingsDirty:!0}),this.setState({resolutionSetting:t})}onApplySettings(){const{resolutionSetting:t,resolution:e,fontSizeSetting:i}=this.state,n=Math.log2(d[r.VIEWPORT][t].SIZE[0]/d[r.VIEWPORT][e].SIZE[0]),s=d[r.VIEWPORT][t].SIZE;F.dispatch({type:"SET_PLAYBACK_DIMENSIONS",payload:{width:s[0],height:s[1]}});const o=this.triggerManager.data[a.n.ZOOM].triggers.map((t=>[t[0],Math.round(1e7*(t[1]+n+Number.EPSILON))/1e7]));this.triggerManager.updateFromPath([a.n.ZOOM,"triggers"],o,a.n.ZOOM),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),f(r.FONT_SIZE,String(i)),f(r.VIEWPORT,t),this.setState({settingsDirty:!1}),this.setState({fontSize:i}),this.setState({resolution:t})}onChangeFocusDD(t,e){const{focusDDIndices:i}=this.state,r=[...i];r[t]=parseInt(e,10),this.setState({focusDDIndices:r})}onChangeGravityDD(t,e){const{gravityDDIndices:i}=this.state,r=[...i];r[t]=parseInt(e,10),this.setState({gravityDDIndices:r})}onChangeSkinDD(t){this.setState({skinEditorSelectedRider:parseInt(t,10)})}onZoomSkinEditor(t,e){const{skinEditorZoom:i}=this.state,r=document.getElementById("skinElementContainer").getBoundingClientRect(),[n,a,s]=i;let l=n,g=a,c=s;if(e){const e=t;n<o.vc.SKIN_ZOOM.MAX&&(g=(e.clientX-r.x)/n,c=(e.clientY-r.y)/n),l=Math.max(Math.min(n-.001*e.deltaY,o.vc.SKIN_ZOOM.MAX),o.vc.SKIN_ZOOM.MIN)}else l=Math.max(Math.min(parseInt(t.target.value),o.vc.SKIN_ZOOM.MAX),o.vc.SKIN_ZOOM.MIN);this.setState({skinEditorZoom:[l,g,c]})}onCameraDataCapture(t,e,i){switch(i){case a.n.ZOOM:this.onUpdateTrigger({prev:t[1],new:Math.log2((r=F.getState(),r.camera.editorZoom)).toString()},["triggers",e,1],o.vc.ZOOM,!0);break;case a.n.PAN:{const{x:i,y:r}=function(t){return t.camera.editorPosition}(F.getState()),n=u(F.getState()),{width:a,height:s}=function(t){return t.camera.playbackDimensions||t.camera.editorDimensions}(F.getState()),l=function(t){return window.getAutoZoom?window.getAutoZoom(_(t)):t.camera.playbackZoom}(F.getState()),g=Math.floor(_(F.getState())),c=F.getState().camera.playbackFollower.getCamera(n,{zoom:l,width:a,height:s},g);this.onUpdateTrigger({prev:t[1].x,new:((i-c.x)*l/a).toString()},["triggers",e,1,"x"],o.vc.PAN_X,!0),this.onUpdateTrigger({prev:t[1].y,new:((r-c.y)*l/s).toString()},["triggers",e,1,"y"],o.vc.PAN_Y,!0);break}}var r}render(){return this.componentManager.updateState(this.state),this.componentManager.main()}}function B(){const{React:t,ReactDOM:i,store:r}=window,n=document.getElementById("content"),a=document.createElement("div");Object.assign(a.style,e.root),i.render(t.createElement(L),a),n.appendChild(a),r.subscribe((()=>{const t=r.getState().player.running,e=r.getState().views.Main,i=window.CMD_EDITOR_DEBUG||!t&&e;a.style.opacity=i?"1":"0",a.style.pointerEvents=i?"auto":"none"}));const s=setInterval((()=>{const t=n.querySelector('div[style="margin: 16px;"]');if(t){const e=t.querySelector("h1");e&&"An error occured!"===e.innerHTML&&(console.warn("[index.main()] Crash detected..."),window.save_commands(),clearInterval(s))}}),100)}if(window.store)B();else{const t=window.onAppReady;window.onAppReady=()=>{t&&t(),B()}}})(),window.setCustomGravity=function(){const t=window.store.getState().simulator.engine.getFrame(0).snapshot.entities[0].entities[0].points.length;let e=!1,i=window.store.getState().simulator.engine.engine.state.riders.length,r=0,n=0,a=[];function s(){window.store.dispatch({type:"STOP_PLAYER"}),i=window.store.getState().simulator.engine.engine.state.riders.length,r=0,n=0,window.requestAnimationFrame((()=>{window.store.getState().camera.playbackFollower._frames.length=0,window.store.getState().simulator.engine.engine._computed._frames.length=1}))}function o(){if(0===a.length)return{x:0,y:.175};let e=window.store.getState().simulator.engine.engine._computed._frames.length-1,s=a[a.length-1][1][n];if(e<a[a.length-1][0]){let t=0,i=a.length-1;for(;t<i;){let r=Math.ceil((i+t)/2);e<a[r][0]?i=r-1:t=r}s=a[t][1][n]}return void 0===s&&(s={x:0,y:.175}),r+=1,r===t&&(r=0,n+=1),n===i&&(n=0),s}return window.store.subscribe((()=>{i!==window.store.getState().simulator.engine.engine.state.riders.length&&s()})),function(t){a.length=0;for(const e of t)a.push([2400*e[0][0]+40*e[0][1]+e[0][2],e[1]]);s(),e||(e=!0,Object.defineProperty(window.$ENGINE_PARAMS,"gravity",{get:o}))}}()})();