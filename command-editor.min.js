window.CMD_EDITOR_DEBUG=!1;class Actions{static setPlaybackDimensions(t){return{type:"SET_PLAYBACK_DIMENSIONS",payload:t}}static closeSidebar(){return{type:"SET_VIEWS",payload:{Sidebar:null},meta:{name:"SET_SIDEBAR_PAGE",auto:!1}}}}class ComponentManager{constructor(t,e){this.rc=t,this.root=e,this.state=e.state,this.computed=e.computed}updateState(t){this.state=t}updateComputed(t){this.computed=t}main(){const{rc:t,root:e,state:r}=this;return t("div",{style:Styles.theme.text},t("button",{style:{...Styles.buttons.embedded,position:"absolute",fontSize:"18px"},onClick:()=>e.onActivate()},r.active?"-":"+"),r.active&&t("div",{style:Styles.content},this.toolbar(),r.settings.active&&this.settingsContainer(),!r.settings.active&&this.tabContainer(),!r.settings.active&&this.windowContainer(),!r.settings.active&&this.actionPanel()))}toolbar(){const{rc:t,root:e,state:r}=this;return t("div",{style:Styles.toolbar.container},t("button",{style:Styles.buttons.embedded,onClick:()=>e.onToggleSettings(!r.settings.active)},t("span",{style:{position:"relative"}},"âš™")),t("button",{style:Styles.buttons.embedded,onClick:()=>window.open(Constants.LINKS.REPORT)},t("span",{style:{position:"relative"}},"âš‘")),t("button",{style:Styles.buttons.embedded,onClick:()=>window.open(Constants.LINKS.HELP)},t("span",{style:{position:"relative"}},"?")))}actionPanel(){const{rc:t,root:e,state:r}=this;return t("div",{style:{...Styles.actionPanel.container,fontSize:Styles.theme.textSizes.S[r.settings.fontSize]}},t("button",{style:Styles.actionPanel.button,onClick:()=>e.onLoad()},t("text",null,"Load")),t("button",{style:Styles.actionPanel.button,onClick:()=>e.onTest()},t("text",null,"Run")),t("button",{style:Styles.actionPanel.button,onClick:()=>e.onPrint()},t("text",null,"Print Code")),t("div",{style:Styles.actionPanel.outputContainer},t("div",{style:Styles.actionPanel.output},t("text",{style:{color:r.actionPanelState.hasError?"Red":"Black"}},r.actionPanelState.message)),t("button",{style:{...Styles.buttons.filled,bottom:"0px",left:"0px",position:"absolute",fontSize:"20px"},onClick:()=>e.onCopyClipboard()},"ðŸ–¶"),r.actionPanelState.copiedNotify&&t("div",{style:Styles.actionPanel.notification},"Copied!")))}settingsContainer(){var t=this["rc"];return t("div",{style:Styles.settings.window},this.settingsHeader(),this.settings())}settingsHeader(){const{rc:t,root:e,state:r}=this;return t("div",{style:Styles.settings.header},t("button",{style:{...Styles.buttons.embedded,position:"absolute",fontSize:"32px",right:"0px"},onClick:()=>e.onToggleSettings(!1)},t("span",{style:{fontWeight:700}},"X")),t("text",{style:{fontSize:Styles.theme.textSizes.L[r.settings.fontSize]}},"Settings"),t("button",{style:{...Styles.buttons.settings,position:"absolute",fontSize:Styles.theme.textSizes.M[r.settings.fontSize],left:"0px",background:r.unsavedSettings.dirty?Styles.theme.light_gray3:Styles.theme.dark_gray1},disabled:!r.unsavedSettings.dirty,onClick:()=>e.onApplySettings()},"Apply"))}settings(){const{rc:t,root:e,state:r}=this;return t(window.React.Fragment,{style:{fontSize:Styles.theme.textSizes.M[r.settings.fontSize]}},t("div",{style:Styles.settings.row},t("text",{style:{...Styles.settings.label,fontSize:Styles.theme.textSizes.S[r.settings.fontSize]}},"Font Sizes"),t("div",{style:{...Styles.settings.parameter,fontSize:Styles.theme.textSizes.S[r.settings.fontSize]}},t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.fontSize===Constants.SETTINGS.FONT_SIZES.SMALL?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeFontSize(Constants.SETTINGS.FONT_SIZES.SMALL)},t("text",null,"Small")),t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.fontSize===Constants.SETTINGS.FONT_SIZES.MEDIUM?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeFontSize(Constants.SETTINGS.FONT_SIZES.MEDIUM)},t("text",null,"Medium")),t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.fontSize===Constants.SETTINGS.FONT_SIZES.LARGE?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeFontSize(Constants.SETTINGS.FONT_SIZES.LARGE)},t("text",null,"Large")))),t("div",{style:Styles.settings.row},t("text",{style:{...Styles.settings.label,fontSize:Styles.theme.textSizes.S[r.settings.fontSize]}},"Viewport"),t("div",{style:{...Styles.settings.parameter,fontSize:Styles.theme.textSizes.S[r.settings.fontSize]}},t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.resolution===Constants.SETTINGS.VIEWPORT.HD.ID?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeViewport(Constants.SETTINGS.VIEWPORT.HD.ID)},t("text",null,Constants.SETTINGS.VIEWPORT.HD.NAME)),t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.resolution===Constants.SETTINGS.VIEWPORT.FHD.ID?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeViewport(Constants.SETTINGS.VIEWPORT.FHD.ID)},t("text",null,Constants.SETTINGS.VIEWPORT.FHD.NAME)),t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.resolution===Constants.SETTINGS.VIEWPORT.QHD.ID?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeViewport(Constants.SETTINGS.VIEWPORT.QHD.ID)},t("text",null,Constants.SETTINGS.VIEWPORT.QHD.NAME)),t("button",{style:{...Styles.buttons.settings,backgroundColor:r.unsavedSettings.resolution===Constants.SETTINGS.VIEWPORT.UHD.ID?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>e.onChangeViewport(Constants.SETTINGS.VIEWPORT.UHD.ID)},t("text",null,Constants.SETTINGS.VIEWPORT.UHD.NAME)))))}tabContainer(){const e=this["rc"];return e("div",{style:Styles.tabs.container},Object.keys(Constants.TRIGGER_PROPS).map(t=>e("div",null,this.tab(t))))}tab(t){const{rc:e,root:r,state:s}=this;return e("button",{style:{...Styles.tabs.button,backgroundColor:s.activeTab===t?Styles.theme.light_gray1:Styles.theme.dark_gray1},onClick:()=>r.onChangeTab(t)},e("text",{style:{fontSize:Styles.theme.textSizes.S[s.settings.fontSize]}},Constants.TRIGGER_PROPS[t].DISPLAY_NAME))}windowContainer(){var t=this["state"];return this.window(t.triggerData[t.activeTab])}window(e){var{rc:t,state:r}=this;return e.id===Constants.TRIGGER_TYPES.SKIN?t("div",{style:Styles.window},this.skinEditorToolbar(e.triggers,r.skinEditorState.ddIndex),this.skinEditor(e)):t("div",{style:Styles.window},this.smoothTab(r.triggerData[r.activeTab]),t("div",null,Object.keys(e.triggers).map(t=>this.trigger(e,parseInt(t,10)))))}smoothTab(e){const{rc:t,root:r,state:s}=this;return t("div",{style:Styles.smooth.container},t("label",{for:"smoothTextInput",style:{fontSize:Styles.theme.textSizes.S[s.settings.fontSize]}},"Smoothing"),e.id!==Constants.TRIGGER_TYPES.TIME&&t("input",{id:"smoothTextInput",style:{...Styles.smooth.input,fontSize:Styles.theme.textSizes.S[s.settings.fontSize],marginLeft:"5px"},value:e.smoothing,onChange:t=>r.onUpdateTrigger({prev:e.smoothing,new:t.target.value},["smoothing"],Constants.CONSTRAINTS.SMOOTH),onBlur:t=>r.onUpdateTrigger({prev:e.smoothing,new:t.target.value},["smoothing"],Constants.CONSTRAINTS.SMOOTH,!0)}),e.id===Constants.TRIGGER_TYPES.TIME&&t("div",{style:Styles.checkbox.container},t("input",{id:"smoothTextInput",style:Styles.checkbox.primary,type:"checkbox",onChange:()=>r.onUpdateTrigger({prev:s.triggerData[s.activeTab].interpolate,new:!s.triggerData[s.activeTab].interpolate},["interpolate"],Constants.CONSTRAINTS.INTERPOLATE)}),e.interpolate&&t("square",{style:Styles.checkbox.fill})))}trigger(t,e){const{rc:r,root:s,state:i}=this;var n=t.triggers[e];return r("div",{style:{...Styles.trigger.container,fontSize:Styles.theme.textSizes.M[i.settings.fontSize],backgroundColor:0===e?Styles.theme.gray:Styles.theme.white}},r("button",{style:{...Styles.buttons.embedded,fontSize:"22px",position:"absolute",right:"0px"},disabled:0===e,onClick:()=>s.onDeleteTrigger(e)},r("span",{style:{color:0===e?Styles.theme.dark_gray2:Styles.theme.black}},"X")),this.timeStamp(n[0],e),t.id===Constants.TRIGGER_TYPES.ZOOM&&this.zoomTrigger(n,e),t.id===Constants.TRIGGER_TYPES.PAN&&this.cameraPanTrigger(n,e),t.id===Constants.TRIGGER_TYPES.FOCUS&&this.cameraFocusTrigger(n,e),t.id===Constants.TRIGGER_TYPES.TIME&&this.timeRemapTrigger(n,e),t.id===Constants.TRIGGER_TYPES.SKIN&&!1,r("button",{style:Styles.trigger.createButton,onClick:()=>s.onCreateTrigger(e)},r("span",{style:{fontSize:"22px",fontWeight:900}},"+")))}timeStamp(t,s){const{rc:i,root:n,computed:a}=this,o=[Constants.CONSTRAINTS.MINUTE,Constants.CONSTRAINTS.SECOND,Constants.CONSTRAINTS.FRAME];return!!Array.isArray(t)&&i("div",{style:Styles.trigger.property},t.map((e,r)=>i("div",null,i("text",{style:Styles.trigger.text},["TIME",":",":"][r]),i("input",{style:{...Styles.trigger.input,color:a.invalidTimes[s]?"red":"black"},value:e,onChange:t=>n.onUpdateTrigger({prev:e,new:t.target.value},["triggers",s,0,r],o[r]),onBlur:t=>n.onUpdateTrigger({prev:e,new:t.target.value},["triggers",s,0,r],o[r],!0)}))))}zoomTrigger(e,r){const{rc:t,root:s}=this;var i=["ZOOM TO"];return t("div",{style:Styles.trigger.property},t("label",{for:`triggerText_${i[0]}_`+r,style:Styles.trigger.text},i[0]),t("input",{id:`triggerText_${i[0]}_`+r,style:Styles.trigger.input,value:e[1],onChange:t=>s.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],Constants.CONSTRAINTS.ZOOM),onBlur:t=>s.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],Constants.CONSTRAINTS.ZOOM,!0)}))}cameraPanTrigger(i,n){const{rc:a,root:o}=this,l=[Constants.CONSTRAINTS.PAN_WIDTH,Constants.CONSTRAINTS.PAN_HEIGHT,Constants.CONSTRAINTS.PAN_X,Constants.CONSTRAINTS.PAN_Y],g=["WIDTH","HEIGHT","X OFFSET","Y OFFSET"];return a(window.React.Fragment,null,[["w","h"],["x","y"]].map((t,s)=>a("div",{style:{display:"flex",flexDirection:"row"}},t.map((e,r)=>a("div",{style:Styles.trigger.property},a("label",{for:`triggerText_${g[r+2*s]}_`+n,style:Styles.trigger.text},g[r+2*s]),a("input",{id:`triggerText_${g[r+2*s]}_`+n,style:Styles.trigger.input,value:i[1][e],onChange:t=>o.onUpdateTrigger({prev:i[1][e],new:t.target.value},["triggers",n,1,e],l[r+2*s]),onBlur:t=>o.onUpdateTrigger({prev:i[1][e],new:t.target.value},["triggers",n,1,e],l[r+2*s],!0)}))))))}cameraFocusTrigger(e,r){const{rc:s,root:i,state:t}=this,n=t.focusDDIndices[r];var a=["WEIGHT"];return s("div",{style:Styles.trigger.property},s("select",{style:Styles.dropdown.head,value:n,onChange:t=>i.onChangeFocusDD(r,t.target.value)},Object.keys(e[1]).map(t=>{var e=1+parseInt(t,10);return s("option",{style:Styles.dropdown.option,value:parseInt(t,10)},s("text",null,"Rider "+e))})),s("label",{for:`triggerText_${a[0]}_${n}_`+r,style:Styles.trigger.text},a[0]),s("input",{id:`triggerText_${a[0]}_${n}_`+r,style:Styles.trigger.input,value:e[1][n],onChange:t=>i.onUpdateTrigger({prev:e[1][n],new:t.target.value},["triggers",r,1,n],Constants.CONSTRAINTS.FOCUS_WEIGHT),onBlur:t=>i.onUpdateTrigger({prev:e[1][n],new:t.target.value},["triggers",r,1,n],Constants.CONSTRAINTS.FOCUS_WEIGHT,!0)}))}timeRemapTrigger(e,r){const{rc:t,root:s}=this;var i=["SPEED"];return t("div",{style:Styles.trigger.property},t("label",{for:`triggerText_${i[0]}_`+r,style:Styles.trigger.text},i[0]),t("input",{id:`triggerText_${i[0]}_`+r,style:Styles.trigger.input,value:e[1],onChange:t=>s.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],Constants.CONSTRAINTS.TIME_SPEED),onBlur:t=>s.onUpdateTrigger({prev:e[1],new:t.target.value},["triggers",r,1],Constants.CONSTRAINTS.TIME_SPEED,!0)}))}skinEditor(t){const{rc:e,root:r,state:s}=this,i=s.skinEditorState["ddIndex"];return e("div",{style:Styles.skinEditor.container},e("div",{style:Styles.skinEditor.background}),e("div",{id:"skinElementContainer",style:{...Styles.skinEditor.canvas,transform:`scale(${s.skinEditorState.zoom.scale})`,transformOrigin:`${s.skinEditorState.zoom.xOffset}px ${s.skinEditorState.zoom.yOffset}px`},onWheel:t=>r.onZoomSkinEditor(t,!0)},this.flagSvg(t.triggers[i],i),e("svg",{width:"10vw"}),this.riderSvg(t.triggers[i],i)),e("div",{style:Styles.skinEditor.zoomContainer},e("input",{style:{height:"10px"},type:"range",orient:"vertical",min:Constants.CONSTRAINTS.SKIN_ZOOM.MIN,max:Constants.CONSTRAINTS.SKIN_ZOOM.MAX,step:.1,value:s.skinEditorState.zoom.scale,onChange:t=>r.onZoomSkinEditor(t,!1)}),e("text",{style:{fontSize:Styles.theme.textSizes.S[s.settings.fontSize]}},"x"+Math.round(10*s.skinEditorState.zoom.scale)/10)),e("div",{style:Styles.skinEditor.outlineColor.container},e("text",{style:{fontSize:Styles.theme.textSizes.S[s.settings.fontSize]}},"Outline"),e("div",{style:{...Styles.skinEditor.outlineColor.input,backgroundColor:t.triggers[i].outline.stroke},onClick:()=>r.onUpdateTrigger({new:s.skinEditorState.color},["triggers",i,"outline","stroke"])})))}skinEditorToolbar(t,e){const{rc:r,root:s,state:i}=this;var n=i.skinEditorState.color.substring(0,7),a=parseInt(i.skinEditorState.color.substring(7),16)/255;return r("div",{style:Styles.skinEditor.toolbar},r("button",{style:{...Styles.buttons.embedded,fontSize:"32px",position:"absolute",right:"10px"},onClick:()=>s.onResetSkin(e)},r("span",{style:{color:"red",fontWeight:700}},"X")),r("div",{style:{...Styles.skinEditor.toolbarItem,...Styles.alpha.container,fontSize:Styles.theme.textSizes.S[i.settings.fontSize]}},r("label",{for:"alphaSlider"},"Transparency"),r("div",{style:Styles.alpha.sliderContainer},r("text",null,"0%"),r("input",{id:"alphaSlider",style:Styles.alpha.slider,type:"range",min:Constants.CONSTRAINTS.ALPHA_SLIDER.MIN,max:Constants.CONSTRAINTS.ALPHA_SLIDER.MAX,step:.01,value:a,onChange:t=>s.onChangeColor(null,t.target.value)}),r("text",null,"100%"))),r("input",{style:{...Styles.skinEditor.toolbarItem,height:"40px",width:"40px"},type:"color",value:n,onChange:t=>s.onChangeColor(t.target.value,null)}),r("select",{style:{...Styles.skinEditor.toolbarItem,...Styles.dropdown.head,fontSize:Styles.theme.textSizes.M[i.settings.fontSize]},value:e,onChange:t=>s.onChangeSkinDD(t.target.value)},Object.keys(t).map(t=>{var e=1+parseInt(t,10);return r("option",{style:Styles.dropdown.option,value:parseInt(t,10)},r("text",null,"Rider "+e))})))}flagSvg(t,e){const{rc:r,root:s,state:i}=this;return r("svg",{style:Styles.skinEditor.flagSvg},r("path",{...Styles.riderProps.flag,fill:t.flag.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"flag","fill"])}),r("path",{...Styles.riderProps.flagOutline,fill:t.flag.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"flag","fill"])}))}riderSvg(t,e){const{rc:r,root:s,state:i}=this;return r("svg",{style:Styles.skinEditor.riderSvg},r("rect",{...Styles.riderProps.skin,fill:t.skin.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"skin","fill"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.nose,stroke:t.outline.stroke,fill:t.skin.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"skin","fill"])}),r("rect",{...Styles.riderProps.hair,fill:t.hair.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"hair","fill"])}),r("rect",{...Styles.riderProps.faceOutline,fill:t.hair.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"hair","fill"])}),r("rect",{...Styles.riderProps.hairFill,fill:t.fill.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"fill","fill"])}),r("polygon",{...Styles.riderProps.eye,fill:t.eye.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"eye","fill"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.sled,stroke:t.outline.stroke,fill:t.sled.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"sled","fill"])}),r("line",{...Styles.riderProps.string,stroke:t.string.stroke,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"string","stroke"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.armHand,stroke:t.outline.stroke,fill:t.armHand.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"armHand","fill"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.legPants,stroke:t.outline.stroke,fill:t.legPants.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"legPants","fill"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.legFoot,stroke:t.outline.stroke,fill:t.legFoot.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"legFoot","fill"])}),r("rect",{...Styles.riderProps.id_scarfEven,...Styles.riderProps.id_scarf0a,fill:t.id_scarf0.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf0","fill"])}),r("rect",{...Styles.riderProps.id_scarfEven,...Styles.riderProps.id_scarf0b,fill:t.id_scarf0.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf0","fill"])}),r("rect",{...Styles.riderProps.id_scarfOdd,...Styles.riderProps.id_scarf1,fill:t.id_scarf1.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf1","fill"])}),r("rect",{...Styles.riderProps.id_scarfOdd,...Styles.riderProps.id_scarf2,fill:t.id_scarf2.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf2","fill"])}),r("rect",{...Styles.riderProps.id_scarfOdd,...Styles.riderProps.id_scarf3,fill:t.id_scarf3.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf3","fill"])}),r("rect",{...Styles.riderProps.id_scarfOdd,...Styles.riderProps.id_scarf4,fill:t.id_scarf4.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf4","fill"])}),r("rect",{...Styles.riderProps.id_scarfOdd,...Styles.riderProps.id_scarf5,fill:t.id_scarf5.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"id_scarf5","fill"])}),r("rect",{...Styles.riderProps.outline,...Styles.riderProps.torso,stroke:t.outline.stroke,fill:t.torso.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"torso","fill"])}),r("rect",{...Styles.riderProps.scarfOdd,...Styles.riderProps.scarf1,fill:t.scarf1.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"scarf1","fill"])}),r("rect",{...Styles.riderProps.scarfOdd,...Styles.riderProps.scarf2,fill:t.scarf2.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"scarf2","fill"])}),r("rect",{...Styles.riderProps.scarfOdd,...Styles.riderProps.scarf3,fill:t.scarf3.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"scarf3","fill"])}),r("rect",{...Styles.riderProps.scarfOdd,...Styles.riderProps.scarf4,fill:t.scarf4.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"scarf4","fill"])}),r("rect",{...Styles.riderProps.scarfOdd,...Styles.riderProps.scarf5,fill:t.scarf5.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"scarf5","fill"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.hatTop,stroke:t.outline.stroke,fill:t.hatTop.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"hatTop","fill"])}),r("path",{...Styles.riderProps.hatBottom,stroke:t.hatBottom.stroke,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"hatBottom","stroke"])}),r("circle",{...Styles.riderProps.hatBall,fill:t.hatBall.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"hatBall","fill"])}),r("path",{...Styles.riderProps.outline,...Styles.riderProps.armSleeve,stroke:t.outline.stroke,fill:t.armSleeve.fill,onClick:()=>s.onUpdateTrigger({new:i.skinEditorState.color},["triggers",e,"armSleeve","fill"])}))}}class Constants{static get ROOT_NODE_ID(){return"COMMAND_EDITOR_ROOT_NODE"}static get VIEWPORT_DIMENSIONS(){return{WIDTH:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),HEIGHT:Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}}static get LINKS(){return{HELP:"https://github.com/Malizma333/line-rider-command-editor-userscript#readme",REPORT:"https://forms.gle/7MeZ7NpjJVggmaHL7"}}static get SCROLL_DELTA(){return.001}static get TIMELINE(){return{FPS:40,SPM:60}}static get SETTINGS(){return{VIEWPORT:{HD:{ID:"HD",NAME:"720p",SIZE:[1280,720]},FHD:{ID:"FHD",NAME:"1080p",SIZE:[1920,1080]},QHD:{ID:"QHD",NAME:"1440p",SIZE:[2560,1440]},UHD:{ID:"UHD",NAME:"4K",SIZE:[3840,2160]}},FONT_SIZES:{SMALL:0,MEDIUM:1,LARGE:2}}}static get TYPES(){return{BOOL:"BOOLEAN",INT:"INTEGER",FLOAT:"FLOAT"}}static get CONSTRAINTS(){return{INTERPOLATE:{DEFAULT:!0,TYPE:Constants.TYPES.BOOL},SMOOTH:{DEFAULT:20,MIN:0,MAX:40,TYPE:Constants.TYPES.INT},FRAME:{DEFAULT:0,MIN:0,MAX:39,TYPE:Constants.TYPES.INT},SECOND:{DEFAULT:0,MIN:0,MAX:59,TYPE:Constants.TYPES.INT},MINUTE:{DEFAULT:0,MIN:0,MAX:99,TYPE:Constants.TYPES.INT},ZOOM:{DEFAULT:1,MIN:-50,MAX:50,TYPE:Constants.TYPES.FLOAT},PAN_X:{DEFAULT:0,MIN:-100,MAX:100,TYPE:Constants.TYPES.FLOAT},PAN_Y:{DEFAULT:0,MIN:-100,MAX:100,TYPE:Constants.TYPES.FLOAT},PAN_WIDTH:{DEFAULT:.4,MIN:0,MAX:2,TYPE:Constants.TYPES.FLOAT},PAN_HEIGHT:{DEFAULT:.4,MIN:0,MAX:2,TYPE:Constants.TYPES.FLOAT},FOCUS_WEIGHT:{DEFAULT:0,MIN:0,MAX:1,TYPE:Constants.TYPES.FLOAT},TIME_SPEED:{DEFAULT:1,MIN:.01,MAX:10,TYPE:Constants.TYPES.FLOAT},SKIN_ZOOM:{DEFAULT:1,MIN:1,MAX:4,TYPE:Constants.TYPES.FLOAT},ALPHA_SLIDER:{DEFAULT:1,MIN:0,MAX:1,TYPE:Constants.TYPES.FLOAT}}}static get TRIGGER_TYPES(){return{ZOOM:"ZOOM",PAN:"CAMERA_PAN",FOCUS:"CAMERA_FOCUS",TIME:"TIME_REMAP",SKIN:"CUSTOM_SKIN"}}static get TRIGGER_PROPS(){return{[Constants.TRIGGER_TYPES.ZOOM]:{DISPLAY_NAME:"Zoom",TEMPLATE:[[0,0,0],1],FUNC:"getAutoZoom=createZoomer({0},{1});"},[Constants.TRIGGER_TYPES.PAN]:{DISPLAY_NAME:"Pan",TEMPLATE:[[0,0,0],{w:.4,h:.4,x:0,y:0}],FUNC:"getCamBounds=createBoundsPanner({0},{1});"},[Constants.TRIGGER_TYPES.FOCUS]:{DISPLAY_NAME:"Focus",TEMPLATE:[[0,0,0],[1]],FUNC:"getCamFocus=createFocuser({0},{1});"},[Constants.TRIGGER_TYPES.TIME]:{DISPLAY_NAME:"Speed",TEMPLATE:[[0,0,0],1],FUNC:"timeRemapper=createTimeRemapper({0},{1});"},[Constants.TRIGGER_TYPES.SKIN]:{DISPLAY_NAME:"Skin",TEMPLATE:{outline:{stroke:"black"},flag:{fill:"#00000066"},skin:{fill:"white"},hair:{fill:"black"},fill:{fill:"black"},eye:{fill:"black"},sled:{fill:"white"},string:{stroke:"black"},armSleeve:{fill:"black"},armHand:{fill:"white"},legPants:{fill:"black"},legFoot:{fill:"white"},torso:{fill:"white"},hatTop:{fill:"white"},hatBottom:{stroke:"black"},hatBall:{fill:"black"},scarf1:{fill:"#FD4F38"},scarf2:{fill:"white"},scarf3:{fill:"#06A725"},scarf4:{fill:"white"},scarf5:{fill:"#3995FD"},id_scarf0:{fill:"white"},id_scarf1:{fill:"#FD4F38"},id_scarf2:{fill:"white"},id_scarf3:{fill:"#06A725"},id_scarf4:{fill:"white"},id_scarf5:{fill:"#3995FD"}},FUNC:"setCustomRiders({0});",STYLE_MAP:{outline:".outline",flag:".flag",skin:".skin",hair:".hair",fill:".fill",eye:"#eye",sled:".sled",string:"#string",armSleeve:".arm.sleeve",armHand:".arm.hand",legPants:".leg.pants",legFoot:".leg.foot",torso:".torso",hatTop:".hat.top",hatBottom:".hat.bottom",hatBall:".hat.ball",scarf1:".scarf1",scarf2:".scarf2",scarf3:".scarf3",scarf4:".scarf4",scarf5:".scarf5",id_scarf0:"#scarf0",id_scarf1:"#scarf1",id_scarf2:"#scarf2",id_scarf3:"#scarf3",id_scarf4:"#scarf4",id_scarf5:"#scarf5"}}}}}function InitRoot(){const{store:a,React:t}=window;return class o extends t.Component{static clampedSkinDD(t,e){var r=e;return e.ddIndex>=t&&(r.ddIndex=t-1),r}static resizedSkinArray(t,e){var r=e[Constants.TRIGGER_TYPES.SKIN].triggers,s=r.length;return s<t&&r.push(...Array(t-s).fill(structuredClone(Constants.TRIGGER_PROPS[Constants.TRIGGER_TYPES.SKIN].TEMPLATE))),t<s&&r.splice(t,s-t),e[Constants.TRIGGER_TYPES.SKIN].triggers=r,e}static resizedFocusWeightArrays(s,t){const i=t[Constants.TRIGGER_TYPES.FOCUS].triggers;return i.forEach((t,e)=>{var r=i[e][1].length;r<s&&i[e][1].push(...Array(s-r).fill(0)),s<r&&i[e][1].splice(s,r-s)}),t[Constants.TRIGGER_TYPES.FOCUS].triggers=i,t}static clampedFocusDDs(r,t){const s=t;return s.forEach((t,e)=>{s[e]>=r&&(s[e]=r-1)}),s}static resizedFocusDDIndexArray(t,e){var r=e.length;return r<t&&e.push(...Array(t-r).fill(0)),t<r&&e.splice(t,r-t),e}static chosenFocusDDIndices(t,e){const s=e;return t[Constants.TRIGGER_TYPES.FOCUS].triggers.forEach((e,t)=>{let r=0;for(let t=0;t<e[1].length;t+=1)if(0!==e[1][t]){r=t;break}s[t]=r}),s}static savedViewport(t,e,r){const s=r,i=Math.log2(Constants.SETTINGS.VIEWPORT[e].SIZE[0]/Constants.SETTINGS.VIEWPORT[t].SIZE[0]);r=Constants.SETTINGS.VIEWPORT[e].SIZE;return a.dispatch(Actions.setPlaybackDimensions({width:r[0],height:r[1]})),s[Constants.TRIGGER_TYPES.ZOOM].triggers.forEach((t,e)=>{s[Constants.TRIGGER_TYPES.ZOOM].triggers[e][1]=Math.round(1e7*(s[Constants.TRIGGER_TYPES.ZOOM].triggers[e][1]+i+Number.EPSILON))/1e7}),s}constructor(){super(),this.state={active:!1,initialized:!1,actionPanelState:{hasError:!1,message:"",copiedNotify:!1},activeTab:Constants.TRIGGER_TYPES.ZOOM,triggerData:{},focusDDIndices:[0],skinEditorState:{ddIndex:0,zoom:{scale:1},color:"#000000ff"},settings:{fontSize:Constants.SETTINGS.FONT_SIZES.MEDIUM,resolution:Constants.SETTINGS.VIEWPORT.HD.ID,active:!1},unsavedSettings:{fontSize:Constants.SETTINGS.FONT_SIZES.MEDIUM,resolution:Constants.SETTINGS.VIEWPORT.HD.ID,dirty:!1}},this.computed={invalidTimes:[],riderCount:1,script:""},this.componentManager=new ComponentManager(t.createElement,this),a.subscribe(()=>this.updateStore(a.getState()))}componentDidMount(){Object.assign(document.getElementById(Constants.ROOT_NODE_ID).style,Styles.root),window.save_commands=()=>{const e=this.state["triggerData"];var t=document.createElement("a");let r="";Object.keys(Constants.TRIGGER_PROPS).forEach(t=>{r+=ScriptGenerator.generateScript(t,e)+`

`});var s=new Blob([r],{type:"text/javascript"});return t.setAttribute("href",URL.createObjectURL(s)),t.setAttribute("target","_blank"),t.setAttribute("download","my-commands.js"),t.click(),t.remove(),"Downloaded commands!"},this.onInit().then(()=>{this.setState({initialized:!0})})}async onInit(){const e={};Object.keys(Constants.TRIGGER_PROPS).forEach(t=>{switch(e[t]={id:t,triggers:[structuredClone(Constants.TRIGGER_PROPS[t].TEMPLATE)]},t){case Constants.TRIGGER_TYPES.FOCUS:case Constants.TRIGGER_TYPES.PAN:case Constants.TRIGGER_TYPES.ZOOM:e[t].smoothing=Constants.CONSTRAINTS.SMOOTH.DEFAULT;break;case Constants.TRIGGER_TYPES.TIME:e[t].interpolate=Constants.CONSTRAINTS.INTERPOLATE.DEFAULT}}),this.setState({triggerData:e})}onCreateTrigger(t){var{triggerData:e,activeTab:r,focusDDIndices:s}=this.state,i=e[r],i=structuredClone(i.triggers[t]);let n=s;s=Selectors.getPlayerIndex(a.getState());i[0]=[Math.floor(s/2400),Math.floor(s%2400/40),Math.floor(s%40)],e[r].triggers.splice(t+1,0,i),r===Constants.TRIGGER_TYPES.FOCUS&&(n=o.resizedFocusDDIndexArray(e[r].triggers.length,n)),this.setState({triggerData:e}),this.setState({focusDDIndices:n})}onUpdateTrigger(t,e,r,s=!1){var{triggerData:i,activeTab:n}=this.state;let a=i[n];for(let t=0;t<e.length-1;t+=1)a=a[e[t]];a[e[e.length-1]]=Validator.validateData(t,r,s),this.setState({triggerData:i})}onDeleteTrigger(r){var{triggerData:t,activeTab:e,focusDDIndices:s}=this.state;let i=s;t[e].triggers=t[e].triggers.filter((t,e)=>r!==e),e===Constants.TRIGGER_TYPES.FOCUS&&(i=o.resizedFocusDDIndexArray(t[e].triggers.length,i)),this.setState({triggerData:t}),this.setState({focusDDIndices:i})}onLoad(){const{actionPanelState:e,triggerData:r,focusDDIndices:t}=this.state;let s=t,i=r;try{e.hasError&&(e.message=""),i=ScriptParser.parseScript(this.computed.script),Object.keys(r).forEach(t=>{void 0===i[t]?i[t]=r[t]:t===Constants.TRIGGER_TYPES.FOCUS&&(s=o.resizedFocusDDIndexArray(i[t].triggers.length,s),s=o.chosenFocusDDIndices(i,s))}),this.setState({triggerData:i}),e.hasError=!1}catch(t){e.message="Error: "+t.message,e.hasError=!0}this.setState({focusDDIndices:s}),this.setState({triggerData:i}),this.setState({actionPanelState:e})}onTest(){var{activeTab:t,triggerData:e,actionPanelState:r}=this.state;try{var s=ScriptGenerator.generateScript(t,e);eval.call(window,s),r.hasError=!1}catch(t){r.message="Error: "+t.message,r.hasError=!0}this.setState({actionPanelState:r})}onPrint(){var{activeTab:t,triggerData:e,actionPanelState:r}=this.state;try{r.message=ScriptGenerator.generateScript(t,e),r.hasError=!1}catch(t){r.message="Error: "+t.message,r.hasError=!0}this.setState({actionPanelState:r})}onResetSkin(t){var e=this.state["triggerData"];window.confirm("Are you sure you want to reset the current rider's skin?")&&(e[Constants.TRIGGER_TYPES.SKIN].triggers[t]=structuredClone(Constants.TRIGGER_PROPS[Constants.TRIGGER_TYPES.SKIN].TEMPLATE),this.setState({triggerData:e}))}onChangeColor(t,e){var r=this.state["skinEditorState"],e=e?Math.round(255*Math.min(Math.max(parseFloat(e),0),1)).toString(16).padStart(2,"0"):r.color.substring(7),t=t?t+e:r.color.substring(0,7)+e;r.color=t,this.setState({skinEditorState:r})}onCopyClipboard(){var t=this.state["actionPanelState"];t.hasError||(window.navigator.clipboard.writeText(t.message),t.copiedNotify=!0,this.computed.timer&&clearTimeout(this.computed.timer),this.computed.timer=window.setTimeout(()=>this.onDisableCopyNotify(),1e3),this.setState({actionPanelState:t}))}onDisableCopyNotify(){var t=this.state["actionPanelState"];t.copiedNotify=!1,this.setState({actionPanelState:t})}onActivate(){var t=this.state["active"],e=Selectors.getSidebarOpen(a.getState());!t&&e&&a.dispatch(Actions.closeSidebar()),this.setState({active:!t})}onChangeTab(t){this.setState({activeTab:t})}onToggleSettings(t){var{unsavedSettings:e,settings:r}=this.state;if(!t&&e.dirty){if(!window.confirm("Discard changes?"))return;Object.assign(e,r),e.dirty=!1}r.active=t,this.setState({unsavedSettings:e}),this.setState({settings:r})}onChangeFontSize(t){var{unsavedSettings:e,settings:r}=this.state;t!==r.fontSize&&(e.dirty=!0),e.fontSize=t,this.setState({unsavedSettings:e})}onChangeViewport(t){var{unsavedSettings:e,settings:r}=this.state;t!==r.resolution&&(e.dirty=!0),e.resolution=t,this.setState({unsavedSettings:e})}onApplySettings(){var{triggerData:t,settings:e,unsavedSettings:r}=this.state,t=o.savedViewport(e.resolution,r.resolution,t);e.fontSize=r.fontSize,e.resolution=r.resolution,r.dirty=!1,this.setState({triggerData:t}),this.setState({settings:e}),this.setState({unsavedSettings:r})}onChangeFocusDD(t,e){var r=this.state["focusDDIndices"];r[t]=parseInt(e,10),this.setState({focusDDIndices:r})}onChangeSkinDD(t){var e=this.state["skinEditorState"];e.ddIndex=parseInt(t,10),this.setState({skinEditorState:e})}onZoomSkinEditor(t,e){var r=this.state["skinEditorState"],s=document.getElementById("skinElementContainer").getBoundingClientRect();e?(r.zoom.scale<Constants.CONSTRAINTS.SKIN_ZOOM.MAX&&(r.zoom.xOffset=(t.clientX-s.x)/r.zoom.scale,r.zoom.yOffset=(t.clientY-s.y)/r.zoom.scale),r.zoom.scale=Math.max(Math.min(r.zoom.scale-t.deltaY*Constants.SCROLL_DELTA,Constants.CONSTRAINTS.SKIN_ZOOM.MAX),Constants.CONSTRAINTS.SKIN_ZOOM.MIN)):r.zoom.scale=Math.max(Math.min(t.target.value,Constants.CONSTRAINTS.SKIN_ZOOM.MAX),Constants.CONSTRAINTS.SKIN_ZOOM.MIN),this.setState({skinEditorState:r})}updateComputed(){var{triggerData:t,activeTab:e}=this.state;e!==Constants.TRIGGER_TYPES.SKIN&&(this.computed.invalidTimes=Validator.validateTimes(t[e]))}updateStore(t){var e=Selectors.getNumRiders(t),e=(this.computed.riderCount!==e&&(this.computed.riderCount=e,{triggerData:r,skinEditorState:s,focusDDIndices:i}=this.state,r=r,s=s,i=i,r=o.resizedFocusWeightArrays(e,r),r=o.resizedSkinArray(e,r),s=o.clampedSkinDD(e,s),i=o.clampedFocusDDs(e,i),this.setState({triggerData:r}),this.setState({skinEditorState:s}),this.setState({focusDDIndices:i})),Selectors.getCurrentScript(t)),r=(this.computed.script!==e&&(this.computed.script=e),Selectors.getSidebarOpen(t)),s=(r&&this.setState({active:!1}),Selectors.getPlayerRunning(t)),i=Selectors.getWindowFocused(t),e=window.CMD_EDITOR_DEBUG||!s&&i;document.getElementById(Constants.ROOT_NODE_ID).style.opacity=e?1:0,document.getElementById(Constants.ROOT_NODE_ID).style.pointerEvents=e?null:"none"}render(){var t=this.state["initialized"];return!!t&&(this.updateComputed(),this.componentManager.updateState(this.state),this.componentManager.updateComputed(this.computed),this.componentManager.main())}}}class ScriptGenerator{static generateScript(t,e){var r=e[t],s=Constants.TRIGGER_PROPS[t].FUNC;switch(t){case Constants.TRIGGER_TYPES.FOCUS:case Constants.TRIGGER_TYPES.PAN:case Constants.TRIGGER_TYPES.ZOOM:return s.replace("{0}",JSON.stringify(r.triggers)).replace("{1}",r.smoothing).replace(" ","");case Constants.TRIGGER_TYPES.TIME:return s.replace("{0}",JSON.stringify(r.triggers)).replace("{1}",r.interpolate).replace(" ","");case Constants.TRIGGER_TYPES.SKIN:return s.replace("{0}",ScriptGenerator.formatSkins(r.triggers)).replace(" ","");default:return""}}static formatSkins(t){t=t.map(t=>[` .outline {stroke: ${t.outline.stroke}}`,` .skin {fill: ${t.skin.fill}}`,` .hair {fill: ${t.hair.fill}}`,` .fill {fill: ${t.fill.fill}}`,` #eye {fill: ${t.eye.fill}}`,` .sled {fill: ${t.sled.fill}}`,` #string {stroke: ${t.string.stroke}}`,` .arm .sleeve {fill: ${t.armSleeve.fill}}`,` .arm .hand {fill: ${t.armHand.fill}}`,` .leg .pants {fill: ${t.legPants.fill}}`,` .leg .foot {fill: ${t.legFoot.fill}}`,` .torso {fill: ${t.torso.fill}}`,` .scarf1 {fill: ${t.scarf1.fill}}`,` .scarf2 {fill: ${t.scarf2.fill}}`,` .scarf3 {fill: ${t.scarf3.fill}}`,` .scarf4 {fill: ${t.scarf4.fill}}`,` .scarf5 {fill: ${t.scarf5.fill}}`,` #scarf0 {fill: ${t.id_scarf0.fill}}`,` #scarf1 {fill: ${t.id_scarf1.fill}}`,` #scarf2 {fill: ${t.id_scarf2.fill}}`,` #scarf3 {fill: ${t.id_scarf3.fill}}`,` #scarf4 {fill: ${t.id_scarf4.fill}}`,` #scarf5 {fill: ${t.id_scarf5.fill}}`,` .hat .top {fill: ${t.hatTop.fill}}`,` .hat .bottom {stroke: ${t.hatBottom.stroke}}`,` .hat .ball {fill: ${t.hatBall.fill}}`,` .flag {fill: ${t.flag.fill}}`].join("").replace(/\n/g,""));return t.unshift(t.pop()),JSON.stringify(t)}}class ScriptParser{static initCommand(t){switch(ScriptParser.triggerData[t]={id:t,triggers:[]},t){case Constants.TRIGGER_TYPES.FOCUS:case Constants.TRIGGER_TYPES.PAN:case Constants.TRIGGER_TYPES.ZOOM:ScriptParser.triggerData[t].smoothing=Constants.CONSTRAINTS.SMOOTH.DEFAULT;break;case Constants.TRIGGER_TYPES.TIME:ScriptParser.triggerData[t].interpolate=Constants.CONSTRAINTS.INTERPOLATE.DEFAULT}}static retrieveTimestamp(t){var e=t%Constants.TIMELINE.FPS,r=Math.floor(t/Constants.TIMELINE.FPS)%Constants.TIMELINE.SPM;return[Math.floor(t/(Constants.TIMELINE.SPM*Constants.TIMELINE.FPS)),r,e]}static removeLeadingZeroes(t,e){return e===Constants.TRIGGER_TYPES.SKIN?t:t.replace(/([^\d.+-])0+(\d+)/g,"$1$2")}static parseScript(t){ScriptParser.triggerData={};const r=t.replace(/\s/g,"");return Object.keys(Constants.TRIGGER_PROPS).forEach(e=>{try{ScriptParser.parseCommand(e,r)}catch(t){console.error("[ScriptParser]",t.message),void 0!==ScriptParser.triggerData[e]&&delete ScriptParser.triggerData[e]}}),ScriptParser.triggerData}static parseCommand(commandId,script){const currentHeader=Constants.TRIGGER_PROPS[commandId].FUNC.split("(")[0],currentHeaderIndex=script.indexOf(currentHeader);if(-1!==currentHeaderIndex){ScriptParser.initCommand(commandId);const startIndex=currentHeaderIndex+currentHeader.length+1;let endIndex=startIndex;for(let i=1;0<i||endIndex>=script.length;endIndex+=1)"("===script.charAt(endIndex+1)&&(i+=1),")"===script.charAt(endIndex+1)&&--i;const parameterText=`[${ScriptParser.removeLeadingZeroes(script.substring(startIndex,endIndex),commandId)}]`,parameterArray=eval(parameterText),[keyframes,smoothing]=parameterArray;switch(commandId){case Constants.TRIGGER_TYPES.ZOOM:case Constants.TRIGGER_TYPES.PAN:case Constants.TRIGGER_TYPES.FOCUS:case Constants.TRIGGER_TYPES.TIME:ScriptParser.parseTriggers(commandId,keyframes),ScriptParser.parseSmoothing(commandId,smoothing);break;case Constants.TRIGGER_TYPES.SKIN:ScriptParser.parseSkinCss(keyframes)}}}static parseTriggers(e,r){for(let t=0;t<r.length;t+=1){ScriptParser.triggerData[e].triggers.push([...r[t]]);var s,i,n=r[t][0];n.constructor===Number?(s=n,ScriptParser.triggerData[e].triggers[t][0]=ScriptParser.retrieveTimestamp(s)):1===n.length?(s=n[0],ScriptParser.triggerData[e].triggers[t][0]=ScriptParser.retrieveTimestamp(s)):2===n.length?(i=n[0]*Constants.TIMELINE.FPS+n[1],ScriptParser.triggerData[e].triggers[t][0]=ScriptParser.retrieveTimestamp(i)):(i=n[0]*Constants.TIMELINE.FPS*Constants.TIMELINE.SPM+n[1]*Constants.TIMELINE.FPS+n[2],ScriptParser.triggerData[e].triggers[t][0]=ScriptParser.retrieveTimestamp(i))}}static parseSmoothing(t,e){if(t===Constants.TRIGGER_TYPES.TIME){var r=Constants.CONSTRAINTS.INTERPOLATE;if(e){if(!0!==e&&!1!==e)throw new Error("Invalid boolean!");ScriptParser.triggerData[t].interpolate=e}else ScriptParser.triggerData[t].interpolate=r.DEFAULT}else{r=Constants.CONSTRAINTS.SMOOTH;if(e){if(Number.isNaN(e))throw new Error("Invalid integer!");e>r.MAX?ScriptParser.triggerData[t].smoothing=r.MAX:e<r.MIN?ScriptParser.triggerData[t].smoothing=r.MIN:ScriptParser.triggerData[t].smoothing=e}else ScriptParser.triggerData[t].interpolate=r.DEFAULT}}static parseSkinCss(t){t.forEach((e,r)=>{ScriptParser.triggerData[Constants.TRIGGER_TYPES.SKIN].triggers.push(structuredClone(Constants.TRIGGER_PROPS[Constants.TRIGGER_TYPES.SKIN].TEMPLATE));let s=0,i=0;for(let t=0;t<e.length;t+=1)"{"===e.charAt(t)&&(s+=1),"}"===e.charAt(t)&&0===--s&&(ScriptParser.parseSkinProp(e.substring(i,t+1).replace(/\s/g,""),r),i=t+1)}),ScriptParser.triggerData[Constants.TRIGGER_TYPES.SKIN].triggers.push(ScriptParser.triggerData[Constants.TRIGGER_TYPES.SKIN].triggers.shift())}static parseSkinProp(r,s){const i=/(['"])?([#]?[a-z0-9A-Z_-]+)(['"])?/g;var t=Constants.TRIGGER_PROPS[Constants.TRIGGER_TYPES.SKIN].STYLE_MAP;Object.entries(t).forEach(([t,e])=>{r.startsWith(e)&&(void 0!==(e=JSON.parse(r.substring(e.length).replace(i,'"$2"').replace(";",","))).fill&&(ScriptParser.triggerData[Constants.TRIGGER_TYPES.SKIN].triggers[s][t].fill=e.fill),void 0!==e.stroke)&&(ScriptParser.triggerData[Constants.TRIGGER_TYPES.SKIN].triggers[s][t].stroke=e.stroke)})}}class Selectors{static getSimulatorTrack(t){return t.simulator.engine}static getTrackStart(t){return Selectors.getSimulatorTrack(t).engine.state.startPoint}static getWindowStart(t){return Selectors.getTrackStart(t).constructor}static getWindowFocused(t){return t.views.Main}static getPlayerRunning(t){return t.player.running}static getCurrentScript(t){return t.trackData.script}static getRiders(t){return Selectors.getSimulatorTrack(t).engine.state.riders}static getNumRiders(t){return Selectors.getRiders(t).length}static getPlayerIndex(t){return t.player.index}static getSidebarOpen(t){return!!t.views.Sidebar}}class Styles{static get theme(){return{black:"#000000",dark_gray1:"#b7b7b7",dark_gray2:"#999999",dark_gray3:"#666666",dark_gray4:"#434343",gray:"#cccccc",light_gray1:"#d9d9d9",light_gray2:"#efefef",light_gray3:"#f3f3f3",white:"#ffffff",text:{fontFamily:"Helvetica",fontWeight:"bold"},textSizes:{S:["12px","14px","18px"],M:["18px","22px","24px"],L:["28px","32px","36px"]},centerX:{left:"0px",right:"0px",marginLeft:"auto",marginRight:"auto"}}}static get root(){return{backgroundColor:Styles.theme.light_gray3,border:"2px solid black",left:"50px",minHeight:"30px",minWidth:"30px",opacity:0,overflow:"hidden",pointerEvents:"none",position:"fixed",top:"12.5px"}}static get content(){return{alignItems:"center",display:"flex",height:"60vh",flexDirection:"column",justifyContent:"center",padding:"2%",width:"40vw"}}static get buttons(){return{embedded:{alignItems:"center",background:"none",border:"none",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em"},filled:{alignItems:"center",backgroundColor:Styles.theme.white,border:"2px solid black",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em"},settings:{border:"2px solid black",borderRadius:"5px",margin:"5px"}}}static get toolbar(){return{container:{alignItems:"start",display:"flex",flex:1,fontSize:"20px",justifyContent:"end",width:"100%"}}}static get actionPanel(){return{container:{alignItems:"center",display:"flex",flex:1,justifyContent:"center",width:"100%"},button:{backgroundColor:Styles.theme.light_gray1,border:"2px ridge black",borderRadius:"5px",flex:1,height:"50px",margin:"10px"},outputContainer:{backgroundColor:Styles.theme.white,border:"2px solid black",display:"flex",flex:3,height:"80px",margin:"10px",overflow:"none",position:"relative"},output:{overflowY:"scroll",textAlign:"center",wordBreak:"break-all",userSelect:"text"},notification:{backgroundColor:"white",border:"2px solid black",left:"0px",position:"absolute",top:"0px"}}}static get settings(){return{window:{backgroundColor:Styles.theme.white,border:"2px solid black",display:"flex",flexDirection:"column",flex:9,overflow:"auto",position:"relative",width:"100%"},header:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:"3em",margin:"10px",position:"relative"},row:{alignItems:"center",display:"flex",flexDirection:"row",height:"1.5em",minHeight:"3em",padding:"1em"},label:{position:"absolute",left:"5px"},parameter:{position:"absolute",right:"5px"}}}static get tabs(){return{container:{alignItems:"end",display:"flex",justifyContent:"start",flexDirection:"row",overflowX:"auto",width:"100%"},button:{border:"2px solid black",borderBottom:"0px solid black",borderTopLeftRadius:"8px",borderTopRightRadius:"8px"}}}static get smooth(){return{container:{alignItems:"center",backgroundColor:Styles.theme.white,borderBottom:"1px solid black",display:"flex",height:"3em",justifyContent:"start",padding:".5em"},input:{backgroundColor:Styles.theme.white,overflow:"hidden",textAlign:"center",width:"3em"}}}static get checkbox(){return{container:{alignItems:"center",display:"flex",height:"20px",justifyContent:"center",marginLeft:"5px",position:"relative",width:"20px"},primary:{appearance:"none",background:"#FFF",border:"2px solid black",height:"100%",position:"absolute",width:"100%"},fill:{backgroundColor:"#000",height:"60%",pointerEvents:"none",position:"absolute",width:"60%"}}}static get window(){return{backgroundColor:Styles.theme.white,border:"2px solid black",display:"flex",flexDirection:"column",flex:9,overflowY:"auto",width:"100%"}}static get trigger(){return{container:{alignItems:"start",border:"1px solid black",display:"flex",flexDirection:"column",padding:"10px",position:"relative"},property:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"start",marginBottom:"0.25em",width:"100%",whiteSpace:"nowrap"},input:{height:"2ch",padding:"5px",textAlign:"right",width:"3em"},text:{margin:"0em .5em"},createButton:{...Styles.buttons.filled,...Styles.theme.centerX,bottom:"-0.75em",fontSize:"15px",position:"absolute",zIndex:1}}}static get dropdown(){return{head:{height:"3ch",marginRight:"10px",textAlign:"right"},option:{height:"2ch",textAlign:"center"}}}static get skinEditor(){return{container:{alignItems:"center",display:"flex",flex:5,justifyContent:"center",overflow:"hidden",position:"relative",width:"100%"},background:{background:"linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%), linear-gradient(-45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%)",backgroundSize:"10px 10px",height:"100vh",position:"absolute",transform:"rotate(45deg)",width:"100vw"},toolbar:{alignItems:"center",backgroundColor:Styles.theme.light_gray1,borderBottom:"3px solid black",flex:1,display:"flex",justifyContent:"left",padding:"0.5em",position:"relative"},toolbarItem:{margin:"0px 5px"},canvas:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",position:"absolute",width:"100%"},outlineColor:{container:{alignItems:"center",display:"flex",position:"absolute",bottom:"10px",left:"10px"},input:{border:"1px solid black",borderRadius:"10px",height:"20px",marginLeft:"5px",width:"20px"}},zoomContainer:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"center",left:"20px",position:"absolute",top:"20px",height:"0px"},flagSvg:{height:"18",transform:`scale(${Constants.VIEWPORT_DIMENSIONS.WIDTH/256})`,width:"15"},riderSvg:{height:"25",transform:`scale(${Constants.VIEWPORT_DIMENSIONS.WIDTH/256})`,width:"31"}}}static get alpha(){return{container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},sliderContainer:{alignItems:"center",display:"flex",position:"relative"},slider:{appearance:"none",background:"linear-gradient(to left, black, white)",border:"1px solid black",borderRadius:"5px",height:"8px",margin:"5px",marginTop:"10px",opacity:.7,width:"100px"}}}static get riderProps(){return{outline:{strokeWidth:.3},flag:{transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3Z"},flagOutline:{transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z"},skin:{transform:"translate(13,8) rotate(-90)",width:"3.1",height:"4.5"},hair:{transform:"translate(12.4, 5.15) rotate(-90)",width:"0.3",height:"5.1"},faceOutline:{transform:"translate(12.2, 8.1) rotate(-90)",width:"3.1",height:"0.3"},hairFill:{transform:"translate(12.2,4.2) scale(0.8,0.8)",width:"3.1",height:"4.8"},eye:{transform:"translate(16.3,6.7)",points:"0.4,-0.4 0,-0.5 -0.4,-0.4 -0.5,0 -0.4,0.4 0,0.5 0.4,0.4 0.5,0"},nose:{transform:"translate(17.3,8.1) rotate(-90)",d:"M 0 -0.25 v 0.4 c 0.1 1.3 1.2 1.2 3.1 0 v -0.4"},sled:{transform:"translate(9.7, 15.9) scale(1.04,1)",d:"M13.6-2.2c-1.35,0-2.55,0.75-3.15,1.85H0C-0.2-0.35-0.35-0.2-0.35,0S-0.2,0.35,0,0.35h1.75V4.4H-0.2c-0.2,0-0.35,0.15-0.35,0.35S-0.4,5.1-0.2,5.1h13.8c2,0,3.65-1.65,3.65-3.65S15.6-2.2,13.6-2.2zM9.05,4.4h-6.6V0.35h6.6V4.4z M13.6,4.4H9.75V0.35h0.35C10.05,0.5,10,0.7,10,0.9c0,0.2,0.15,0.35,0.35,0.35c0.15,0,0.3-0.1,0.35-0.25c0.05-0.2,0.1-0.45,0.2-0.65h0.9c0.2,0,0.35-0.15,0.35-0.35S12-0.35,11.8-0.35h-0.5c0.5-0.7,1.35-1.15,2.3-1.15c1.65,0,2.95,1.3,2.95,2.95C16.55,3.1,15.25,4.4,13.6,4.4z"},string:{transform:"translate(21.5, 10.5) rotate(40)",x1:"0",y1:"0",x2:"8",y2:"0",strokeWidth:"0.3"},armSleeve:{transform:"translate(15, 10) rotate(5)",d:"M5,0.7H0c-0.4,0-0.7-0.3-0.7-0.7S-0.4-0.7,0-0.7h5"},armHand:{transform:"translate(15, 10) rotate(5)",d:"M5-0.7h0.5c0,0,0.3-0.7,0.5-0.6c0.2,0.1,0,0.6,0,0.6s0.4,0,0.6,0c0.2,0,0.5,0.3,0.5,0.7c0,0.4-0.2,0.7-0.5,0.7c-0.5,0-1.6,0-1.6,0"},legPants:{transform:"translate(15, 16) rotate(45)",d:"M4.8-0.7H0c-0.4,0-0.7,0.3-0.7,0.7S-0.4,0.7,0,0.7h4.8"},legFoot:{transform:"translate(15, 16) rotate(45)",d:"M4.8,0.7h2.4l0-2.7L6.7-2L6-0.7H4.8"},torso:{transform:"translate(16.9, 8.1) rotate(90)",width:"7.8",height:"4.4"},scarfEven:{transform:"translate(14.8, 15.2) rotate(-90)"},scarfOdd:{transform:"translate(14.8, 15.2) rotate(-90)"},scarf1:{strokeWidth:"0",x:"5.2",y:"1.5",width:"2",height:"1"},scarf2:{strokeWidth:"0",x:"5.2",y:"0.5",width:"2",height:"1"},scarf3:{strokeWidth:"0",x:"5.2",y:"-0.5",width:"2",height:"1"},scarf4:{strokeWidth:"0",x:"5.2",y:"-1.5",width:"2",height:"1"},scarf5:{strokeWidth:"0",x:"5.2",y:"-2.5",width:"2",height:"1"},hatTop:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",d:"M11-2.6h-0.4v5.2H11c1.2,0,2.2-1.2,2.2-2.6S12.2-2.6,11-2.6z"},hatBottom:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",strokeWidth:1,strokeLinecap:"round",d:"M10.6-2.6 v5.2"},hatBall:{transform:"translate(14.8,5) rotate(-90) translate(-10,0)",cx:"13.9",cy:"0",r:"0.7"},id_scarfEven:{transform:"translate(10.5, 8.5)"},id_scarfOdd:{transform:"translate(10.5, 8.5)"},id_scarf0a:{strokeWidth:"0",x:"2",width:"2",height:"2"},id_scarf0b:{strokeWidth:"0",x:"0",width:"2",height:"2"},id_scarf1:{strokeWidth:"0",x:"-2",width:"2",height:"2"},id_scarf2:{strokeWidth:"0",x:"-4",width:"2",height:"2"},id_scarf3:{strokeWidth:"0",x:"-6",width:"2",height:"2"},id_scarf4:{strokeWidth:"0",x:"-8",width:"2",height:"2"},id_scarf5:{strokeWidth:"0",x:"-10",width:"2",height:"2"}}}}class Validator{static validateData(t,e,r){if(!e)return t.new;switch(e.TYPE){case Constants.TYPES.BOOL:return t.new;case Constants.TYPES.INT:return this.validateInteger(t,e,r);case Constants.TYPES.FLOAT:return this.validateFloat(t,e,r);default:return t.prev}}static validateInteger(t,e,r){var s,i=t.prev,t=t.new;return""===t.trim()?0:(s=Math.floor(Number(t)),Number.isNaN(s)||t.includes(".")?i:r?s<e.MIN?e.MIN:s>e.MAX?e.MAX:s:s)}static validateFloat(t,e,r){var s,i=t.prev,t=t.new;return""===t.trim()?0:(s=Number(t),Number.isNaN(s)?i:r?s<e.MIN?e.MIN:s>e.MAX?e.MAX:s:t.includes(".")?t:s)}static validateTimes(t){if(!t)return[];var e=t["triggers"],r=Array(e.length).map(()=>!1),t=e[0][0];0===t[0]&&0===t[1]&&0===t[2]||(r[0]=!0);for(let t=0;t<e.length-1;t+=1){var s=e[t][0],i=e[t+1][0],s=(s[0]*Constants.TIMELINE.SPM+s[1])*Constants.TIMELINE.FPS+s[2];(i[0]*Constants.TIMELINE.SPM+i[1])*Constants.TIMELINE.FPS+i[2]<=s&&(r[t+1]=!0)}return r}}function main(){window.V2=window.V2||Selectors.getWindowStart(window.store.getState());var{React:t,ReactDOM:e}=window,r=document.createElement("div");r.setAttribute("id",Constants.ROOT_NODE_ID),document.getElementById("content").appendChild(r),e.render(t.createElement(InitRoot()),r)}function checkReady(){window.React?main():window.setTimeout(checkReady,10)}checkReady();
