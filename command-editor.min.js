(()=>{"use strict";var __webpack_modules__={925:(e,t,r)=>{r.d(t,{BC:()=>a,G1:()=>l,p6:()=>s});var n=r(304),i=r(406);const a={[i.n.ZOOM]:{DISPLAY_NAME:"Zoom",FUNC:"getAutoZoom=createZoomer({0},{1});",TEMPLATE:[[0,0,0],1]},[i.n.PAN]:{DISPLAY_NAME:"Pan",FUNC:"getCamBounds=createBoundsPanner({0},{1});",TEMPLATE:[[0,0,0],{w:.4,h:.4,x:0,y:0}]},[i.n.FOCUS]:{DISPLAY_NAME:"Focus",FUNC:"getCamFocus=createFocuser({0},{1});",TEMPLATE:[[0,0,0],[1]]},[i.n.TIME]:{DISPLAY_NAME:"Speed",FUNC:"timeRemapper=createTimeRemapper({0},{1});",TEMPLATE:[[0,0,0],1]},[i.n.SKIN]:{DISPLAY_NAME:"Skin",FUNC:"setCustomRiders({0});",TEMPLATE:{outline:{stroke:"black"},flag:{fill:"#00000066"},skin:{fill:"white"},hair:{fill:"black"},fill:{fill:"black"},eye:{fill:"black"},sled:{fill:"white"},string:{stroke:"black"},armSleeve:{fill:"black"},armHand:{fill:"white"},legPants:{fill:"black"},legFoot:{fill:"white"},torso:{fill:"white"},hatTop:{fill:"white"},hatBottom:{stroke:"black"},hatBall:{fill:"black"},scarf1:{fill:"#FD4F38"},scarf2:{fill:"white"},scarf3:{fill:"#06A725"},scarf4:{fill:"white"},scarf5:{fill:"#3995FD"},id_scarf0:{fill:"white"},id_scarf1:{fill:"#FD4F38"},id_scarf2:{fill:"white"},id_scarf3:{fill:"#06A725"},id_scarf4:{fill:"white"},id_scarf5:{fill:"#3995FD"}}},[i.n.GRAVITY]:{DISPLAY_NAME:"Gravity",TEMPLATE:[[0,0,0],{x:0,y:.175}]},[i.n.LAYER]:{DISPLAY_NAME:"Layer",TEMPLATE:[[0,0,0],{on:1,off:0,offset:0}]}},o={[i.n.ZOOM]:{id:i.n.ZOOM,triggers:[a[i.n.ZOOM].TEMPLATE],smoothing:n.s.SMOOTH.DEFAULT},[i.n.PAN]:{id:i.n.PAN,triggers:[a[i.n.PAN].TEMPLATE],smoothing:n.s.SMOOTH.DEFAULT},[i.n.FOCUS]:{id:i.n.FOCUS,triggers:[a[i.n.FOCUS].TEMPLATE],smoothing:n.s.SMOOTH.DEFAULT},[i.n.TIME]:{id:i.n.TIME,triggers:[a[i.n.TIME].TEMPLATE],interpolate:n.s.INTERPOLATE.DEFAULT},[i.n.SKIN]:{id:i.n.SKIN,triggers:[a[i.n.SKIN].TEMPLATE]},[i.n.GRAVITY]:{id:i.n.GRAVITY,triggers:[[a[i.n.GRAVITY].TEMPLATE]]},[i.n.LAYER]:{id:i.n.LAYER,triggers:{0:[a[i.n.LAYER].TEMPLATE]},interpolate:n.s.INTERPOLATE.DEFAULT}},s=[i.n.ZOOM,i.n.PAN,i.n.FOCUS,i.n.TIME,i.n.SKIN,i.n.GRAVITY,i.n.LAYER];class l{constructor(){this.triggerData=l.initialTriggerData,this.undoStack=[],this.redoStack=[]}static get initialTriggerData(){return structuredClone(o)}get data(){return this.triggerData}get undoLen(){return this.undoStack.length}get redoLen(){return this.redoStack.length}updateRiderCount(e){const t=this.triggerData[i.n.FOCUS].triggers;for(const r of t){const t=r[1].length;t<e&&r[1].push(...Array(e-t).fill(0)),t>e&&r[1].splice(e,t-e)}this.triggerData[i.n.FOCUS].triggers=t;const r=this.triggerData[i.n.GRAVITY].triggers,n=r.length;n<e&&r.push(...Array(e-n).fill(null).map((()=>[structuredClone(a[i.n.GRAVITY].TEMPLATE)]))),n>e&&r.splice(e,n-e),this.triggerData[i.n.GRAVITY].triggers=r;const o=this.triggerData[i.n.SKIN].triggers,s=o.length;s<e&&o.push(...Array(e-s).fill(null).map((()=>structuredClone(a[i.n.SKIN].TEMPLATE)))),s>e&&o.splice(e,s-e),this.triggerData[i.n.SKIN].triggers=o}updateLayerMap(e){const t=this.triggerData[i.n.LAYER].triggers,r=new Set(e),n=Object.keys(t).map((e=>parseInt(e))).filter((e=>r.has(e))),o=new Set(n),s={};for(const e of n)s[e]=t[e];for(const t of e)o.has(t)||(s[t]=[structuredClone(a[i.n.LAYER].TEMPLATE)]);this.triggerData[i.n.LAYER].triggers=s}updateFromPath(e,t,r){this.redoStack=[];const n=this.setAtPointer(e,t);this.undoStack.push({modificationPath:e,oldValue:n,activeTab:r}),this.undoStack.length>30&&this.undoStack.shift()}undo(){const e=this.undoStack.pop();if(void 0===e)return null;const{modificationPath:t,oldValue:r,activeTab:n}=e,i=this.setAtPointer(t,r);return this.redoStack.push({modificationPath:t,oldValue:i,activeTab:n}),n}redo(){const e=this.redoStack.pop();if(void 0===e)return null;const{modificationPath:t,oldValue:r,activeTab:n}=e,i=this.setAtPointer(t,r);return this.undoStack.push({modificationPath:t,oldValue:i,activeTab:n}),n}setAtPointer(e,t){let r=this.triggerData;for(let t=0;t<e.length-1;t+=1)r=r[e[t]];const n=r[e[e.length-1]];return r[e[e.length-1]]=t,n}}},406:(e,t,r)=>{var n;r.d(t,{n:()=>n}),function(e){e.ZOOM="ZOOM",e.PAN="CAMERA_PAN",e.FOCUS="CAMERA_FOCUS",e.TIME="TIME_REMAP",e.SKIN="CUSTOM_SKIN",e.GRAVITY="GRAVITY",e.LAYER="LAYER"}(n||(n={}))},304:(e,t,r)=>{r.d(t,{s:()=>i});var n=r(779);const i={INTERPOLATE:{DEFAULT:!1,TYPE:n.t.BOOL},SMOOTH:{DEFAULT:20,MIN:0,MAX:40,TYPE:n.t.INT},FRAME:{DEFAULT:0,MIN:0,MAX:39,TYPE:n.t.INT},SECOND:{DEFAULT:0,MIN:0,MAX:59,TYPE:n.t.INT},MINUTE:{DEFAULT:0,MIN:0,MAX:99,TYPE:n.t.INT},ZOOM:{DEFAULT:1,MIN:-1e6,MAX:1e6,TYPE:n.t.FLOAT},PAN_X:{DEFAULT:0,MIN:-1e6,MAX:1e6,TYPE:n.t.FLOAT},PAN_Y:{DEFAULT:0,MIN:-1e6,MAX:1e6,TYPE:n.t.FLOAT},PAN_WIDTH:{DEFAULT:.4,MIN:0,MAX:1e6,TYPE:n.t.FLOAT},PAN_HEIGHT:{DEFAULT:.4,MIN:0,MAX:1e6,TYPE:n.t.FLOAT},FOCUS_WEIGHT:{DEFAULT:0,MIN:0,MAX:1,TYPE:n.t.FLOAT},TIME_SPEED:{DEFAULT:1,MIN:.01,MAX:1e6,TYPE:n.t.FLOAT},GRAVITY_X:{DEFAULT:.175,MIN:-1e6,MAX:1e6,TYPE:n.t.FLOAT},GRAVITY_Y:{DEFAULT:0,MIN:-1e6,MAX:1e6,TYPE:n.t.FLOAT},LAYER_ON:{DEFAULT:1,MIN:0,MAX:99,TYPE:n.t.INT},LAYER_OFF:{DEFAULT:0,MIN:0,MAX:99,TYPE:n.t.INT},LAYER_OFFSET:{DEFAULT:0,MIN:-99,MAX:99,TYPE:n.t.INT}}},779:(e,t,r)=>{var n;r.d(t,{t:()=>n}),function(e){e[e.INT=0]="INT",e[e.FLOAT=1]="FLOAT",e[e.BOOL=2]="BOOL"}(n||(n={}))},461:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>readJsScript});var _TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(925),_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(406),_constraints__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(304),_util__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(974),_type_guards__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(136);function parseCommand(commandId,scriptSection,triggerData){if(commandId===_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.GRAVITY)throw new Error("Gravity parsing not supported!");if(commandId===_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.LAYER)throw new Error("Layer parsing not supported!");if(void 0===_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.BC[commandId].FUNC)throw new Error("Function undefined!");const currentHeader=_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.BC[commandId].FUNC.split("(")[0],currentHeaderIndex=scriptSection.indexOf(currentHeader);if(-1===currentHeaderIndex)throw new Error("Command header not found!");const startIndex=currentHeaderIndex+currentHeader.length+1;let endIndex=startIndex;for(let e=1;e>0||endIndex>=scriptSection.length;endIndex+=1)"("===scriptSection.charAt(endIndex+1)&&(e+=1),")"===scriptSection.charAt(endIndex+1)&&(e-=1);const parameterText=`[${removeLeadingZeroes(scriptSection.substring(startIndex,endIndex),commandId)}]`,parameterArray=eval(parameterText),keyframes=parameterArray[0];(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(keyframes,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.ARR);let smoothing=0;switch(parameterArray.length>0&&(smoothing=parameterArray[1]),commandId){case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.ZOOM:triggerData[commandId].triggers=parseZoomTriggers(keyframes),triggerData[commandId].smoothing=parseNumberSmoothing(smoothing);break;case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.PAN:triggerData[commandId].triggers=parsePanTriggers(keyframes),triggerData[commandId].smoothing=parseNumberSmoothing(smoothing);break;case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.FOCUS:triggerData[commandId].triggers=parseFocusTriggers(keyframes),triggerData[commandId].smoothing=parseNumberSmoothing(smoothing);break;case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.TIME:triggerData[commandId].triggers=parseTimeTriggers(keyframes),triggerData[commandId].interpolate=!0===smoothing;break;case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN:triggerData[commandId].triggers=parseSkinCss(keyframes)}}function parseZoomTriggers(e){const t=[];for(const r of e){(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(r,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.ARR);const e=r[1];(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM);const n=[parseTime(r[0]),e];t.push(n)}return t}function parsePanTriggers(e){const t=[];for(const r of e){(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(r,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.ARR);const e=r[1];(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.RECORD);const{x:n,y:i,w:a,h:o}=e;(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(n,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM),(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(i,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM),(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(a,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM),(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(o,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM);const s=[parseTime(r[0]),{x:n,y:i,w:a,h:o}];t.push(s)}return t}function parseFocusTriggers(e){const t=[];for(const r of e){(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(r,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.ARR);const e=r[1];(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM_ARR);const n=[parseTime(r[0]),e];t.push(n)}return t}function parseTimeTriggers(e){const t=[];for(const r of e){(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(r,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.ARR);const e=r[1];(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM);const n=[parseTime(r[0]),e];t.push(n)}return t}function parseNumberSmoothing(e){const t=_constraints__WEBPACK_IMPORTED_MODULE_2__.s.SMOOTH;return null==e?t.DEFAULT:((0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM),e>t.MAX?t.MAX:e<t.MIN?t.MIN:e)}function parseSkinCss(e){var t;(0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.STR_ARR);const r=[];return e.forEach(((e,t)=>{r.push(structuredClone(_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.BC[_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].TEMPLATE));let n=0,i=0;for(let a=0;a<e.length;a+=1)"{"===e.charAt(a)&&(n+=1),"}"===e.charAt(a)&&(n-=1,0===n&&(r[t]=parseSkinProp(e.substring(i,a+1).replace(/\s/g,"")),i=a+1))})),r.length>0&&r.push(null!==(t=r.shift())&&void 0!==t?t:_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.BC[_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN].TEMPLATE),r}function parseSkinProp(e){const t={},r=/(['"])?([#]?[a-z0-9A-Z_-]+)(['"])?/g;return Object.entries({outline:".outline",flag:".flag",skin:".skin",hair:".hair",fill:".fill",eye:"#eye",sled:".sled",string:"#string",armSleeve:".arm.sleeve",armHand:".arm.hand",legPants:".leg.pants",legFoot:".leg.foot",torso:".torso",hatTop:".hat.top",hatBottom:".hat.bottom",hatBall:".hat.ball",scarf1:".scarf1",scarf2:".scarf2",scarf3:".scarf3",scarf4:".scarf4",scarf5:".scarf5",id_scarf0:"#scarf0",id_scarf1:"#scarf1",id_scarf2:"#scarf2",id_scarf3:"#scarf3",id_scarf4:"#scarf4",id_scarf5:"#scarf5"}).forEach((([n,i])=>{if(!e.startsWith(i))return;const a=JSON.parse(e.substring(i.length).replace(r,'"$2"').replace(";",","));n in t||(t[n]={}),void 0!==a.fill&&(t[n].fill=a.fill),void 0!==a.stroke&&(t[n].stroke=a.stroke)})),t}function removeLeadingZeroes(e,t){return t===_TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.SKIN?e:e.replace(/([^\d.+-])0+(\d+)/g,"$1$2")}function readJsScript(e,t){const r=_TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.G1.initialTriggerData,n=e.replace(/\s/g,"");return _TriggerDataManager__WEBPACK_IMPORTED_MODULE_0__.p6.forEach((e=>{try{r[e].triggers=[],parseCommand(e,n,r)}catch(n){if(n instanceof Error)switch(console.error(`[ScriptParser.parseScript()] ${n.message}`),e){case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.ZOOM:case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.PAN:case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.FOCUS:case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.TIME:case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.GRAVITY:case _TriggerDataManager_types__WEBPACK_IMPORTED_MODULE_1__.n.LAYER:r[e]=structuredClone(t[e])}}})),r}function parseTime(e){let t=[0,0,0];if((0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.z6)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM)){const r=e;t=(0,_util__WEBPACK_IMPORTED_MODULE_3__.nC)(r)}else if((0,_type_guards__WEBPACK_IMPORTED_MODULE_4__.vA)(e,_type_guards__WEBPACK_IMPORTED_MODULE_4__.Cq.NUM_ARR),1===e.length){const r=e[0];t=(0,_util__WEBPACK_IMPORTED_MODULE_3__.nC)(r)}else if(2===e.length){const r=40*e[0]+e[1];t=(0,_util__WEBPACK_IMPORTED_MODULE_3__.nC)(r)}else{const r=2400*e[0]+40*e[1]+e[2];t=(0,_util__WEBPACK_IMPORTED_MODULE_3__.nC)(r)}return t}},136:(e,t,r)=>{var n;function i(e){return"number"==typeof e}function a(e){return"string"==typeof e}function o(e){return Array.isArray(e)}function s(e){return o(e)&&e.every((e=>a(e)))}function l(e){return o(e)&&e.every((e=>i(e)))}function c(e){return"object"==typeof e&&null!==e&&s(Object.keys(e))}function g(e,t){const r=`Assertion failed: ${e} was not ${t}`;switch(t){case n.NUM:if(!i(e))throw new Error(r);break;case n.STR:if(!a(e))throw new Error(r);break;case n.ARR:if(!o(e))throw new Error(r);break;case n.RECORD:if(!c(e))throw new Error(r);break;case n.NUM_ARR:if(!l(e))throw new Error(r);break;case n.STR_ARR:if(!s(e))throw new Error(r)}}function d(e,t){switch(t){case n.NUM:if(!i(e))return!1;break;case n.STR:if(!a(e))return!1;break;case n.ARR:if(!o(e))return!1;break;case n.RECORD:if(!c(e))return!1;break;case n.NUM_ARR:if(!l(e))return!1;break;case n.STR_ARR:if(!s(e))return!1}return!0}r.d(t,{Cq:()=>n,vA:()=>g,z6:()=>d}),function(e){e.STR="string",e.NUM="number",e.ARR="Array",e.NUM_ARR="Array<number>",e.STR_ARR="Array<string>",e.RECORD="Record<string>"}(n||(n={}))},974:(e,t,r)=>{r.d(t,{Hk:()=>c,P:()=>o,Qx:()=>s,Z3:()=>a,hw:()=>g,nC:()=>l});var n=r(406),i=r(925);function a(e,t,r,i){return t===n.n.GRAVITY?e[t].triggers[r]:t===n.n.LAYER?e[t].triggers[i]:e[t].triggers}function o(e){const t=Array(e.length).fill(!1),r=e[0][0];0===r[0]&&0===r[1]&&0===r[2]||(t[0]=!0);for(let r=0;r<e.length-1;r+=1){const n=e[r][0],i=e[r+1][0];40*(60*n[0]+n[1])+n[2]>=40*(60*i[0]+i[1])+i[2]&&(t[r+1]=!0)}return t}function s(e){var t;const r="#ffffffff",n=e.map((e=>{var t,n,i,a,o,s,l,c,g,d,_,h,p,u,m,f,E,A,T,M,C,y,O,R,v,S,b;return[` .outline {stroke: ${null!==(t=e.outline.stroke)&&void 0!==t?t:r}}`,` .skin {fill: ${null!==(n=e.skin.fill)&&void 0!==n?n:r}}`,` .hair {fill: ${null!==(i=e.hair.fill)&&void 0!==i?i:r}}`,` .fill {fill: ${null!==(a=e.fill.fill)&&void 0!==a?a:r}}`,` #eye {fill: ${null!==(o=e.eye.fill)&&void 0!==o?o:r}}`,` .sled {fill: ${null!==(s=e.sled.fill)&&void 0!==s?s:r}}`,` #string {stroke: ${null!==(l=e.string.stroke)&&void 0!==l?l:r}}`,` .arm .sleeve {fill: ${null!==(c=e.armSleeve.fill)&&void 0!==c?c:r}}`,` .arm .hand {fill: ${null!==(g=e.armHand.fill)&&void 0!==g?g:r}}`,` .leg .pants {fill: ${null!==(d=e.legPants.fill)&&void 0!==d?d:r}}`,` .leg .foot {fill: ${null!==(_=e.legFoot.fill)&&void 0!==_?_:r}}`,` .torso {fill: ${null!==(h=e.torso.fill)&&void 0!==h?h:r}}`,` .scarf1 {fill: ${null!==(p=e.scarf1.fill)&&void 0!==p?p:r}}`,` .scarf2 {fill: ${null!==(u=e.scarf2.fill)&&void 0!==u?u:r}}`,` .scarf3 {fill: ${null!==(m=e.scarf3.fill)&&void 0!==m?m:r}}`,` .scarf4 {fill: ${null!==(f=e.scarf4.fill)&&void 0!==f?f:r}}`,` .scarf5 {fill: ${null!==(E=e.scarf5.fill)&&void 0!==E?E:r}}`,` #scarf0 {fill: ${null!==(A=e.id_scarf0.fill)&&void 0!==A?A:r}}`,` #scarf1 {fill: ${null!==(T=e.id_scarf1.fill)&&void 0!==T?T:r}}`,` #scarf2 {fill: ${null!==(M=e.id_scarf2.fill)&&void 0!==M?M:r}}`,` #scarf3 {fill: ${null!==(C=e.id_scarf3.fill)&&void 0!==C?C:r}}`,` #scarf4 {fill: ${null!==(y=e.id_scarf4.fill)&&void 0!==y?y:r}}`,` #scarf5 {fill: ${null!==(O=e.id_scarf5.fill)&&void 0!==O?O:r}}`,` .hat .top {fill: ${null!==(R=e.hatTop.fill)&&void 0!==R?R:r}}`,` .hat .bottom {stroke: ${null!==(v=e.hatBottom.stroke)&&void 0!==v?v:r}}`,` .hat .ball {fill: ${null!==(S=e.hatBall.fill)&&void 0!==S?S:r}}`,` .flag {fill: ${null!==(b=e.flag.fill)&&void 0!==b?b:r}}`].join("").replace(/\n/g,"")}));return n.unshift(null!==(t=n.pop())&&void 0!==t?t:""),n}function l(e){const t=e%40,r=Math.floor(e/40)%60;return[Math.floor(e/2400),r,t]}function c(e){return 2400*e[0]+40*e[1]+e[2]}function g(e,t){const r=i.BC[e].FUNC;if(void 0===r)return"";switch(e){case n.n.FOCUS:case n.n.PAN:case n.n.ZOOM:{const n=t[e];return r.replace("{0}",JSON.stringify(n.triggers)).replace("{1}",String(n.smoothing)).replace(" ","")}case n.n.TIME:{const n=t[e];return r.replace("{0}",JSON.stringify(n.triggers)).replace("{1}",String(n.interpolate)).replace(" ","")}case n.n.SKIN:{const n=t[e];return r.replace("{0}",JSON.stringify(s(n.triggers))).replace(" ","")}default:return""}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{const e="oklch(0.985 0.002 247.839)",t="oklch(0.967 0.003 264.542)",r="oklch(0.928 0.006 264.531)",n="oklch(0.551 0.027 264.364)",i="oklch(0.13 0.028 261.692)",a={primaryBorder:`2px solid ${i}`},o={root:{backgroundColor:r,border:a.primaryBorder,color:"oklch(0.21 0.034 264.665)",fontFamily:"Helvetica",fontWeight:"bold",left:"64px",opacity:0,overflow:"hidden",padding:"3px",pointerEvents:"none",position:"fixed",top:"8px",transition:"opacity 225ms cubic-bezier(0.4, 0, 0.2, 1) 0ms"},actionContainer:{alignItems:"center",display:"flex",width:"100%"},mainContent:{alignItems:"center",display:"flex",height:"50vh",flexDirection:"column",justifyContent:"center",width:"max(37.5vw, 600px)"},windowContainer:{display:"flex",height:"100%",flexDirection:"column",width:"100%"},windowHead:{alignItems:"center",backgroundColor:t,border:a.primaryBorder,borderBottom:"none",display:"flex",fontSize:"1.5em",height:"2.5em",justifyContent:"start"},windowBody:{backgroundColor:"oklch(0.872 0.01 258.338)",border:a.primaryBorder,boxShadow:"inset 0px 0px 8px 0px #000",display:"flex",flex:1,flexDirection:"column",overflowY:"scroll",scrollbarColor:`${n} ${r}`,scrollbarWidth:"thin"},triggerContainer:{alignItems:"start",backgroundColor:t,borderBottom:a.primaryBorder,boxShadow:"0px 4px 8px -4px #000",display:"flex",flexDirection:"column",padding:"0.75em",position:"relative"},triggerActionContainer:{alignItems:"center",display:"flex",flexDirection:"row",direction:"ltr",justifyContent:"space-between",position:"absolute",right:"0px"},triggerRowContainer:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"center"},triggerPropContainer:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"start",marginBottom:"5px",width:"100%",whiteSpace:"nowrap"},spacedProperty:{margin:"0 5px"},createTriggerContainer:{bottom:"0px",display:"flex",justifyContent:"center",left:"0px",marginLeft:"auto",marginRight:"auto",position:"absolute",right:"0px",transform:"translateY(50%)",zIndex:1},tabContainer:{alignItems:"end",display:"flex",justifyContent:"start",flexDirection:"row",width:"100%"},tabButton:{borderRadius:"5px 5px 0px 0px",marginRight:"-2px",transform:"translateY(2px)",zIndex:1}};var s,l,c,g=__webpack_require__(925),d=__webpack_require__(406),_=__webpack_require__(461),h=__webpack_require__(304),p=__webpack_require__(974),u=__webpack_require__(136);function m(e){const t=h.s.SMOOTH;return null==e?t.DEFAULT:((0,u.vA)(e,u.Cq.NUM),e>t.MAX?t.MAX:e<t.MIN?t.MIN:e)}function f(e){const t=h.s.INTERPOLATE;if(null==e)return t.DEFAULT;if(!0!==e&&!1!==e)throw new Error("Invalid boolean smoothing value!");return e}function E(e){let t=[0,0,0];if((0,u.z6)(e,u.Cq.NUM)){const r=e;t=(0,p.nC)(r)}else if((0,u.vA)(e,u.Cq.NUM_ARR),1===e.length){const r=e[0];t=(0,p.nC)(r)}else if(2===e.length){const r=40*e[0]+e[1];t=(0,p.nC)(r)}else{const r=2400*e[0]+40*e[1]+e[2];t=(0,p.nC)(r)}return t}function A(e){const t=h.s.SMOOTH;return null==e?t.DEFAULT:((0,u.vA)(e,u.Cq.NUM),e>t.MAX?t.MAX:e<t.MIN?t.MIN:e)}function T(e){const t=h.s.INTERPOLATE;if(null==e)return t.DEFAULT;if(!0!==e&&!1!==e)throw new Error("Invalid boolean smoothing value!");return e}!function(e){e[e.VIEWPORT=0]="VIEWPORT",e[e.FONT_SIZE=1]="FONT_SIZE"}(s||(s={})),function(e){e[e.HD=0]="HD",e[e.FHD=1]="FHD",e[e.QHD=2]="QHD",e[e.UHD=3]="UHD"}(l||(l={})),function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE"}(c||(c={}));const M="CMD_EDITOR_MOD_",C={[s.FONT_SIZE]:c.MEDIUM,[s.VIEWPORT]:l.HD},y={[c.SMALL]:"12px",[c.MEDIUM]:"14px",[c.LARGE]:"16px"};function O(e){const t=window.localStorage.getItem(M+e);if(!t)return C[e];const r=parseInt(t,10);return isNaN(r)?C[e]:r}function R(e,t){window.localStorage.setItem(M+e,String(t))}function v(e){return e.simulator.engine.engine.state.riders.length}function S(e){return e.player.index}function b(e){return!!e.views.Sidebar}const{React:D}=window,w={fill:"none",height:"1em",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",style:{position:"absolute"},viewBox:"0 0 24 24",width:"1em"},P=D.createElement("svg",Object.assign({},w),D.createElement("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),D.createElement("polyline",{points:"7 10 12 15 17 10"}),D.createElement("line",{x1:"12",y1:"15",x2:"12",y2:"3"})),I=D.createElement("svg",Object.assign({},w),D.createElement("polyline",{points:"15 14 20 9 15 4"}),D.createElement("path",{d:"M4 20v-7a4 4 0 0 1 4-4h12"})),k=D.createElement("svg",Object.assign({},w),D.createElement("polygon",{points:"5 3 19 12 5 21 5 3"})),x=D.createElement("svg",Object.assign({},w),D.createElement("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),D.createElement("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})),L=D.createElement("svg",Object.assign({},w),D.createElement("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),D.createElement("polyline",{points:"17 8 12 3 7 8"}),D.createElement("line",{x1:"12",y1:"3",x2:"12",y2:"15"})),U=D.createElement("svg",Object.assign({},w),D.createElement("circle",{cx:"12",cy:"12",r:"3"}),D.createElement("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})),N=D.createElement("svg",Object.assign({},w),D.createElement("circle",{cx:"12",cy:"12",r:"10"}),D.createElement("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),D.createElement("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})),F=D.createElement("svg",Object.assign({},w),D.createElement("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})),B=D.createElement("svg",Object.assign({},w),D.createElement("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})),j=(D.createElement("svg",Object.assign({},w),D.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),D.createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"})),D.createElement("svg",Object.assign({},w),D.createElement("circle",{cx:"12",cy:"12",r:"10"}),D.createElement("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),D.createElement("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),D.createElement("svg",Object.assign({},w),D.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),D.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))),Y=D.createElement("svg",Object.assign({},w),D.createElement("polyline",{points:"3 6 5 6 21 6"}),D.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),D.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),D.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"})),K=D.createElement("svg",Object.assign({},w),D.createElement("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),D.createElement("polyline",{points:"12 19 5 12 12 5"})),W=D.createElement("svg",Object.assign({},w),D.createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),D.createElement("polyline",{points:"12 5 19 12 12 19"})),q=D.createElement("svg",Object.assign({},w),D.createElement("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),D.createElement("circle",{cx:"12",cy:"13",r:"4"})),{React:H}=window;function V(e,t,r,n,i){const a=Number(t);return Number.isNaN(a)?e:r?Math.max(n,Math.min(i,a)):t.includes(".")||"-"===t||""===t?t:a}const Z={backgroundColor:e,border:a.primaryBorder,borderRadius:"5px",boxShadow:"inset 0px 1px 4px -1px #000",height:"1.25em",padding:"5px",textAlign:"right",width:"3em"};function G({customStyle:e,id:t,value:r,min:n,max:i,onChange:a}){return H.createElement("input",{style:Object.assign(Object.assign({},Z),e),id:t,value:r,min:n,max:i,onChange:e=>a(V(r,e.target.value,!1,n,i)),onBlur:e=>a(V(r,e.target.value,!0,n,i))})}const{React:$}=window;function z(e,t,r,n,i){const a=Number(t);return Number.isNaN(a)||!Number.isInteger(a)?e:r?Math.max(n,Math.min(i,a)):"-"===t||""===t?t:a}const X={backgroundColor:e,border:a.primaryBorder,borderRadius:"5px",boxShadow:"inset 0px 1px 4px -1px #000",height:"1.25em",padding:"5px",textAlign:"right",width:"3em"};function J({customStyle:e,id:t,value:r,min:n,max:i,onChange:a}){return $.createElement("input",{style:Object.assign(Object.assign({},X),e),id:t,value:r,min:n,max:i,onChange:e=>a(z(r,e.target.value,!1,n,i)),onBlur:e=>a(z(r,e.target.value,!0,n,i))})}const{React:Q}=window;var ee;!function(e){e[e.BLURRED=0]="BLURRED",e[e.HOVER=1]="HOVER",e[e.PRESSED=2]="PRESSED"}(ee||(ee={}));const te={alignItems:"center",borderRadius:"0.5em",border:"none",display:"flex",height:"1.5em",justifyContent:"center",userSelect:"none",width:"1.5em",transition:"background-color 0.125s ease-in-out"},re={[ee.BLURRED]:"#00000000",[ee.HOVER]:"#00000066",[ee.PRESSED]:"#00000033"};class ne extends Q.Component{constructor(e){super(e),this.state={mode:ee.BLURRED}}render(){const{customStyle:e,disabled:t,icon:r,onClick:a,size:o,title:s}=this.props;return t&&this.state.mode!==ee.BLURRED&&this.setState({mode:ee.BLURRED}),Q.createElement("button",{title:s,style:Object.assign(Object.assign(Object.assign({},te),e),{backgroundColor:re[this.state.mode],fontSize:o||"25px",color:t?n:i}),onMouseOver:()=>!t&&this.setState({mode:ee.HOVER}),onMouseOut:()=>!t&&this.setState({mode:ee.BLURRED}),onMouseDown:()=>!t&&this.setState({mode:ee.PRESSED}),onMouseUp:()=>!t&&this.setState({mode:ee.HOVER}),onClick:()=>a(),disabled:t},r)}}const{React:ie}=window,ae={head:{backgroundColor:e,border:a.primaryBorder,borderRadius:"5px",boxShadow:"0px 1px 4px -1px #000",cursor:"pointer",height:"1.5em",textAlign:"right"},option:{backgroundColor:e,border:a.primaryBorder,height:"1.25em",textAlign:"center"}};function oe({customStyle:e,value:t,mapping:r,label:n,onChange:i}){return ie.createElement("select",{style:Object.assign(Object.assign({},ae.head),e),value:t,onChange:e=>i(parseInt(e.target.value))},...r.map(((e,t)=>ie.createElement("option",{style:ae.option,value:e},n(e,t)))))}const{React:se,store:le}=window,ce={container:{alignItems:"center",backgroundColor:t,boxShadow:"none",justifyContent:"center",overflow:"hidden",position:"relative",userSelect:"none",width:"100%"},gridBackground:{background:"linear-gradient(45deg, #aaa 25%, transparent 25%, transparent 75%, #aaa 75%), linear-gradient(-45deg, #aaa 25%, transparent 25%, transparent 75%, #aaa 75%)",backgroundSize:"10px 10px",height:"1000px",position:"absolute",transform:"rotate(45deg)",width:"1000px"},canvas:{alignItems:"center",display:"flex",height:"100%",justifyContent:"center",position:"absolute",width:"100%"},outlineContainer:{alignItems:"center",bottom:"10px",display:"flex",position:"absolute",left:"10px"},outlineInput:{border:"1px solid black",borderRadius:"10px",height:"20px",marginLeft:"3px",width:"20px"},alphaContainer:{alignItems:"center",display:"flex",flexDirection:"column",fontSize:"0.75em",justifyContent:"center",position:"relative"},alphaSliderContainer:{alignItems:"center",display:"flex",position:"relative"},alphaSlider:{accentColor:"black",appearance:"none",background:"linear-gradient(to left, black, white)",border:a.primaryBorder,borderRadius:"5px",cursor:"move",height:"10px",marginTop:"3px",width:"100px"},colorPicker:{border:a.primaryBorder,borderRadius:"5px",cursor:"pointer",height:"1.5em",width:"1.5em"}};function ge({skinEditor:e,root:t}){const r=e.state.selectedColor.substring(0,7),n=parseInt(e.state.selectedColor.substring(7),16)/255;return se.createElement("div",{style:o.windowHead},se.createElement(ne,{onClick:()=>t.onResetSkin(e.state.selectedRider),icon:Y,customStyle:{position:"absolute",right:"10px"},title:"Reset Skin"}),se.createElement("div",{style:Object.assign(Object.assign({},o.spacedProperty),ce.alphaContainer)},se.createElement("label",{htmlFor:"alphaSlider"},"Transparency"),se.createElement("div",{style:ce.alphaSliderContainer},se.createElement("input",{id:"alphaSlider",style:ce.alphaSlider,type:"range",min:0,max:1,step:.01,value:n,onChange:t=>e.onChangeColor(void 0,t.target.value)}))),se.createElement("input",{style:Object.assign(Object.assign({},o.spacedProperty),ce.colorPicker),type:"color",value:r,onChange:t=>e.onChangeColor(t.target.value,void 0)}),se.createElement(oe,{customStyle:o.spacedProperty,value:e.state.selectedRider,mapping:[...Array(t.state.numRiders).keys()],label:(e,t)=>`Rider ${t+1}`,onChange:t=>e.onChooseRider(t)}))}const de={transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3Z"},_e={transform:"translate(-5, -3)",d:"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z"},he={transform:"translate(13,8) rotate(-90)",width:"3.1",height:"4.5"},pe={strokeWidth:"0.3",transform:"translate(17.3,8.1) rotate(-90)",d:"M 0 -0.25 v 0.4 c 0.1 1.3 1.2 1.2 3.1 0 v -0.4"},ue={transform:"translate(12.4, 5.15) rotate(-90)",width:"0.3",height:"5.1"},me={transform:"translate(12.2, 8.1) rotate(-90)",width:"3.1",height:"0.3"},fe={transform:"translate(12.2,4.2) scale(0.8,0.8)",width:"3.1",height:"4.8"},Ee={transform:"translate(16.3,6.7)",points:"0.4,-0.4 0,-0.5 -0.4,-0.4 -0.5,0 -0.4,0.4 0,0.5 0.4,0.4 0.5,0"},Ae={strokeWidth:"0.3",transform:"translate(9.7, 15.9) scale(1.04,1)",d:"M13.6-2.2c-1.35,0-2.55,0.75-3.15,1.85H0C-0.2-0.35-0.35-0.2-0.35,0S-0.2,0.35,0,0.35h1.75V4.4H-0.2c-0.2,0-0.35,0.15-0.35,0.35S-0.4,5.1-0.2,5.1h13.8c2,0,3.65-1.65,3.65-3.65S15.6-2.2,13.6-2.2zM9.05,4.4h-6.6V0.35h6.6V4.4z M13.6,4.4H9.75V0.35h0.35C10.05,0.5,10,0.7,10,0.9c0,0.2,0.15,0.35,0.35,0.35c0.15,0,0.3-0.1,0.35-0.25c0.05-0.2,0.1-0.45,0.2-0.65h0.9c0.2,0,0.35-0.15,0.35-0.35S12-0.35,11.8-0.35h-0.5c0.5-0.7,1.35-1.15,2.3-1.15c1.65,0,2.95,1.3,2.95,2.95C16.55,3.1,15.25,4.4,13.6,4.4z"},Te={transform:"translate(21.5, 10.5) rotate(40)",x1:"0",y1:"0",x2:"8",y2:"0",strokeWidth:"0.3"},Me={strokeWidth:"0.3",transform:"translate(15, 10) rotate(5)",d:"M5-0.7h0.5c0,0,0.3-0.7,0.5-0.6c0.2,0.1,0,0.6,0,0.6s0.4,0,0.6,0c0.2,0,0.5,0.3,0.5,0.7c0,0.4-0.2,0.7-0.5,0.7c-0.5,0-1.6,0-1.6,0"},Ce={strokeWidth:"0.3",transform:"translate(15, 16) rotate(45)",d:"M4.8-0.7H0c-0.4,0-0.7,0.3-0.7,0.7S-0.4,0.7,0,0.7h4.8"},ye={strokeWidth:"0.3",transform:"translate(15, 16) rotate(45)",d:"M4.8,0.7h2.4l0-2.7L6.7-2L6-0.7H4.8"},Oe={transform:"translate(10.5, 8.5)",strokeWidth:"0",width:"2",height:"2"},Re={strokeWidth:"0.3",transform:"translate(16.9, 8.1) rotate(90)",width:"7.8",height:"4.4"},ve={transform:"translate(14.8, 15.2) rotate(-90)",width:"2",height:"1",strokeWidth:"0",x:"5.2"},Se={strokeWidth:"0.3",transform:"translate(14.8,5) rotate(-90) translate(-10,0)",d:"M11-2.6h-0.4v5.2H11c1.2,0,2.2-1.2,2.2-2.6S12.2-2.6,11-2.6z"},be={transform:"translate(14.8,5) rotate(-90) translate(-10,0)",strokeWidth:"1",strokeLinecap:"round",d:"M10.6-2.6 v5.2"},De={transform:"translate(14.8,5) rotate(-90) translate(-10,0)",cx:"13.9",cy:"0",r:"0.7"},we={strokeWidth:"0.3",transform:"translate(15, 10) rotate(5)",d:"M5,0.7H0c-0.4,0-0.7-0.3-0.7-0.7S-0.4-0.7,0-0.7h5"};function Pe({skinEditor:e,root:t,skinCss:r}){const n=r.outline.stroke,i=(r,n=!1)=>{t.onUpdateTrigger(e.state.selectedColor,["triggers",e.state.selectedRider.toString(),r,n?"stroke":"fill"])};return se.createElement("div",{id:"skinElementContainer",style:Object.assign(Object.assign({},ce.canvas),{transform:`scale(${e.state.zoom})`,transformOrigin:`${e.state.xOffset}px ${e.state.yOffset}px`}),onWheel:t=>e.onZoom(t)},se.createElement("svg",{height:"18",width:"15",style:{transform:"scale(8)"}},se.createElement("path",Object.assign({},de,{fill:r.flag.fill,onClick:()=>i("flag")})),se.createElement("path",Object.assign({},_e,{fill:r.flag.fill,onClick:()=>i("flag")}))),se.createElement("svg",{width:"200"}),se.createElement("svg",{height:"25",width:"31",style:{transform:"scale(8)"}},se.createElement("rect",Object.assign({},he,{fill:r.skin.fill,onClick:()=>i("skin")})),se.createElement("path",Object.assign({},pe,{stroke:n,fill:r.skin.fill,onClick:()=>i("skin")})),se.createElement("rect",Object.assign({},ue,{fill:r.hair.fill,onClick:()=>i("hair")})),se.createElement("rect",Object.assign({},me,{fill:r.hair.fill,onClick:()=>i("hair")})),se.createElement("rect",Object.assign({},fe,{fill:r.fill.fill,onClick:()=>i("fill")})),se.createElement("polygon",Object.assign({},Ee,{fill:r.eye.fill,onClick:()=>i("eye")})),se.createElement("path",Object.assign({},Ae,{stroke:n,fill:r.sled.fill,onClick:()=>i("sled")})),se.createElement("line",Object.assign({},Te,{stroke:r.string.stroke,onClick:()=>i("string",!0)})),se.createElement("path",Object.assign({},Me,{stroke:n,fill:r.armHand.fill,onClick:()=>i("armHand")})),se.createElement("path",Object.assign({},Ce,{stroke:n,fill:r.legPants.fill,onClick:()=>i("legPants")})),se.createElement("path",Object.assign({},ye,{stroke:n,fill:r.legFoot.fill,onClick:()=>i("legFoot")})),se.createElement("rect",Object.assign({},Oe,{x:"2",fill:r.id_scarf0.fill,onClick:()=>i("id_scarf0")})),se.createElement("rect",Object.assign({},Oe,{x:"0",fill:r.id_scarf0.fill,onClick:()=>i("id_scarf0")})),se.createElement("rect",Object.assign({},Oe,{x:"-2",fill:r.id_scarf1.fill,onClick:()=>i("id_scarf1")})),se.createElement("rect",Object.assign({},Oe,{x:"-4",fill:r.id_scarf2.fill,onClick:()=>i("id_scarf2")})),se.createElement("rect",Object.assign({},Oe,{x:"-6",fill:r.id_scarf3.fill,onClick:()=>i("id_scarf3")})),se.createElement("rect",Object.assign({},Oe,{x:"-8",fill:r.id_scarf4.fill,onClick:()=>i("id_scarf4")})),se.createElement("rect",Object.assign({},Oe,{x:"-10",fill:r.id_scarf5.fill,onClick:()=>i("id_scarf5")})),se.createElement("rect",Object.assign({},Re,{stroke:n,fill:r.torso.fill,onClick:()=>i("torso")})),se.createElement("rect",Object.assign({},ve,{y:"1.5",fill:r.scarf1.fill,onClick:()=>i("scarf1")})),se.createElement("rect",Object.assign({},ve,{y:"0.5",fill:r.scarf2.fill,onClick:()=>i("scarf2")})),se.createElement("rect",Object.assign({},ve,{y:"-0.5",fill:r.scarf3.fill,onClick:()=>i("scarf3")})),se.createElement("rect",Object.assign({},ve,{y:"-1.5",fill:r.scarf4.fill,onClick:()=>i("scarf4")})),se.createElement("rect",Object.assign({},ve,{y:"-2.5",fill:r.scarf5.fill,onClick:()=>i("scarf5")})),se.createElement("path",Object.assign({},Se,{stroke:n,fill:r.hatTop.fill,onClick:()=>i("hatTop")})),se.createElement("path",Object.assign({},be,{stroke:r.hatBottom.stroke,onClick:()=>i("hatBottom",!0)})),se.createElement("circle",Object.assign({},De,{fill:r.hatBall.fill,onClick:()=>i("hatBall")})),se.createElement("path",Object.assign({},we,{stroke:n,fill:r.armSleeve.fill,onClick:()=>i("armSleeve")}))))}class Ie extends se.Component{constructor(e){super(e),this.state={selectedRider:0,selectedColor:"#000000ff",zoom:1,xOffset:0,yOffset:0},le.subscribe((()=>this.updateStore()))}updateStore(){const e=v(le.getState());this.state.selectedRider>=e&&this.setState({selectedRider:e-1})}onChooseRider(e){this.setState({selectedRider:e})}onChangeColor(e,t){const{selectedColor:r}=this.state,n=null!=t?Math.round(255*Math.min(Math.max(parseFloat(t),0),1)).toString(16).padStart(2,"0"):r.substring(7),i=null!=e?e+n:r.substring(0,7)+n;this.setState({selectedColor:i})}onZoom(e){const{zoom:t,xOffset:r,yOffset:n}=this.state,i=document.getElementById("skinElementContainer").getBoundingClientRect(),a={zoom:t,xOffset:r,yOffset:n};t<4&&(a.xOffset=(e.clientX-i.x)/t,a.yOffset=(e.clientY-i.y)/t),a.zoom=Math.max(Math.min(t-.001*e.deltaY,4),1),this.setState(a)}render(){const{root:e,skinTriggers:t}=this.props;return se.createElement(se.Fragment,null,se.createElement(ge,{skinEditor:this,root:e}),se.createElement("div",{style:Object.assign(Object.assign({},o.windowBody),ce.container)},se.createElement("div",{style:ce.gridBackground}),se.createElement(Pe,{skinEditor:this,root:e,skinCss:t[this.state.selectedRider]}),se.createElement("div",{style:ce.outlineContainer},se.createElement("text",null,"Outline"),se.createElement("div",{style:Object.assign(Object.assign({},ce.outlineInput),{backgroundColor:t[this.state.selectedRider].outline.stroke}),onClick:()=>e.onUpdateTrigger(this.state.selectedColor,["triggers",this.state.selectedRider.toString(),"outline","stroke"])}))))}}const{React:ke}=window;var xe;!function(e){e[e.BLURRED=0]="BLURRED",e[e.PRESSED=1]="PRESSED"}(xe||(xe={}));const Le={border:a.primaryBorder,borderRadius:"5px",position:"relative"},Ue={[xe.BLURRED]:"0px 1px 4px -1px #000",[xe.PRESSED]:"none"};class Ne extends ke.Component{constructor(e){super(e),this.state={mode:xe.BLURRED}}render(){const{active:e,customStyle:r,disabled:n,disabledShadow:i,label:a,onClick:o,tabButton:s}=this.props;return n&&this.state.mode!==xe.BLURRED&&this.setState({mode:xe.BLURRED}),ke.createElement("button",{style:Object.assign(Object.assign(Object.assign({},Le),r),{boxShadow:i?"none":Ue[this.state.mode],backgroundColor:!n&&e?t:"oklch(0.707 0.022 261.325)"}),onMouseDown:()=>!n&&this.setState({mode:xe.PRESSED}),onMouseUp:()=>!n&&this.setState({mode:xe.BLURRED}),onClick:()=>o(),disabled:n},a,s&&!n&&e&&ke.createElement("div",{style:{backgroundColor:t,bottom:"-3px",height:"4px",left:"0",position:"absolute",right:"0",zIndex:1}}))}}const{React:Fe}=window,Be={window:{backgroundColor:t,border:a.primaryBorder,boxShadow:"0px 4px 8px -4px #000",display:"flex",flexDirection:"column",flex:9,position:"relative",width:"100%"},header:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:"3em",margin:"10px",position:"relative"},applyButton:{left:"0px",position:"absolute"},row:{alignItems:"center",display:"flex",flexDirection:"row",height:"1.5em",minHeight:"3em",padding:"1em"},label:{position:"absolute",left:"5px"},parameter:{position:"absolute",right:"5px"}};function je({root:e,settings:t}){return Fe.createElement("div",{style:Object.assign(Object.assign({},Be.header),{fontSize:"1.5em"})},Fe.createElement(ne,{onClick:()=>e.onToggleSettings(),icon:j,customStyle:{position:"absolute",right:"0px"},title:"Close"}),"Settings",Fe.createElement(Ne,{customStyle:Be.applyButton,active:t.state.dirty,disabled:!t.state.dirty,onClick:()=>t.onApply(),label:"Apply"}))}const Ye={[s.FONT_SIZE]:[[c.SMALL,"Small"],[c.MEDIUM,"Medium"],[c.LARGE,"Large"]],[s.VIEWPORT]:[[l.HD,"720p"],[l.FHD,"1080p"],[l.QHD,"1440p"],[l.UHD,"4K"]]};function Ke({current:e,onClick:t,title:r,lkey:n}){return Fe.createElement("div",{style:Be.row},Fe.createElement("text",{style:Be.label},r),Fe.createElement("div",{style:Be.parameter},...Ye[n].map((([r,n])=>Fe.createElement(Ne,{customStyle:{margin:"5px"},active:e===r,label:n,onClick:()=>t(r)})))))}class We extends Fe.Component{constructor(e){super(e),this.state={fontSize:O(s.FONT_SIZE),resolution:O(s.VIEWPORT),dirty:!1}}onChangeFontSize(e){const{fontSize:t}=this.state;e!==t&&this.setState({dirty:!0}),this.setState({fontSize:e})}onChangeViewport(e){const{resolution:t}=this.state;t!==e&&this.setState({dirty:!0}),this.setState({resolution:e})}onApply(){const{resolution:e,fontSize:t}=this.state,{root:r}=this.props;r.onApplyViewport(e),R(s.FONT_SIZE,t),R(s.VIEWPORT,e),r.setState({fontSize:t,resolution:e}),this.setState({dirty:!1})}render(){const{root:e}=this.props;return Fe.createElement("div",{style:Be.window},Fe.createElement(je,{root:e,settings:this}),Fe.createElement("div",null,Fe.createElement(Ke,{current:this.state.fontSize,onClick:e=>this.onChangeFontSize(e),title:"Font Sizes",lkey:s.FONT_SIZE}),Fe.createElement(Ke,{current:this.state.resolution,onClick:e=>this.onChangeViewport(e),title:"Viewport",lkey:s.VIEWPORT})))}}const{React:qe}=window,He={container:{alignItems:"center",display:"flex",height:"1.25em",justifyContent:"center",position:"relative",width:"1.25em"},primary:{appearance:"none",background:e,border:a.primaryBorder,borderRadius:"50%",boxSizing:"border-box",boxShadow:"inset 0px 1px 4px -1px #000",cursor:"pointer",height:"100%",position:"absolute",width:"100%"},fill:{backgroundColor:"#000",borderRadius:"60%",height:"60%",pointerEvents:"none",position:"absolute",transition:"opacity 0.125s ease-in-out",width:"60%"}};function Ve({customStyle:e,id:t,value:r,onCheck:n}){return qe.createElement("div",{style:Object.assign(Object.assign({},He.container),e)},qe.createElement("input",{id:t,style:He.primary,type:"checkbox",onChange:()=>n()}),qe.createElement("div",{style:Object.assign(Object.assign({},He.fill),{opacity:r?"100":"0"})}))}var Ze=__webpack_require__(779),Ge=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))};const{store:$e,React:ze}=window;class Xe extends ze.Component{constructor(e){super(e),this.triggerManager=new g.G1,this.state={active:!1,activeTab:d.n.ZOOM,triggerUpdateFlag:!1,numRiders:1,layerMap:[0],focusDropdown:0,gravityDropdown:0,layerDropdown:0,settingsActive:!1,fontSize:O(s.FONT_SIZE),resolution:O(s.VIEWPORT),invalidTimes:[]},$e.subscribe((()=>this.updateStore()))}componentDidMount(){window.saveCommands=()=>this.onDownload()}updateStore(e=!1){const t=v($e.getState()),r={};if(e||this.state.numRiders!==t){const{focusDropdown:e,gravityDropdown:n}=this.state;t>0?(this.triggerManager.updateRiderCount(t),r.triggerUpdateFlag=!this.state.triggerUpdateFlag,r.focusDropdown=Math.min(t-1,e),r.gravityDropdown=Math.min(t-1,n)):[d.n.FOCUS,d.n.GRAVITY,d.n.SKIN].includes(this.state.activeTab)&&(r.activeTab=d.n.ZOOM),r.numRiders=t}const n=$e.getState().simulator.committedEngine.engine.state.layers.toArray().map((e=>e.id));if(e||this.state.layerMap.length!==n.length){const{layerDropdown:e}=this.state;this.triggerManager.updateLayerMap(n),r.triggerUpdateFlag=!this.state.triggerUpdateFlag,n.includes(e)||(r.layerDropdown=n[0]),r.layerMap=n}b($e.getState())&&(r.active=!1),this.setState(r)}onCreateTrigger(e){const{activeTab:t,gravityDropdown:r,layerDropdown:n}=this.state;if(t===d.n.SKIN)return;const i=S($e.getState()),a=[Math.floor(i/2400),Math.floor(i%2400/40),Math.floor(i%40)],o=(0,p.Z3)(this.triggerManager.data,t,r,n),s=structuredClone(o[e]);s[0]=a;const l=o.slice(0,e+1).concat([s]).concat(o.slice(e+1)),c=t===d.n.GRAVITY?[t,"triggers",r.toString()]:t===d.n.LAYER?[t,"triggers",n.toString()]:[t,"triggers"];this.triggerManager.updateFromPath(c,l,t),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),this.setState({invalidTimes:(0,p.P)(l)})}onUpdateTrigger(e,t){const{activeTab:r,gravityDropdown:n,layerDropdown:i}=this.state;if(this.triggerManager.updateFromPath([r,...t],e,r),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),r!==d.n.SKIN){const e=(0,p.Z3)(this.triggerManager.data,r,n,i);this.setState({invalidTimes:(0,p.P)(e)})}}onDeleteTrigger(e){const{activeTab:t,gravityDropdown:r,layerDropdown:n}=this.state;if(t===d.n.SKIN)return;const i=(0,p.Z3)(this.triggerManager.data,t,r,n),a=i.slice(0,e).concat(i.slice(e+1)),o=t===d.n.GRAVITY?[t,"triggers",r.toString()]:t===d.n.LAYER?[t,"triggers",n.toString()]:[t,"triggers"];this.triggerManager.updateFromPath(o,a,t),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),this.setState({invalidTimes:(0,p.P)(a)})}onDownload(){const e=JSON.stringify((t=this.triggerManager.data,{version:1,[d.n.ZOOM]:{smoothing:t[d.n.ZOOM].smoothing,triggers:t[d.n.ZOOM].triggers.map((e=>[(0,p.Hk)(e[0]),e[1]]))},[d.n.PAN]:{smoothing:t[d.n.PAN].smoothing,triggers:t[d.n.PAN].triggers.map((e=>[(0,p.Hk)(e[0]),e[1].w,e[1].h,e[1].x,e[1].y]))},[d.n.FOCUS]:{smoothing:t[d.n.FOCUS].smoothing,triggers:t[d.n.FOCUS].triggers.map((e=>[(0,p.Hk)(e[0]),e[1].map((e=>e))]))},[d.n.TIME]:{interpolate:t[d.n.TIME].interpolate,triggers:t[d.n.TIME].triggers.map((e=>[(0,p.Hk)(e[0]),e[1]]))},[d.n.SKIN]:{triggers:t[d.n.SKIN].triggers.map((e=>Object.fromEntries(Object.entries(e).map((([e,t])=>[e,{fill:t.fill,stroke:t.stroke}])))))},[d.n.GRAVITY]:{triggers:t[d.n.GRAVITY].triggers.map((e=>e.map((e=>[(0,p.Hk)(e[0]),e[1].x,e[1].y]))))},[d.n.LAYER]:{interpolate:t[d.n.LAYER].interpolate,triggers:Object.fromEntries(Object.entries(t[d.n.LAYER].triggers).map((([e,t])=>[e,t.map((e=>[(0,p.Hk)(e[0]),e[1].on,e[1].off,e[1].offset]))])))}}));var t;const r=document.createElement("a"),n="data:text/json;charset=utf-8,"+encodeURIComponent(e);r.setAttribute("href",n),r.setAttribute("download",$e.getState().trackData.label+".script.json"),r.click(),r.remove()}onUpload(){const e=document.getElementById("trigger-file-upload");e.value="",e.click()}onLoadFile(e){const t=new window.FileReader;t.onload=()=>{try{this.onLoad(function(e,t){const r=g.G1.initialTriggerData;let n=-1;if((0,u.vA)(e,u.Cq.RECORD),void 0===e.version||0===e.version)n=0;else{if(1!==e.version)return console.error("[ScriptParser.parseScript()] Invalid file version!"),t;n=1}return g.p6.forEach((i=>{try{switch(r[i].triggers=[],n){case 0:!function(e,t,r){const n=t[e];switch((0,u.vA)(n,u.Cq.RECORD),(0,u.vA)(n.triggers,u.Cq.ARR),e){case d.n.ZOOM:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.ARR);const e=r[1];(0,u.vA)(e,u.Cq.NUM);const n=[E(r[0]),e];t.push(n)}return t}(n.triggers),r[e].smoothing=m(n.smoothing);break;case d.n.PAN:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.ARR);const e=r[1];(0,u.vA)(e,u.Cq.RECORD);const{x:n,y:i,w:a,h:o}=e;(0,u.vA)(n,u.Cq.NUM),(0,u.vA)(i,u.Cq.NUM),(0,u.vA)(a,u.Cq.NUM),(0,u.vA)(o,u.Cq.NUM);const s=[E(r[0]),{x:n,y:i,w:a,h:o}];t.push(s)}return t}(n.triggers),r[e].smoothing=m(n.smoothing);break;case d.n.FOCUS:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.ARR);const e=r[1];(0,u.vA)(e,u.Cq.NUM_ARR);const n=[E(r[0]),e];t.push(n)}return t}(n.triggers),r[e].smoothing=m(n.smoothing);break;case d.n.TIME:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.ARR);const e=r[1];(0,u.vA)(e,u.Cq.NUM);const n=[E(r[0]),e];t.push(n)}return t}(n.triggers),r[e].interpolate=f(n.interpolate);break;case d.n.SKIN:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.RECORD);const e=structuredClone(g.BC[d.n.SKIN].TEMPLATE);for(const t of Object.keys(e))(0,u.vA)(r[t],u.Cq.RECORD),(0,u.z6)(r[t].fill,u.Cq.STR)&&(e[t].fill=r[t].fill),(0,u.z6)(r[t].stroke,u.Cq.STR)&&(e[t].stroke=r[t].stroke);t.push(e)}return t}(n.triggers);break;case d.n.GRAVITY:r[e].triggers=function(e){const t=[];for(const r of e){if((0,u.vA)(r,u.Cq.ARR),(0,u.vA)(r[0],u.Cq.NUM_ARR),r[0].length<3)throw new Error("Trigger time did not have valid length!");const e=[r[0][0],r[0][1],r[0][2]];(0,u.vA)(r[1],u.Cq.ARR);for(let n=0;n<r[1].length;n++){const i=r[1][n];for((0,u.vA)(i,u.Cq.RECORD),(0,u.vA)(i.x,u.Cq.NUM),(0,u.vA)(i.y,u.Cq.NUM);t.length<=n;)t.push([]);t[n].push([e,{x:i.x,y:i.y}])}}return t}(n.triggers);break;case d.n.LAYER:r[e].triggers=function(e){const t={};for(const r of e){if((0,u.vA)(r,u.Cq.ARR),(0,u.vA)(r[0],u.Cq.NUM_ARR),r[0].length<3)throw new Error("Trigger time did not have valid length!");const e=[r[0][0],r[0][1],r[0][2]],n=r[1];(0,u.vA)(n,u.Cq.RECORD),(0,u.vA)(n.id,u.Cq.NUM),(0,u.vA)(n.on,u.Cq.NUM),(0,u.vA)(n.off,u.Cq.NUM),(0,u.vA)(n.offset,u.Cq.NUM),n.id in t||(t[n.id]=[]),t[n.id].push([e,{on:n.on,off:n.off,offset:n.offset}])}return t}(n.triggers),r[e].interpolate=f(n.interpolate)}}(i,e,r);break;case 1:!function(e,t,r){const n=t[e];if((0,u.vA)(n,u.Cq.RECORD),e===d.n.LAYER)return(0,u.vA)(n.triggers,u.Cq.RECORD),r[e].triggers=function(e){const t={};for(const r of Object.keys(e)){const n=parseInt(r);t[n]=[];const i=e[r];(0,u.vA)(i,u.Cq.ARR);for(const e of i)(0,u.vA)(e,u.Cq.NUM_ARR),t[n].push([(0,p.nC)(e[0]),{on:e[1],off:e[2],offset:e[3]}])}return t}(n.triggers),void(r[e].interpolate=T(n.interpolate));switch((0,u.vA)(n.triggers,u.Cq.ARR),e){case d.n.ZOOM:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.NUM_ARR);const e=[(0,p.nC)(r[0]),r[1]];t.push(e)}return t}(n.triggers),r[e].smoothing=A(n.smoothing);break;case d.n.PAN:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.NUM_ARR);const[e,n,i,a,o]=r,s=[(0,p.nC)(e),{x:a,y:o,w:n,h:i}];t.push(s)}return t}(n.triggers),r[e].smoothing=A(n.smoothing);break;case d.n.FOCUS:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.ARR);const[e,n]=r;(0,u.vA)(e,u.Cq.NUM),(0,u.vA)(n,u.Cq.NUM_ARR);const i=[(0,p.nC)(e),n];t.push(i)}return t}(n.triggers),r[e].smoothing=A(n.smoothing);break;case d.n.TIME:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.NUM_ARR);const e=[(0,p.nC)(r[0]),r[1]];t.push(e)}return t}(n.triggers),r[e].interpolate=T(n.interpolate);break;case d.n.SKIN:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.RECORD);const e=structuredClone(g.BC[d.n.SKIN].TEMPLATE);for(const t of Object.keys(e))(0,u.vA)(r[t],u.Cq.RECORD),(0,u.z6)(r[t].fill,u.Cq.STR)&&(e[t].fill=r[t].fill),(0,u.z6)(r[t].stroke,u.Cq.STR)&&(e[t].stroke=r[t].stroke);t.push(e)}return t}(n.triggers);break;case d.n.GRAVITY:r[e].triggers=function(e){const t=[];for(const r of e){(0,u.vA)(r,u.Cq.ARR);const e=[];for(const t of r){(0,u.vA)(t,u.Cq.NUM_ARR);const r=[(0,p.nC)(t[0]),{x:t[1],y:t[2]}];e.push(r)}t.push(e)}return t}(n.triggers)}}(i,e,r)}}catch(e){if(e instanceof Error)switch(console.error(`[ScriptParser.parseScript()] ${e.message}`),i){case d.n.ZOOM:case d.n.PAN:case d.n.FOCUS:case d.n.TIME:case d.n.GRAVITY:case d.n.LAYER:r[i]=structuredClone(t[i])}}})),r}(JSON.parse(t.result),this.triggerManager.data))}catch(e){e instanceof Error&&console.error(`[Root.onLoadFile()] Failed to load file: ${e.message}`)}},t.readAsText(e)}onLoadScript(){this.onLoad((0,_.A)($e.getState().trackData.script,this.triggerManager.data))}onLoad(e){const{activeTab:t,gravityDropdown:r,layerDropdown:n}=this.state;try{if(g.p6.forEach((r=>{this.triggerManager.updateFromPath([r],e[r],t)})),this.updateStore(!0),t!==d.n.SKIN){const i=(0,p.Z3)(e,t,r,n);this.setState({invalidTimes:(0,p.P)(i)})}this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}catch(e){e instanceof Error&&console.error(`[Root.onLoad()] ${e.message}`)}}onTest(){const{activeTab:e,invalidTimes:t}=this.state;try{if(!t.every((e=>!e)))throw new Error("Triggers contain invalid times!");switch(e){case d.n.ZOOM:{const e=this.triggerManager.data[d.n.ZOOM];window.getAutoZoom=window.createZoomer(e.triggers,e.smoothing);break}case d.n.PAN:{const e=this.triggerManager.data[d.n.PAN];window.getCamBounds=window.createBoundsPanner(e.triggers,e.smoothing);break}case d.n.FOCUS:{const e=this.triggerManager.data[d.n.FOCUS];window.getCamFocus=window.createFocuser(e.triggers,e.smoothing);break}case d.n.TIME:{const e=this.triggerManager.data[d.n.TIME];window.timeRemapper=window.createTimeRemapper(e.triggers,e.interpolate);break}case d.n.SKIN:{const e=this.triggerManager.data[d.n.SKIN];window.setCustomRiders((0,p.Qx)(e.triggers));break}case d.n.GRAVITY:{const e=this.triggerManager.data[d.n.GRAVITY];void 0!==window.setCustomGravity&&window.setCustomGravity(e.triggers);break}case d.n.LAYER:{const e=this.triggerManager.data[d.n.LAYER];void 0!==window.createLayerAutomator&&window.createLayerAutomator(e.triggers,e.interpolate);break}}}catch(e){e instanceof Error&&console.error(`[Root.onTest()] ${e.message}`)}}onCopy(){return Ge(this,void 0,void 0,(function*(){const{activeTab:e,invalidTimes:t}=this.state;try{if(!t.every((e=>!e)))throw new Error("Triggers contain invalid times!");const r=(0,p.hw)(e,this.triggerManager.data);return yield navigator.clipboard.writeText(r)}catch(e){e instanceof Error&&console.error(`[Root.onCopy()] ${e.message}`)}}))}onUndo(){const{activeTab:e,gravityDropdown:t,layerDropdown:r}=this.state,n=this.triggerManager.undo();if(this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),e!==n&&this.setState({activeTab:n}),e!==d.n.SKIN){const n=(0,p.Z3)(this.triggerManager.data,e,t,r);this.setState({invalidTimes:(0,p.P)(n)})}}onRedo(){const{activeTab:e,gravityDropdown:t,layerDropdown:r}=this.state,n=this.triggerManager.redo();if(this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag}),e!==n&&this.setState({activeTab:n}),e!==d.n.SKIN){const n=(0,p.Z3)(this.triggerManager.data,e,t,r);this.setState({invalidTimes:(0,p.P)(n)})}}onResetSkin(e){this.triggerManager.updateFromPath([d.n.SKIN,"triggers",e.toString()],structuredClone(g.BC[d.n.SKIN].TEMPLATE),d.n.SKIN),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}onToggleActive(){const{active:e}=this.state,t=b($e.getState());!e&&t&&$e.dispatch({type:"SET_VIEWS",payload:{Sidebar:null},meta:{name:"SET_SIDEBAR_PAGE",auto:!1}}),this.setState({active:!e})}onChangeTab(e){const{gravityDropdown:t,layerDropdown:r}=this.state;if(this.setState({activeTab:e}),e!==d.n.SKIN){const n=(0,p.Z3)(this.triggerManager.data,e,t,r);this.setState({invalidTimes:(0,p.P)(n)})}}onToggleSettings(){const{settingsActive:e}=this.state;this.setState({settingsActive:!e})}onHelp(){window.open("https://github.com/Malizma333/line-rider-command-editor-userscript#readme")}onApplyViewport(e){const t={[l.HD]:{width:1280,height:720},[l.FHD]:{width:1920,height:1080},[l.QHD]:{width:2560,height:1440},[l.UHD]:{width:3840,height:2160}},r=Math.log2(t[e].width/t[this.state.resolution].width);$e.dispatch({type:"SET_PLAYBACK_DIMENSIONS",payload:t[e]});const n=this.triggerManager.data[d.n.ZOOM].triggers.map((e=>[e[0],Math.round(1e7*(e[1]+r+Number.EPSILON))/1e7]));this.triggerManager.updateFromPath([d.n.ZOOM,"triggers"],n,d.n.ZOOM),this.setState({triggerUpdateFlag:!this.state.triggerUpdateFlag})}onChangeFocusDD(e){this.setState({focusDropdown:e})}onChangeGravityDD(e){this.setState({gravityDropdown:e}),this.setState({invalidTimes:(0,p.P)(this.triggerManager.data[d.n.GRAVITY].triggers[e])})}onChangeLayerDD(e){this.setState({layerDropdown:e}),this.setState({invalidTimes:(0,p.P)(this.triggerManager.data[d.n.LAYER].triggers[e])})}onCaptureCamera(e,t){switch(t){case d.n.ZOOM:this.onUpdateTrigger(Math.log2($e.getState().camera.editorZoom),["triggers",e.toString(),"1"]);break;case d.n.PAN:{const{x:t,y:r}=$e.getState().camera.editorPosition,n=function(e){return e.simulator.engine}($e.getState()),{width:i,height:a}=function(e){return e.camera.playbackDimensions||e.camera.editorDimensions}($e.getState()),o=function(e){return window.getAutoZoom?window.getAutoZoom(S(e)):e.camera.playbackZoom}($e.getState()),s=Math.floor(S($e.getState())),l=$e.getState().camera.playbackFollower.getCamera(n,{zoom:o,width:i,height:a},s);this.onUpdateTrigger((t-l.x)*o/i,["triggers",e.toString(),"1","x"]),this.onUpdateTrigger((r-l.y)*o/a,["triggers",e.toString(),"1","y"]);break}}}render(){const{activeTab:e,gravityDropdown:t,layerDropdown:r}=this.state;return ze.createElement("div",{style:{fontSize:y[this.state.fontSize],transition:"font-size 0.125s ease-in-out"}},this.renderActions(),this.state.active&&ze.createElement("div",{style:o.mainContent},this.state.settingsActive?ze.createElement(We,{root:this}):ze.createElement("div",{style:o.windowContainer},this.renderTabContainer(),e===d.n.SKIN?ze.createElement(Ie,{root:this,skinTriggers:this.triggerManager.data[d.n.SKIN].triggers}):ze.createElement(ze.Fragment,null,this.renderWindowHead(),ze.createElement("div",{style:Object.assign(Object.assign({},o.windowBody),{paddingBottom:"10px"})},(0,p.Z3)(this.triggerManager.data,e,t,r).map(((e,t)=>this.renderTrigger(e,t))))))))}renderActions(){return this.state.active?ze.createElement("div",{style:o.actionContainer},ze.createElement("div",{style:Object.assign(Object.assign({},o.actionContainer),{justifyContent:"start"})},ze.createElement(ne,{title:"Minimize",onClick:()=>this.onToggleActive(),icon:F}),ze.createElement(ne,{title:"Download",onClick:()=>this.onDownload(),icon:P}),ze.createElement(ne,{title:"Upload",onClick:()=>this.onUpload(),icon:L}),ze.createElement(ne,{title:"Load From Script",onClick:()=>this.onLoadScript(),icon:I,disabled:this.state.activeTab===d.n.GRAVITY||this.state.activeTab===d.n.LAYER}),ze.createElement(ne,{title:"Run",onClick:()=>this.onTest(),icon:k,disabled:this.state.invalidTimes.some((e=>e))}),ze.createElement(ne,{title:"Copy Script",onClick:()=>Ge(this,void 0,void 0,(function*(){return yield this.onCopy()})),icon:x,disabled:this.state.activeTab===d.n.GRAVITY||this.state.activeTab===d.n.LAYER})),ze.createElement("div",{style:Object.assign(Object.assign({},o.actionContainer),{justifyContent:"end"})},ze.createElement(ne,{title:"Undo",onClick:()=>this.onUndo(),icon:K,disabled:0===this.triggerManager.undoLen}),ze.createElement(ne,{title:"Redo",onClick:()=>this.onRedo(),icon:W,disabled:0===this.triggerManager.redoLen}),ze.createElement(ne,{title:"Settings",onClick:()=>this.onToggleSettings(),icon:U}),ze.createElement(ne,{title:"Help",onClick:()=>this.onHelp(),icon:N})),ze.createElement("input",{id:"trigger-file-upload",style:{display:"none"},type:"file",accept:".json",onChange:e=>this.onLoadFile(e.target.files[0])})):ze.createElement("div",{style:o.actionContainer},ze.createElement(ne,{title:"Maximize",onClick:()=>this.onToggleActive(),icon:B}))}renderTabContainer(){return ze.createElement("div",{style:o.tabContainer},...g.p6.map((e=>0===this.state.numRiders&&[d.n.FOCUS,d.n.GRAVITY,d.n.SKIN].includes(e)?null:ze.createElement("div",null,ze.createElement(Ne,{customStyle:o.tabButton,onClick:()=>this.onChangeTab(e),active:this.state.activeTab===e,label:g.BC[e].DISPLAY_NAME,disabledShadow:!0,tabButton:!0})))))}renderWindowHead(){const{data:e}=this.triggerManager,{activeTab:t}=this.state;return ze.createElement("div",{style:o.windowHead},t===d.n.ZOOM&&ze.createElement(ze.Fragment,null,this.renderTriggerProp("Smoothing",e[t].smoothing,["smoothing"],h.s.SMOOTH)),t===d.n.PAN&&ze.createElement(ze.Fragment,null,this.renderTriggerProp("Smoothing",e[t].smoothing,["smoothing"],h.s.SMOOTH)),t===d.n.FOCUS&&ze.createElement(ze.Fragment,null,this.renderTriggerProp("Smoothing",e[t].smoothing,["smoothing"],h.s.SMOOTH),ze.createElement(oe,{customStyle:{margin:"0em .25em"},value:this.state.focusDropdown,mapping:[...Array(this.state.numRiders).keys()],label:(e,t)=>`Rider ${t+1}`,onChange:e=>this.onChangeFocusDD(e)})),t===d.n.TIME&&ze.createElement(ze.Fragment,null,this.renderTriggerProp("Smoothing",e[t].interpolate,["interpolate"],h.s.INTERPOLATE)),t===d.n.GRAVITY&&ze.createElement(ze.Fragment,null,ze.createElement(oe,{customStyle:{margin:"0em .25em"},value:this.state.gravityDropdown,mapping:[...Array(this.state.numRiders).keys()],label:(e,t)=>`Rider ${t+1}`,onChange:e=>this.onChangeGravityDD(e)})),t===d.n.LAYER&&ze.createElement(ze.Fragment,null,ze.createElement(oe,{customStyle:{margin:"0em .25em"},value:this.state.layerDropdown,mapping:this.state.layerMap,label:e=>`Layer ${e}`,onChange:e=>this.onChangeLayerDD(e)}),this.renderTriggerProp("60 FPS",e[t].interpolate,["interpolate"],h.s.INTERPOLATE)))}renderTrigger(e,t){const{activeTab:r}=this.state;return ze.createElement("div",{style:Object.assign(Object.assign({},o.triggerContainer),{fontSize:"1.5em"})},ze.createElement("div",{style:o.triggerActionContainer},(r===d.n.ZOOM||r===d.n.PAN)&&ze.createElement(ne,{onClick:()=>this.onCaptureCamera(t,r),icon:q,title:"Capture Editor Camera"}),ze.createElement(ne,{onClick:()=>this.onDeleteTrigger(t),icon:j,disabled:0===t,title:"Delete"})),this.renderTimeInput(e[0],t),r===d.n.ZOOM&&this.renderZoomTrigger(e,t),r===d.n.PAN&&this.renderPanTrigger(e,t),r===d.n.FOCUS&&this.renderFocusTrigger(e,t),r===d.n.TIME&&this.renderRemapTrigger(e,t),r===d.n.GRAVITY&&this.renderGravityTrigger(e,t),r===d.n.LAYER&&this.renderLayerTrigger(e,t),ze.createElement("div",{style:o.createTriggerContainer},ze.createElement(Ne,{onClick:()=>this.onCreateTrigger(t),customStyle:{fontSize:"0.75em"},label:"+",active:!0})))}renderTimeInput(e,t){const r=[h.s.MINUTE,h.s.SECOND,h.s.FRAME],n=["Time",":",":"],i=this.state.activeTab===d.n.GRAVITY?["triggers",this.state.gravityDropdown.toString(),t.toString(),"0"]:this.state.activeTab===d.n.LAYER?["triggers",this.state.layerDropdown.toString(),t.toString(),"0"]:["triggers",t.toString(),"0"];return ze.createElement("div",{style:o.triggerPropContainer},...e.map(((e,a)=>ze.createElement("div",null,this.renderTriggerProp(n[a],e,i.concat([a.toString()]),r[a],this.state.invalidTimes[t]?"red":o.root.color)))))}renderZoomTrigger(e,t){return ze.createElement("div",{style:o.triggerPropContainer},this.renderTriggerProp("Zoom To",e[1],["triggers",t.toString(),"1"],h.s.ZOOM))}renderPanTrigger(e,t){const r=[h.s.PAN_WIDTH,h.s.PAN_HEIGHT,h.s.PAN_X,h.s.PAN_Y],n=["Width","Height","Offset X","Y"];return ze.createElement("div",null,...[["w","h"],["x","y"]].map(((i,a)=>ze.createElement("div",{style:{display:"flex",flexDirection:"row"}},...i.map(((i,s)=>ze.createElement("div",{style:o.triggerPropContainer},this.renderTriggerProp(n[s+2*a],e[1][i],["triggers",t.toString(),"1",i],r[s+2*a]))))))))}renderFocusTrigger(e,t){const r=this.state.focusDropdown;return ze.createElement("div",{style:o.triggerPropContainer},this.renderTriggerProp("Weight",e[1][r],["triggers",t.toString(),"1",r.toString()],h.s.FOCUS_WEIGHT))}renderRemapTrigger(e,t){return ze.createElement("div",{style:o.triggerPropContainer},this.renderTriggerProp("Speed",e[1],["triggers",t.toString(),"1"],h.s.TIME_SPEED))}renderGravityTrigger(e,t){const r=[h.s.GRAVITY_X,h.s.GRAVITY_Y],n=["X","Y"],{gravityDropdown:i}=this.state;return ze.createElement("div",{style:{display:"flex",flexDirection:"row"}},...["x","y"].map(((a,s)=>ze.createElement("div",{style:o.triggerPropContainer},this.renderTriggerProp(n[s],e[1][a],["triggers",i.toString(),t.toString(),"1",a],r[s])))))}renderLayerTrigger(e,t){const r=[h.s.LAYER_ON,h.s.LAYER_OFF,h.s.LAYER_OFFSET],n=["ON","OFF","OFFSET"],{layerDropdown:i}=this.state;return ze.createElement("div",{style:{display:"flex",flexDirection:"row"}},...["on","off","offset"].map(((a,s)=>ze.createElement("div",{style:o.triggerPropContainer},this.renderTriggerProp(n[s],e[1][a],["triggers",i.toString(),t.toString(),"1",a],r[s])))))}renderTriggerProp(e,t,r,n,i){const a=n.TYPE===Ze.t.FLOAT?G:J;return ze.createElement("div",{style:o.triggerRowContainer},ze.createElement("label",{style:o.spacedProperty,htmlFor:r.join("_")},e),n.TYPE===Ze.t.BOOL?ze.createElement(Ve,{customStyle:o.spacedProperty,id:r.join("_"),value:t,onCheck:()=>this.onUpdateTrigger(!t,r)}):ze.createElement(a,{customStyle:Object.assign(Object.assign({},o.spacedProperty),{color:i||o.root.color}),id:r.join("_"),value:t,min:n.MIN,max:n.MAX,onChange:e=>this.onUpdateTrigger(e,r)}))}}function Je(){const{React:e,store:t}=window,r=document.getElementById("content"),n=document.createElement("div");Object.assign(n.style,o.root),window.ReactDOM.render(e.createElement(Xe),n),r.appendChild(n),t.subscribe((()=>{const e=t.getState().player.running,r=!!t.getState().views.Main,i=window.CMD_EDITOR_DEBUG||!e&&r;n.style.opacity=i?"1":"0",n.style.pointerEvents=i?"auto":"none"}));const i=setInterval((()=>{const e=r.querySelector('div[style="margin: 16px;"]');if(e){const t=e.querySelector("h1");t&&"An error occurred!"===t.innerHTML&&(console.warn("[index.main()] Crash detected..."),window.saveCommands(),clearInterval(i))}}),1e3)}if(window.store)Je();else{const e=window.onAppReady;window.onAppReady=()=>{e&&e(),Je()}}})(),window.setCustomGravity=function(){const e=window.store.getState().simulator.engine.getFrame(0).snapshot.entities[0].entities[0].points.length;let t=!1,r=window.store.getState().simulator.engine.engine.state.riders.length,n=0,i=0,a={};function o(){window.store.dispatch({type:"STOP_PLAYER"}),r=window.store.getState().simulator.engine.engine.state.riders.length,n=0,i=0,window.requestAnimationFrame((()=>{window.store.getState().camera.playbackFollower._frames.length=0,window.store.getState().simulator.engine.engine._computed._frames.length=1}))}function s(){const t=a[i];if(0===t.length)return{x:0,y:.175};const o=window.store.getState().simulator.engine.engine._computed._frames.length-1;let s=t[t.length-1][1];if(o<t[t.length-1][0]){let e=0,r=t.length-1;for(;e<r;){const n=Math.ceil((r+e)/2);o<t[n][0]?r=n-1:e=n}s=t[e][1]}return void 0===s&&(s={x:0,y:.175}),n+=1,n===e&&(n=0,i+=1),i===r&&(i=0),s}return window.store.subscribe((()=>{r!==window.store.getState().simulator.engine.engine.state.riders.length&&o()})),function(e){a={};for(let t=0;t<e.length;t++){const r=e[t];a[t]=[];for(const e of r)a[t].push([2400*e[0][0]+40*e[0][1]+e[0][2],e[1]])}o(),t||(t=!0,Object.defineProperty(window.$ENGINE_PARAMS,"gravity",{get:s}))}}(),window.createLayerAutomator=function(){let e={},t=!1,r={};const n=(n,i)=>{if(t&&(i=Math.round(1.5*i)),!(n in e))return!0;const a=e[n];let o=a[r[n]][1];if(r[n]<a.length-1&&a[r[n]+1][0]<=i&&(r[n]+=1,o=a[r[n]][1]),r[n]<a.length-1&&!(a[r[n]][0]<=i&&i<a[r[n]+1][0])||r[n]===a.length-1&&!(a[r[n]][0]<=i)){let e=0,t=a.length-1;for(;e<t;){const r=Math.ceil((t+e)/2);i<a[r][0]?t=r-1:e=r}r[n]=e,o=a[r[n]][1]}return 0===o.off||0!==o.on&&(i+o.offset)%(o.on+o.off)<o.on};return function(i,a){t=a,e={},r={};for(const t of Object.keys(i)){const n=i[t];t in e||(e[t]=[],r[t]=0);for(const r of n)e[t].push([2400*r[0][0]+40*r[0][1]+r[0][2],{on:r[1].on,off:r[1].off,offset:r[1].offset}])}void 0===window.getLayerVisibleAtTime&&(window.getLayerVisibleAtTime=n)}}()})();